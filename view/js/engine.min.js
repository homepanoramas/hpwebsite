var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(l){var d=0;return function(){return d<l.length?{done:!1,value:l[d++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,d,O){l!=Array.prototype&&l!=Object.prototype&&(l[d]=O.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(l,d){this.$jscomp$symbol$id_=l;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function l(O){if(this instanceof l)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(O||"")+"_"+d++,O)}var d=0;return l}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.asyncIterator;l||(l=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};
(function(l,d){"object"===typeof exports&&"undefined"!==typeof module?d(exports,require("three"),require("hls.js")):"function"===typeof define&&define.amd?define(["exports","three","hls.js"],d):(l=l||self,d(l.PANOLENS={},l.THREE,l.Hls))})(this,function(l,d,O){function ua(d,f){var g=Object.keys(d);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(d);f&&(a=a.filter(function(a){return Object.getOwnPropertyDescriptor(d,a).enumerable}));g.push.apply(g,a)}return g}function B(d){for(var f=
1;f<arguments.length;f++){var g=null!=arguments[f]?arguments[f]:{};f%2?ua(Object(g),!0).forEach(function(a){var b=g[a];a in d?Object.defineProperty(d,a,{value:b,enumerable:!0,configurable:!0,writable:!0}):d[a]=b}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(g)):ua(Object(g)).forEach(function(a){Object.defineProperty(d,a,Object.getOwnPropertyDescriptor(g,a))})}return d}function F(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function");
}function va(d,f){for(var g=0;g<f.length;g++){var a=f[g];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(d,a.key,a)}}function I(d,f,n){f&&va(d.prototype,f);n&&va(d,n);return d}function G(d,f){if("function"!==typeof f&&null!==f)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(f&&f.prototype,{constructor:{value:d,writable:!0,configurable:!0}});f&&la(d,f)}function w(d){w=Object.setPrototypeOf?Object.getPrototypeOf:
function(f){return f.__proto__||Object.getPrototypeOf(f)};return w(d)}function la(d,f){la=Object.setPrototypeOf||function(f,a){f.__proto__=a;return f};return la(d,f)}function Fa(){if("undefined"===typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(g){return!1}}function u(d){if(void 0===d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return d}function wa(d,f){if(f&&("object"===typeof f||"function"===typeof f))return f;if(void 0!==f)throw new TypeError("Derived constructors may only return object or undefined");return u(d)}function H(d){var f=Fa();return function(){var g=w(d);if(f){var a=w(this).constructor;g=Reflect.construct(g,arguments,a)}else g=g.apply(this,arguments);return wa(this,g)}}function t(d,f,n){t="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){for(;!Object.prototype.hasOwnProperty.call(a,b)&&
(a=w(a),null!==a););if(a)return b=Object.getOwnPropertyDescriptor(a,b),b.get?b.get.call(c):b.value};return t(d,f,n||d)}function Ga(d,f){if(d){if("string"===typeof d)return xa(d,f);var g=Object.prototype.toString.call(d).slice(8,-1);"Object"===g&&d.constructor&&(g=d.constructor.name);if("Map"===g||"Set"===g)return Array.from(d);if("Arguments"===g||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return xa(d,f)}}function xa(d,f){if(null==f||f>d.length)f=d.length;for(var g=0,a=Array(f);g<f;g++)a[g]=
d[g];return a}function W(d,f){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var g="undefined"!==typeof Symbol&&d[Symbol.iterator]||d["@@iterator"];if(!g){if(Array.isArray(d)||(g=Ga(d))||f&&d&&"number"===typeof d.length){g&&(d=g);var a=0;f=function(){};return{s:f,n:function(){return a>=d.length?{done:!0}:{done:!1,value:d[a++]}},e:function(a){throw a;},f:f}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}var b=!0,c=!1,e;return{s:function(){g=g.call(d)},n:function(){var a=g.next();b=a.done;return a},e:function(a){c=!0;e=a},f:function(){try{b||null==g.return||g.return()}finally{if(c)throw e;}}}}function ma(g,f){da.uniforms.threshold.value=g.threshold;da.uniforms.useTexture.value=g.useTexture;da.uniforms.tMixTexture.value=f;return new d.ShaderMaterial(da)}function na(d,f,n,a,b){var c;function e(a,b){if(1<b.length)for(var c=0;c<b.length;c++)e(a,b[c]);else b.rotation.x+=Math.sign(a.y)*r}function h(a,
c){if(1<c.length)for(var e=0;e<c.length;e++)h(a,c[e]);else C+=-Math.sign(a.x),C=C===b?0:C,C=0>C?b-1:C,x.dispatchEvent({type:"rotation",data:{currentSide:C}}),c.rotation.y+=-(Math.sign(a.x)*Math.PI*2)/b}function z(a,c){if(1<c.length)for(var e=0;e<c.length;e++)z(a,c[e]);else C+=-Math.sign(a.x),C=C===b?0:C,C=0>C?b-1:C,x.dispatchEvent({type:"rotation",data:{currentSide:C}}),c.rotation.y+=-(Math.sign(a.x)*Math.PI*2)/b}function p(a,b,c){return a/b}function g(a,c,e,h,f,d){var z=6<arguments.length&&void 0!==
arguments[6]?arguments[6]:!1;return function(e){e=e||h-1;var p=e-c,m=c,k=e>c?1:-1;setTimeout(function Ha(){1!=Q&&(m+=k,z&&(m%=e-1),C=m%(h-1),y.rotation.y+=-(Math.sign(a)*Math.PI*2)/b,x.dispatchEvent({type:"rotation",data:{currentSide:C}}),m!=e&&setTimeout(Ha,d(f,p,m)),m===e&&x.dispatchEvent({type:"initial-auto-rotate-finished"}))},d(f,p,c))}(e)}function m(a,b){if(k[b].enabled){if(1<y.length){for(var c=!0,e=0;e<y.length;e++){if(!c)return!1;k[b].enabled&&(c=!!(-1*k[b].from<y[e].rotation[b]+a&&y[e].rotation[b]+
a<k[b].to))}return c}return!!(-1*k[b].from<y.rotation[b]+a&&y.rotation[b]+a<k[b].to)}return!0}function P(){oa=!1;v=c=0}this.setObjectToMove=function(a){y=a};this.setZoomSpeed=function(a){l=a};this.setDistance=function(a,b){U=a;A=b};this.setRotationSpeed=function(a){};this.setRotationSpeedTouchDevices=function(a){r=a};this.enableVerticalRotation=function(){D=!0};this.disableVerticalRotation=function(){D=!1};this.enableHorizontalRotation=function(){q=!0};this.disableHorizontalRotation=function(){q=
!1};this.setMaxVerticalRotationAngle=function(a,b){k.x.from=a;k.x.to=b;k.x.enabled=!0};this.setMaxHorizontalRotationAngle=function(a,b){k.y.from=a;k.y.to=b;k.y.enabled=!0};this.disableMaxHorizontalAngleRotation=function(){k.y.enabled=!1};this.disableMaxVerticalAngleRotation=function(){k.x.enabled=!1};this.disableZoom=function(){u=!1};this.enableZoom=function(){u=!0};this.setIsZoomed=function(a){};f=void 0!==f?f:document;var k={x:{enabled:!1,from:Math.PI/8,to:Math.PI/8},y:{enabled:!1,from:Math.PI/
4,to:Math.PI/4}},y=n,A=300,U=300,l=.5,r=2E-4,oa=!1,Q=!1,D=!1,q=!0,u=!1;var v=c=0;var w=[],C=0,t={X:null,Y:null},x=this;this.animate=function(a){g(-1,0,b,b,3E3,p,a)};f.addEventListener("mousedown",function(a){oa=Q=!0;c=a.offsetX;v=a.offsetY},!1);f.addEventListener("mousemove",function(a){oa&&q&&(h({x:a.offsetX-c,y:a.offsetY-v},y),c=a.offsetX,v=a.offsetY)},!1);f.addEventListener("mouseup",P,!1);f.addEventListener("mouseout",P,!1);f.addEventListener("touchstart",function(a){a.preventDefault();Q=!0;2===
a.touches.length?(t.X=Math.abs(a.touches[0].clientX-a.touches[1].clientX),t.Y=Math.abs(a.touches[0].clientY-a.touches[1].clientY),w=Array(2)):(c=a.touches[0].pageX,v=a.touches[0].pageY)},!1);f.addEventListener("touchmove",function(a){a.preventDefault();if(2===a.touches.length&&u){w=Array(2);var b=Math.abs(a.touches[0].clientX-a.touches[1].clientX);a=Math.abs(a.touches[0].clientY-a.touches[1].clientY);t&&0<t.X&&0<t.Y&&(b>t.X&&a>t.Y&&d.position.z>U?d.position.z-=l:b<t.X&&d.position.z<A&&a<t.Y&&(d.position.z+=
l));t.X=b;t.Y=a}else if(0===w.length){t.X=null;t.Y=null;b={x:a.touches[0].pageX-c,y:a.touches[0].pageY-v};c=a.touches[0].pageX;v=a.touches[0].pageY;if(q&&0!=b.x){if(!m(Math.sign(b.x)*r,"y"))return;z(b,y)}D&&0!=b.y&&m(Math.sign(b.y)*r,"x")&&e(b,y)}},!1);f.addEventListener("touchend",function(a){t.X=null;t.Y=null;0<w.length?w.pop():w=[];a.preventDefault();v=c=0},!1)}function ea(g,f,n){function a(){n.addEventListener("mousemove",c,!1);n.addEventListener("mousedown",e,!1);n.addEventListener("mouseup",
h,!1);n.addEventListener("mouseleave",h,!1);n.addEventListener("touchmove",z,!1);n.addEventListener("touchstart",p,!1);n.addEventListener("touchend",J,!1)}function b(){n.removeEventListener("mousemove",c,!1);n.removeEventListener("mousedown",e,!1);n.removeEventListener("mouseup",h,!1);n.removeEventListener("mouseleave",h,!1);n.removeEventListener("touchmove",z,!1);n.removeEventListener("touchstart",p,!1);n.removeEventListener("touchend",J,!1)}function c(a){a.preventDefault();var b=n.getBoundingClientRect();
y.x=(a.clientX-b.left)/b.width*2-1;y.y=2*-((a.clientY-b.top)/b.height)+1;k.setFromCamera(y,f);l&&q.enabled?(k.ray.intersectPlane(P,U)&&l.position.copy(U.sub(A)),q.dispatchEvent({type:"drag",object:l})):(k.setFromCamera(y,f),a=k.intersectObjects(g),0<a.length?(a=a[0].object,P.setFromNormalAndCoplanarPoint(f.getWorldDirection(P.normal),a.position),r!==a&&(q.dispatchEvent({type:"hoveron",object:a}),n.style.cursor="pointer",r=a)):null!==r&&(q.dispatchEvent({type:"hoveroff",object:r}),n.style.cursor="auto",
r=null))}function e(a){a.preventDefault();k.setFromCamera(y,f);a=k.intersectObjects(g,!1);0<a.length&&(l=a[0].object,k.ray.intersectPlane(P,U)&&A.copy(U).sub(l.position),n.style.cursor="move",q.dispatchEvent({type:"dragstart",object:l}))}function h(a){a.preventDefault();l&&(q.dispatchEvent({type:"dragend",object:l}),l=null);n.style.cursor="auto"}function z(a){a.preventDefault();a=a.changedTouches[0];var b=n.getBoundingClientRect();y.x=(a.clientX-b.left)/b.width*2-1;y.y=2*-((a.clientY-b.top)/b.height)+
1;k.setFromCamera(y,f);l&&q.enabled&&(k.ray.intersectPlane(P,U)&&l.position.copy(U.sub(A)),q.dispatchEvent({type:"drag",object:l}))}function p(a){a.preventDefault();a=a.changedTouches[0];var b=n.getBoundingClientRect();y.x=(a.clientX-b.left)/b.width*2-1;y.y=2*-((a.clientY-b.top)/b.height)+1;k.setFromCamera(y,f);a=k.intersectObjects(g);0<a.length&&(l=a[0].object,P.setFromNormalAndCoplanarPoint(f.getWorldDirection(P.normal),l.position),k.ray.intersectPlane(P,U)&&A.copy(U).sub(l.position),n.style.cursor=
"move",q.dispatchEvent({type:"dragstart",object:l}))}function J(a){a.preventDefault();l&&(q.dispatchEvent({type:"dragend",object:l}),l=null);n.style.cursor="auto"}if(g.isCamera){console.warn("THREE.DragControls: Constructor now expects ( objects, camera, domElement )");var m=g;g=f;f=m}var P=new d.Plane,k=new d.Raycaster,y=new d.Vector2,A=new d.Vector3,U=new d.Vector3,l=null,r=null,q=this;a();this.enabled=!0;this.activate=a;this.deactivate=b;this.dispose=function(){b()};this.setObjects=function(){console.error("THREE.DragControls: setObjects() has been removed.")};
this.on=function(a,b){console.warn("THREE.DragControls: on() has been deprecated. Use addEventListener() instead.");q.addEventListener(a,b)};this.off=function(a,b){console.warn("THREE.DragControls: off() has been deprecated. Use removeEventListener() instead.");q.removeEventListener(a,b)};this.notify=function(a){console.error("THREE.DragControls: notify() has been deprecated. Use dispatchEvent() instead.");q.dispatchEvent({type:a})}}function fa(g,f){function n(){return 2*Math.PI/60/60*k.autoRotateSpeed}
function a(a){if(!1!==k.enabled){a.preventDefault();if(a.button===k.mouseButtons.ORBIT){if(!0===k.noRotate)return;L=K.ROTATE;y.set(a.clientX,a.clientY)}else if(a.button===k.mouseButtons.ZOOM){if(!0===k.noZoom)return;L=K.DOLLY;v.set(a.clientX,a.clientY)}else if(a.button===k.mouseButtons.PAN){if(!0===k.noPan)return;L=K.PAN;q.set(a.clientX,a.clientY)}L!==K.NONE&&(document.addEventListener("mousemove",b,!1),document.addEventListener("mouseup",c,!1),k.dispatchEvent(R))}}function b(a){if(!1!==k.enabled){a.preventDefault();
var b=k.domElement===document?k.domElement.body:k.domElement;L===K.ROTATE?!0!==k.noRotate&&(A.set(a.clientX,a.clientY),l.subVectors(A,y),0==y.x&&0==y.y?(y.set(A.x,A.y),l.subVectors(A,y)):(k.rotateLeft(2*Math.PI*l.x/b.clientHeight*k.rotateSpeed),k.rotateUp(2*Math.PI*l.y/b.clientHeight*k.rotateSpeed),y.copy(A))):L===K.DOLLY?!0!==k.noZoom&&(t.set(a.clientX,a.clientY),w.subVectors(t,v),0<w.y?k.dollyIn():0>w.y&&k.dollyOut(),v.copy(t)):L===K.PAN&&!0!==k.noPan&&(r.set(a.clientX,a.clientY),u.subVectors(r,
q),k.pan(u.x,u.y),q.copy(r))}}function c(){!1!==k.enabled&&(document.removeEventListener("mousemove",b,!1),document.removeEventListener("mouseup",c,!1),k.dispatchEvent(S),L=K.NONE)}function e(a){if(!1!==k.enabled&&!0!==k.noZoom&&L===K.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?(k.object.fov=k.object.fov<k.maxFov?k.object.fov+1:k.maxFov,k.object.updateProjectionMatrix()):0>b&&(k.object.fov=k.object.fov>k.minFov?k.object.fov-
1:k.minFov,k.object.updateProjectionMatrix());k.object.fov<=k.maxFov&&(k.dispatchEvent(O),k.dispatchEvent(R),k.dispatchEvent(S),k.dispatchEvent(T))}}function h(a){}function z(a){if(!1!==k.enabled&&!0!==k.noKeys&&!0!==k.noRotate){k.autoRotate&&(clearTimeout(this.autoRotateRequestId),k.autoRotate=!1,this.autoRotateRequestId=window.setTimeout(function(){k.autoRotate=!0},5E3));var b=k.momentum&&!k.autoRotate?k.momentumKeydownFactor*k.momentumFactor:k.momentumKeydownFactor;switch(a.keyCode){case k.keys.UP:k.rotateUp(k.rotateSpeed*
b);break;case k.keys.BOTTOM:k.rotateUp(-k.rotateSpeed*b);break;case k.keys.LEFT:k.rotateLeft(k.rotateSpeed*b);break;case k.keys.RIGHT:k.rotateLeft(-k.rotateSpeed*b)}}}function p(a){if(!1!==k.enabled){switch(a.touches.length){case 1:if(!0===k.noRotate)return;L=K.TOUCH_ROTATE;y.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(!0===k.noZoom)return;L=K.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;v.set(0,Math.sqrt(b*b+a*a));break;case 3:if(!0===
k.noPan)return;L=K.TOUCH_PAN;q.set(a.touches[0].pageX,a.touches[0].pageY);break;default:L=K.NONE}L!==K.NONE&&k.dispatchEvent(R)}}function J(a){if(!1!==k.enabled){a.preventDefault();a.stopPropagation();var b=k.domElement===document?k.domElement.body:k.domElement;switch(a.touches.length){case 1:var c=.38*k.rotateSpeed;if(!0===k.noRotate)break;if(L!==K.TOUCH_ROTATE)break;A.set(a.touches[0].pageX,a.touches[0].pageY);l.subVectors(A,y);k.rotateLeft(2*Math.PI*l.x/b.clientHeight*c);k.rotateUp(2*Math.PI*l.y/
b.clientHeight*c);y.copy(A);break;case 2:if(!0===k.noZoom)break;if(L!==K.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;t.set(0,Math.sqrt(b*b+a*a));w.subVectors(t,v);0>w.y?(k.object.fov=k.object.fov<k.maxFov?k.object.fov+1:k.maxFov,k.object.updateProjectionMatrix()):0<w.y&&(k.object.fov=k.object.fov>k.minFov?k.object.fov-1:k.minFov,k.object.updateProjectionMatrix());v.copy(t);k.dispatchEvent(O);k.dispatchEvent(T);break;case 3:if(!0===k.noPan)break;
if(L!==K.TOUCH_PAN)break;r.set(a.touches[0].pageX,a.touches[0].pageY);u.subVectors(r,q);k.pan(u.x,u.y);q.copy(r);break;default:L=K.NONE}}}function m(){!1!==k.enabled&&(k.dispatchEvent(S),L=K.NONE)}var P=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{panSpeed:1};this.object=g;this.domElement=void 0!==f?f:document;this.panSpeed=P.panSpeed;this.frameId=null;this.enabled=!0;this.center=this.target=new d.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=
0;this.maxZoom=Infinity;this.noRotate=!1;this.rotateSpeed=-.15;this.noPan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.momentumKeydownFactor=.05;this.speedLimit=.04;this.publicSphericalDelta=new d.Spherical;this.momentum=!0;this.momentumFactor=7.5;this.enableDamping=!0;this.dampingFactor=.03;this.minFov=30;this.maxFov=120;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,
BOTTOM:40};this.mouseButtons={ORBIT:d.MOUSE.LEFT,ZOOM:d.MOUSE.MIDDLE,PAN:d.MOUSE.RIGHT};var k=this,y=new d.Vector2,A=new d.Vector2,l=new d.Vector2,q=new d.Vector2,r=new d.Vector2,u=new d.Vector2,Q=new d.Vector3,D=new d.Vector3,v=new d.Vector2,t=new d.Vector2,w=new d.Vector2,x=0,C=0,B=0,E=0,F=1,G=new d.Vector3,H=new d.Vector3,I=new d.Quaternion,K={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},L=K.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
this.zoom0=this.object.zoom;var M=(new d.Quaternion).setFromUnitVectors(g.up,new d.Vector3(0,1,0)),N=M.clone().invert(),O={type:"change"},R={type:"start"},S={type:"end"},T={type:"fov"};this.setLastQuaternion=function(a){I.copy(a);k.object.quaternion.copy(a)};this.getLastPosition=function(){return H};this.rotateLeft=function(a){void 0===a&&(a=n());a=this.momentum&&!this.autoRotate?a/=this.momentumFactor:a;E-=a};this.rotateUp=function(a){void 0===a&&(a=n());a=this.momentum&&!this.autoRotate?a/=this.momentumFactor:
a;B-=a};this.rotateLeftStatic=function(a){this.enableDamping=!1;E-=a;this.update();this.enableDamping=!0};this.rotateUpStatic=function(a){this.enableDamping=!1;B-=a;this.update();this.enableDamping=!0};this.centerTo=function(a,b){var c=k.enableDamping;k.enableDamping=!1;var e=this.object.position;D.copy(e).sub(this.target);D.applyQuaternion(M);x=Math.atan2(D.x,D.z);C=Math.atan2(Math.sqrt(D.x*D.x+D.z*D.z),D.y);this.autoRotate&&L===K.NONE&&this.rotateLeft(n());x=a;C=b;k.publicSphericalDelta.data={theta:x};
x=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,x));C=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,C));C=Math.max(1E-7,Math.min(Math.PI-1E-7,C));a=D.length()*F;a=Math.max(this.minDistance,Math.min(this.maxDistance,a));this.target.add(G);D.x=a*Math.sin(C)*Math.sin(x);D.y=a*Math.cos(C);D.z=a*Math.sin(C)*Math.cos(x);D.applyQuaternion(N);e.copy(this.target).add(D);this.object.lookAt(this.target);F=1;G.set(0,0,0);if(1E-7<H.distanceToSquared(this.object.position)||1E-7<8*(1-I.dot(this.object.quaternion)))this.dispatchEvent(O),
H.copy(this.object.position),I.copy(this.object.quaternion);k.enableDamping=c};this.getRotations=function(){return{h:x,v:C}};this.panLeft=function(a){var b=this.object.matrix.elements;Q.set(b[0],b[1],b[2]);Q.multiplyScalar(-a);G.add(Q)};this.panUp=function(a){var b=this.object.matrix.elements;Q.set(b[4],b[5],b[6]);Q.multiplyScalar(a);G.add(Q)};this.pan=function(a,b){var c=k.domElement===document?k.domElement.body:k.domElement;if(k.object instanceof d.PerspectiveCamera){var e=k.object.position.clone().sub(k.target).length();
e*=Math.tan(k.object.fov/2*Math.PI/180);k.panLeft(2*this.panSpeed*a*e/c.clientHeight);k.panUp(2*this.panSpeed*b*e/c.clientHeight)}else k.object instanceof d.OrthographicCamera?(k.panLeft(a*(k.object.right-k.object.left)/c.clientWidth),k.panUp(b*(k.object.top-k.object.bottom)/c.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,k.zoomSpeed));k.object instanceof d.PerspectiveCamera?F/=a:k.object instanceof
d.OrthographicCamera?(k.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*a)),k.object.updateProjectionMatrix(),k.dispatchEvent(O)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,k.zoomSpeed));k.object instanceof d.PerspectiveCamera?F*=a:k.object instanceof d.OrthographicCamera?(k.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/a)),k.object.updateProjectionMatrix(),
k.dispatchEvent(O)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.update=function(a){var b=this.object.position;D.copy(b).sub(this.target);D.applyQuaternion(M);x=Math.atan2(D.x,D.z);C=Math.atan2(Math.sqrt(D.x*D.x+D.z*D.z),D.y);this.autoRotate&&L===K.NONE&&this.rotateLeft(n());!0===this.enableDamping&&(E=d.Math.clamp(E,-this.speedLimit,this.speedLimit),B=d.Math.clamp(B,-this.speedLimit,this.speedLimit));x+=E;C+=B;k.publicSphericalDelta.data=
{theta:x};x=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,x));C=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,C));C=Math.max(1E-7,Math.min(Math.PI-1E-7,C));var c=D.length()*F;c=Math.max(this.minDistance,Math.min(this.maxDistance,c));this.target.add(G);D.x=c*Math.sin(C)*Math.sin(x);D.y=c*Math.cos(C);D.z=c*Math.sin(C)*Math.cos(x);D.applyQuaternion(N);b.copy(this.target).add(D);this.object.lookAt(this.target);this.autoRotate||!0!==this.enableDamping||(!this.momentum||L!==K.ROTATE&&
L!==K.TOUCH_ROTATE)&&L!==K.NONE?B=E=0:(E*=1-this.dampingFactor,B*=1-this.dampingFactor);F=1;G.set(0,0,0);if(1E-7<H.distanceToSquared(this.object.position)||1E-7<8*(1-I.dot(this.object.quaternion)))!0!==a&&this.dispatchEvent(O),H.copy(this.object.position),I.copy(this.object.quaternion)};this.reset=function(){L=K.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent(O);this.update()};this.getPolarAngle=
function(){return C};this.getAzimuthalAngle=function(){return x};this.dispose=function(){this.domElement.removeEventListener("mousedown",a);this.domElement.removeEventListener("mousewheel",e);this.domElement.removeEventListener("DOMMouseScroll",e);this.domElement.removeEventListener("touchstart",p);this.domElement.removeEventListener("touchend",m);this.domElement.removeEventListener("touchmove",J);window.removeEventListener("keyup",h);window.removeEventListener("keydown",z)};this.domElement.addEventListener("mousedown",
a,{passive:!1});this.domElement.addEventListener("mousewheel",e,{passive:!1});this.domElement.addEventListener("DOMMouseScroll",e,{passive:!1});this.domElement.addEventListener("touchstart",p,{passive:!1});this.domElement.addEventListener("touchend",m,{passive:!1});this.domElement.addEventListener("touchmove",J,{passive:!1});window.addEventListener("keyup",h,{passive:!1});window.addEventListener("keydown",z,{passive:!1});this.update()}function pa(g,f){var n=this,a=0,b=0,c=0,e=0;this.camera=g;this.camera.rotation.reorder("YXZ");
this.domElement=void 0!==f?f:document;this.enabled=!0;this.deviceOrientation={alpha:null,beta:null,gamma:null};this.initialViewOffsetAngle=this.alphaOffsetAngle=this.alpha=this.screenOrientation=0;var h=function(a){null==n.deviceOrientation.alpha&&a&&a.alpha&&(n.initialViewOffsetAngle=d.Math.degToRad(a.alpha));n.enabled&&(n.deviceOrientation=a)},z=function(){n.screenOrientation=window.orientation||0},p=function(a){n.enabled&&(a.preventDefault(),a.stopPropagation(),c=a.touches[0].pageX,e=a.touches[0].pageY)},
J=function(h){n.enabled&&(h.preventDefault(),h.stopPropagation(),a+=d.Math.degToRad((h.touches[0].pageX-c)/4),b+=d.Math.degToRad((e-h.touches[0].pageY)/4),n.updateAlphaOffsetAngle(a),c=h.touches[0].pageX,e=h.touches[0].pageY)};this.connect=function(){z();window.addEventListener("orientationchange",z,{passive:!0});window.addEventListener("deviceorientation",h,{passive:!0});window.addEventListener("deviceorientation",this.update.bind(this),{passive:!0});n.domElement.addEventListener("touchstart",p,
{passive:!1});n.domElement.addEventListener("touchmove",J,{passive:!1});n.enabled=!0};this.disconnect=function(){window.removeEventListener("orientationchange",z,!1);window.removeEventListener("deviceorientation",h,!1);window.removeEventListener("deviceorientation",this.update.bind(this),!1);n.domElement.removeEventListener("touchstart",p,!1);n.domElement.removeEventListener("touchmove",J,!1);n.enabled=!1};this.update=function(a){if(!1!==n.enabled){a=null!=n.deviceOrientation.alpha?d.Math.degToRad(n.deviceOrientation.alpha)+
n.alphaOffsetAngle-n.initialViewOffsetAngle:n.alphaOffsetAngle;var c=null!=n.deviceOrientation.beta?d.Math.degToRad(n.deviceOrientation.beta):1.6,e=null!=n.deviceOrientation.gamma?d.Math.degToRad(n.deviceOrientation.gamma):0,h=n.screenOrientation?d.Math.degToRad(n.screenOrientation):0,f=n.camera.quaternion,z=new d.Vector3(0,0,1),p=new d.Euler,m=new d.Quaternion,g=new d.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),J=new d.Quaternion,l=new d.Quaternion;if(0==n.screenOrientation){var q=new d.Vector3(1,
0,0);J.setFromAxisAngle(q,-b)}else 180==n.screenOrientation?(q=new d.Vector3(1,0,0),J.setFromAxisAngle(q,b)):90==n.screenOrientation?(q=new d.Vector3(0,1,0),J.setFromAxisAngle(q,b)):-90==n.screenOrientation&&(q=new d.Vector3(0,1,0),J.setFromAxisAngle(q,-b));g.multiply(J);g.multiply(l);p.set(c,a,-e,"YXZ");f.setFromEuler(p);f.multiply(g);f.multiply(m.setFromAxisAngle(z,-h));n.alpha=a}};this.updateAlphaOffsetAngle=function(b){this.alphaOffsetAngle=b;0==a&&(a=b);this.update()};this.getRotations=function(){return{h:n.alpha,
v:0}};this.dispose=function(){this.disconnect()};this.connect()}function ha(){var g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.064;this.format=null;this.eyeSep=g;this.loffset=new d.Vector2;this.roffset=new d.Vector2}function Ia(g){var f=new d.OrthographicCamera(-1,1,1,-1,0,1),n=new d.Scene,a=new d.StereoCamera;a.aspect=.5;var b=new d.WebGLRenderTarget(512,512,{minFilter:d.LinearFilter,magFilter:d.NearestFilter,format:d.RGBAFormat});b.scissorTest=!0;b.texture.generateMipmaps=!1;var c=
new d.Vector2(.441,.156),e=(new d.PlaneBufferGeometry(1,1,10,20)).deleteAttribute("normal").toNonIndexed(),h=e.attributes.position.array,z=e.attributes.uv.array;e.attributes.position.count*=2;e.attributes.uv.count*=2;var p=new Float32Array(2*h.length);p.set(h);p.set(h,h.length);var J=new Float32Array(2*z.length);J.set(z);J.set(z,z.length);z=new d.Vector2;h=h.length/3;for(var m=0,P=p.length/3;m<P;m++){z.x=p[3*m];z.y=p[3*m+1];var k=z.dot(z);k=1.5+(c.x+c.y*k)*k;var l=m<h?0:1;p[3*m]=z.x/k*1.5-.5+l;p[3*
m+1]=z.y/k*3;J[2*m]=.5*(J[2*m]+l)}e.attributes.position.array=p;e.attributes.uv.array=J;c=new d.MeshBasicMaterial({map:b.texture});e=new d.Mesh(e,c);n.add(e);this.setEyeSeparation=function(b){a.eyeSep=b};this.setSize=function(a,c){g.setSize(a,c);var e=g.getPixelRatio();b.setSize(a*e,c*e)};this.render=function(c,e,h,d,z){var p=h instanceof Ja||h instanceof Ka;c.updateMatrixWorld();p&&this.setEyeSeparation(h.stereo.eyeSep);null===e.parent&&e.updateMatrixWorld();a.update(e);e=b.width/2;var k=b.height;
g.autoClear&&g.clear();p&&h.updateTextureToLeft();b.scissor.set(0,0,e,k);b.viewport.set(0,0,e,k);g.setRenderTarget(b);g.render(c,a.cameraL);g.clearDepth();p&&h.updateTextureToRight();b.scissor.set(e,0,e,k);b.viewport.set(e,0,e,k);g.setRenderTarget(b);g.render(c,a.cameraR);g.clearDepth();g.setRenderTarget(d?z:null);g.render(n,f)}}var v="default"in d?d["default"]:d;O=O&&Object.prototype.hasOwnProperty.call(O,"default")?O["default"]:O;var La="^0.134.0".replace(/[^0-9.]/g,""),R={ORBIT:0,DEVICEORIENTATION:1,
OBJECT:2,DRAG:3},E={UNKNOWN:0,NORMAL:1,CARDBOARD:2,STEREO:3},X={TAB:0,SBS:1},Z={X:0,Y:-200,Z:0},S={DEFAULT:"default",POINTER:"pointer",GRAB:"-webkit-grab",CROSSHAIR:"crosshair"},qa={FLOOR:"floor_ring_cursor"},aa={DEFAULT:"default",COLOR:"color",BLUR:"blur"},r={BASIC:"basic_panorama",CUBE:"cube_panorama",DOLLHOUSE:"dollhouse",IMAGE_LITTLE_PLANET:"image_little_planet",IMAGE:"image_panorama",LITTLE_PLANET:"little_planet",PANORAMA:"panorama",SLIDER:"slider_panorama",SPIN:"spin_panorama",STEREO_IMAGE:"stereo_image",
STEREO_VIDEO_PANORAMA:"stereo_video_panorama",VIDEO:"video_panorama",PROGRESSVIE_IMAGE:"progressive_image_panorama"},x={DOLLSPOT:"dollspot",FLOOR_RING_INFOSPOT:"floor_ring_infospot",INFOSPOT:"infospot",HOTSPOT:"toScene",NADIR:"nadir",SPOT_MODEL:"spot_model"},M={Info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC",
Check:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=",
WhiteTile:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIABAMAAAAGVsnJAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KAtiABQAAACRQTFRFAAAAAAAABgYGBwcHHh4eKysrx8fHy8vLzMzM7OzsAAAABgYG+q7SZgAAAAp0Uk5TAP7+/v7+/v7+/iJx/a8AAAOwSURBVHja7d0hbsNAEAVQo6SFI6XEcALDcgNLvUBvEBQVhpkWVYWlhSsVFS7t5QIshRt695lEASZP+8c7a1kzDL1fz+/zyuvzp6FbvoddrL6uDd1yGZ5eXldeb18N3fIx7A+58prmhm65DfvDcd0952lu6JabFbD/zVprZj1lzcys+fj9z8xTZtbT8rv8yWlu6BYAIgAAAAAAAAAAAABAM6QXEAEAAAAAAAAAgJ2gnaAIiIA3Q2qAGgAAAAAAAAAAAAAAAAAAAAAAAAAAQJsADkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBVlfAcZ3aeZobusUKMGBhV6KUElHGKBERJR6/fxExRkQZl9/lT8S1oVsuhqyYMmPKjCkzvfcCpsxohrwY0Q06EAEAAAAAAAAAAACgGdILiAAAAAAAAAAAwE7QTlAERMCbITVADQAAAAAAAAAAAAAAAAAAAAAAAAAAwKmwQ1ERAAAAAACPQY9BERABERABERABERABERABAAAAAAAAAICdoJ2gCIiAT2bUADVADRABEQAAQBFUBEVABERgEyvAlJm+V4ApM6bMmDJjyowpM6bMdN0LmDKjGfJiRDfoQAQAAAAAAAAAAACAZkgvIAIAAAAAAAAAADtBO0EREAFvhtQANQAAAAAAAAAAAAAAAAAAAAAAAAAAAKfCDkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBTawAU2b6XgGmzJgyY8qMKTOmzJgy03UvYMqMZsiLEd2gAxEAAAAAAAAAAAAAmiG9gAgAAAAAAAAAAOwE7QRFQAS8GVID1AAAAAAAAAAAAAAAAAAAAAAAAAAAAJwKOxQVAQAAAADwGPQYFAEREAEREAEREAEREAERAAAAAAAAAADYCdoJioAI+GRGDVAD1AAREAEAABRBRVAEREAENrECTJnpewWYMmPKjCkzpsyYMmPKTNe9gCkzmiEvRnSDDkQAAAAAAAAAAAAAaIb0AiIAAAAAAAAAALATtBMUARHwZkgNUAMAAAAAAAAAAAAAAAAAAAAAAAAAAHAq7FBUBAAAAADAY9BjUAREQAREQAREQAREQAREAAAAAAAAAABgJ2gnKAIi4JMZNUANUANEQAQAAFAEFUEREAER2MQKMGWm7xVgyowpM50PWen9ugNGXz1XaocAFgAAAABJRU5ErkJggg==",
ViewIndicator:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+",
VideoPlay:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==",VideoPause:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==",
VideoUnmute:"data:image/svg+xml;base64,PHN2ZyBpZD0iU3ZnanNTdmcxMDAxIiB3aWR0aD0iMjg4IiBoZWlnaHQ9IjI4OCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpzdmdqcz0iaHR0cDovL3N2Z2pzLmNvbS9zdmdqcyI+PGRlZnMgaWQ9IlN2Z2pzRGVmczEwMDIiPjwvZGVmcz48ZyBpZD0iU3ZnanNHMTAwOCIgdHJhbnNmb3JtPSJtYXRyaXgoMC45MTY3LDAsMCwwLjkxNjcsMTIuMTc5NDIyNTcxNTYzNzIsMTIuMjM4MTQzMTg2NTY5MjMyKSI+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyODgiIGhlaWdodD0iMjg4IiB2ZXJzaW9uPSIxLjAiIHZpZXdCb3g9IjAgMCA3NSA3NSI+PHBhdGggZmlsbD0iI2ZmZmZmZiIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjUiIGQ9Ik0zOS4zODksMTMuNzY5IEwyMi4yMzUsMjguNjA2IEw2LDI4LjYwNiBMNiw0Ny42OTkgTDIxLjk4OSw0Ny42OTkgTDM5LjM4OSw2Mi43NSBMMzkuMzg5LDEzLjc2OXoiIGNsYXNzPSJjb2xvcjExMSBzdmdTaGFwZSBjb2xvclN0cm9rZTExMSBzdmdTdHJva2UiPjwvcGF0aD48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNDgsMjcuNmExOS41LDE5LjUgMCAwIDEgMCwyMS40TTU1LjEsMjAuNWEzMCwzMCAwIDAgMSAwLDM1LjZNNjEuNiwxNGEzOC44LDM4LjggMCAwIDEgMCw0OC42IiBjbGFzcz0iY29sb3JTdHJva2UxMTEgc3ZnU3Ryb2tlIj48L3BhdGg+PC9zdmc+PC9nPjwvc3ZnPg==",
VideoMute:"data:image/svg+xml;base64,PHN2ZyBzdHJva2Utd2lkdGg9IjUiIHN0cm9rZT0id2hpdGUiIHZpZXdCb3g9IjAgMCA3NSA3NSIgaGVpZ2h0PSI1MDAiIHdpZHRoPSI1MDAiIHZlcnNpb249IjEuMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0id2hpdGUiIGQ9Im0zOSwxNC0xNywxNUg2VjQ4SDIybDE3LDE1eiI+PC9wYXRoPgo8cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiIGQ9Im00OSwyNiAyMCwyNG0wLTI0LTIwLDI0Ij48L3BhdGg+Cjwvc3ZnPg=="},ra={load:function(g){var f=1<arguments.length&&void 0!==arguments[1]?
arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){};d.Cache.enabled=!0;var b,c,e;for(m in M)M.hasOwnProperty(m)&&g===M[m]&&(e=m);var h=d.Cache.get(e?e:g);if(void 0!==h)return f&&setTimeout(function(){n({loaded:1,total:1});f(h)},0),h;var z=window.URL||window.webkitURL;var p=document.createElementNS("http://www.w3.org/1999/xhtml","img");var J=function(){var a=0<arguments.length&&void 0!==
arguments[0]?arguments[0]:!1;z.revokeObjectURL(p.src);void 0==h&&d.Cache.add(e?e:g,p);f(p,a)};if(0===g.indexOf("data:"))return p.addEventListener("load",J,!1),p.src=g,p;p.crossOrigin=void 0!==this.crossOrigin?this.crossOrigin:"";var m=new window.XMLHttpRequest;m.open("GET",g,!0);m.responseType="arraybuffer";m.addEventListener("error",a);m.addEventListener("progress",function(a){if(a){var b=a.loaded,c=a.total;a.lengthComputable&&n({loaded:b,total:c})}});m.addEventListener("loadend",function(a){if(a){a=
a.currentTarget;var e=a.status;b=new Uint8Array(a.response);c=new window.Blob([b]);p.addEventListener("load",function(){J(400<=e)},!1);p.addEventListener("error",function(){J(400<=e)},!1);p.src=z.createObjectURL(c)}});m.send(null)}},Y={load:function(g){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length?arguments[2]:void 0,a=3<arguments.length?arguments[3]:void 0,b=new d.Texture;ra.load(g,function(a){b.image=a;a=0<g.search(/\.(jpg|jpeg)$/)||0===g.search(/^data:image\/jpeg/);
b.format=a?d.RGBFormat:d.RGBAFormat;b.minFilter=b.magFilter=d.LinearFilter;b.needsUpdate=!0;f(b)},n,a);return b}};v.MTLLoader=function(d){this.manager=void 0!==d?d:v.DefaultLoadingManager};v.MTLLoader.prototype={constructor:v.MTLLoader,load:function(d,f,n,a){var b=this,c=new v.FileLoader(this.manager);c.setPath(this.path);c.load(d,function(a){f(b.parse(a))},n,a)},setPath:function(d){this.path=d;return this},setTexturePath:function(d){this.texturePath=d;return this},setBaseUrl:function(d){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.");
return this.setTexturePath(d)},setCrossOrigin:function(d){this.crossOrigin=d;return this},setMaterialOptions:function(d){this.materialOptions=d;return this},parse:function(d){var f=d.split("\n"),g={},a=/\s+/;d={};for(var b=0;b<f.length;b++){var c=f[b];c=c.trim();if(0!==c.length&&"#"!==c.charAt(0)){var e=c.indexOf(" "),h=0<=e?c.substring(0,e):c;h=h.toLowerCase();c=0<=e?c.substring(e+1):"";c=c.trim();"newmtl"===h?(g={name:c},d[c]=g):g&&("ka"===h||"kd"===h||"ks"===h?(c=c.split(a,3),g[h]=[parseFloat(c[0]),
parseFloat(c[1]),parseFloat(c[2])]):g[h]=c)}}f=new v.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);f.setCrossOrigin(this.crossOrigin);f.setManager(this.manager);f.setMaterials(d);return f}};v.MTLLoader.MaterialCreator=function(d,f){this.baseUrl=d||"";this.options=f;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:v.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:
v.RepeatWrapping};v.MTLLoader.MaterialCreator.prototype={constructor:v.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function(d){this.crossOrigin=d},setManager:function(d){this.manager=d},setMaterials:function(d){this.materialsInfo=this.convert(d);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function(d){if(!this.options)return d;var f={},g;for(g in d){var a=d[g],b={};f[g]=b;for(var c in a){var e=!0,h=a[c],z=c.toLowerCase();switch(z){case "kd":case "ka":case "ks":this.options&&
this.options.normalizeRGB&&(h=[h[0]/255,h[1]/255,h[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===h[0]&&0===h[1]&&0===h[2]&&(e=!1)}e&&(b[z]=h)}}return f},preload:function(){for(var d in this.materialsInfo)this.create(d)},getIndex:function(d){return this.nameLookup[d]},getAsArray:function(){var d=0,f;for(f in this.materialsInfo)this.materialsArray[d]=this.create(f),this.nameLookup[f]=d,d++;return this.materialsArray},create:function(d){void 0===this.materials[d]&&this.createMaterial_(d);return this.materials[d]},
createMaterial_:function(d){function f(a,b){return"string"!==typeof b||""===b?"":/^https?:\/\//i.test(b)?b:a+b}function g(b,e){if(!c[b]){e=a.getTextureParams(e,c);var h=a.loadTexture(f(a.baseUrl,e.url));h.repeat.copy(e.scale);h.offset.copy(e.offset);h.wrapS=a.wrap;h.wrapT=a.wrap;c[b]=h}}var a=this,b=this.materialsInfo[d],c={name:d,side:this.side},e;for(e in b){var h=b[e];if(""!==h)switch(e.toLowerCase()){case "kd":c.color=(new v.Color).fromArray(h);break;case "ks":c.specular=(new v.Color).fromArray(h);
break;case "map_kd":g("map",h);break;case "map_ks":g("specularMap",h);break;case "norm":g("normalMap",h);break;case "map_bump":case "bump":g("bumpMap",h);break;case "ns":c.shininess=parseFloat(h);break;case "d":h=parseFloat(h);1>h&&(c.opacity=h,c.transparent=!0);break;case "tr":h=parseFloat(h),this.options&&this.options.invertTrProperty&&(h=1-h),0<h&&(c.opacity=1-h,c.transparent=!0)}}this.materials[d]=new v.MeshPhongMaterial(c);return this.materials[d]},getTextureParams:function(d,f){var g={scale:new v.Vector2(1,
1),offset:new v.Vector2(0,0)};d=d.split(/\s+/);var a=d.indexOf("-bm");0<=a&&(f.bumpScale=parseFloat(d[a+1]),d.splice(a,2));a=d.indexOf("-s");0<=a&&(g.scale.set(parseFloat(d[a+1]),parseFloat(d[a+2])),d.splice(a,4));a=d.indexOf("-o");0<=a&&(g.offset.set(parseFloat(d[a+1]),parseFloat(d[a+2])),d.splice(a,4));g.url=d.join(" ").trim();return g},loadTexture:function(d,f,n,a,b){var c=void 0!==this.manager?this.manager:v.DefaultLoadingManager,e=c.getHandler(d);null===e&&(e=new v.TextureLoader(c));e.setCrossOrigin&&
e.setCrossOrigin(this.crossOrigin);d=e.load(d,n,a,b);void 0!==f&&(d.mapping=f);return d}};v.OBJLoader=function(){function d(){var a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(a,b){if(this.object&&!1===this.object.fromDeclaration)this.object.name=a,this.object.fromDeclaration=!1!==b;else{var c=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object&&"function"===typeof this.object._finalize&&
this.object._finalize(!0);this.object={name:a||"",fromDeclaration:!1!==b,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,b){var c=this._finalize(!1);c&&(c.inherited||0>=c.groupCount)&&this.materials.splice(c.index,1);a={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-1]:"",smooth:void 0!==c?c.smooth:this.smooth,groupStart:void 0!==c?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){a={index:"number"===
typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};a.clone=this.clone.bind(a);return a}};this.materials.push(a);return a},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(a){var b=this.currentMaterial();b&&-1===b.groupEnd&&(b.groupEnd=this.geometry.vertices.length/3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1);if(a&&1<this.materials.length)for(var c=
this.materials.length-1;0<=c;c--)0>=this.materials[c].groupCount&&this.materials.splice(c,1);a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth});return b}};c&&c.name&&"function"===typeof c.clone&&(a=c.clone(0),a.inherited=!0,this.object.materials.push(a));this.objects.push(this.object)}},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(a,b){a=parseInt(a,10);return 3*(0<=a?a-1:a+b/3)},parseNormalIndex:function(a,
b){a=parseInt(a,10);return 3*(0<=a?a-1:a+b/3)},parseUVIndex:function(a,b){a=parseInt(a,10);return 2*(0<=a?a-1:a+b/2)},addVertex:function(a,b,c){var e=this.vertices,h=this.object.geometry.vertices;h.push(e[a+0],e[a+1],e[a+2]);h.push(e[b+0],e[b+1],e[b+2]);h.push(e[c+0],e[c+1],e[c+2])},addVertexPoint:function(a){var b=this.vertices;this.object.geometry.vertices.push(b[a+0],b[a+1],b[a+2])},addVertexLine:function(a){var b=this.vertices;this.object.geometry.vertices.push(b[a+0],b[a+1],b[a+2])},addNormal:function(a,
b,c){var e=this.normals,h=this.object.geometry.normals;h.push(e[a+0],e[a+1],e[a+2]);h.push(e[b+0],e[b+1],e[b+2]);h.push(e[c+0],e[c+1],e[c+2])},addColor:function(a,b,c){var e=this.colors,h=this.object.geometry.colors;h.push(e[a+0],e[a+1],e[a+2]);h.push(e[b+0],e[b+1],e[b+2]);h.push(e[c+0],e[c+1],e[c+2])},addUV:function(a,b,c){var e=this.uvs,h=this.object.geometry.uvs;h.push(e[a+0],e[a+1]);h.push(e[b+0],e[b+1]);h.push(e[c+0],e[c+1])},addUVLine:function(a){var b=this.uvs;this.object.geometry.uvs.push(b[a+
0],b[a+1])},addFace:function(a,b,c,d,f,m,g,k,n){var e=this.vertices.length;a=this.parseVertexIndex(a,e);b=this.parseVertexIndex(b,e);c=this.parseVertexIndex(c,e);this.addVertex(a,b,c);void 0!==d&&""!==d&&(c=this.uvs.length,a=this.parseUVIndex(d,c),b=this.parseUVIndex(f,c),c=this.parseUVIndex(m,c),this.addUV(a,b,c));void 0!==g&&""!==g&&(d=this.normals.length,a=this.parseNormalIndex(g,d),b=g===k?a:this.parseNormalIndex(k,d),c=g===n?a:this.parseNormalIndex(n,d),this.addNormal(a,b,c));0<this.colors.length&&
this.addColor(a,b,c)},addPointGeometry:function(a){this.object.geometry.type="Points";for(var b=this.vertices.length,c=0,e=a.length;c<e;c++)this.addVertexPoint(this.parseVertexIndex(a[c],b))},addLineGeometry:function(a,b){this.object.geometry.type="Line";for(var c=this.vertices.length,e=this.uvs.length,h=0,d=a.length;h<d;h++)this.addVertexLine(this.parseVertexIndex(a[h],c));a=0;for(d=b.length;a<d;a++)this.addUVLine(this.parseUVIndex(b[a],e))}};a.startObject("",!1);return a}function f(a){this.manager=
void 0!==a?a:v.DefaultLoadingManager;this.materials=null}var n=/^[og]\s*(.+)?/,a=/^mtllib /,b=/^usemtl /;f.prototype={constructor:f,load:function(a,b,h,d){var c=this,e=new v.FileLoader(c.manager);e.setPath(this.path);e.load(a,function(a){b(c.parse(a))},h,d)},setPath:function(a){this.path=a;return this},setMaterials:function(a){this.materials=a;return this},parse:function(c){console.time("OBJLoader r117");var e=new d;-1!==c.indexOf("\r\n")&&(c=c.replace(/\r\n/g,"\n"));-1!==c.indexOf("\\\n")&&(c=c.replace(/\\\n/g,
""));var h=c.split("\n"),f,p="function"===typeof"".trimLeft;c=0;for(var g=h.length;c<g;c++){var m=h[c];m=p?m.trimLeft():m.trim();var l=m.length;if(0!==l&&(l=m.charAt(0),"#"!==l))if("v"===l)switch(m=m.split(/\s+/),m[0]){case "v":e.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));8===m.length&&e.colors.push(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6]));break;case "vn":e.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case "vt":e.uvs.push(parseFloat(m[1]),
parseFloat(m[2]))}else if("f"===l){m=m.substr(1).trim();var k=m.split(/\s+/);m=[];l=0;for(f=k.length;l<f;l++){var y=k[l];0<y.length&&(y=y.split("/"),m.push(y))}k=m[0];l=1;for(f=m.length-1;l<f;l++){y=m[l];var A=m[l+1];e.addFace(k[0],y[0],A[0],k[1],y[1],A[1],k[2],y[2],A[2])}}else if("l"===l){l=m.substring(1).trim().split(" ");f=[];k=[];if(-1===m.indexOf("/"))f=l;else for(m=0,y=l.length;m<y;m++)A=l[m].split("/"),""!==A[0]&&f.push(A[0]),""!==A[1]&&k.push(A[1]);e.addLineGeometry(f,k)}else if("p"===l)m=
m.substr(1).trim(),m=m.split(" "),e.addPointGeometry(m);else if(null!==(f=n.exec(m)))m=(" "+f[0].substr(1).trim()).substr(1),e.startObject(m);else if(b.test(m))e.object.startMaterial(m.substring(7).trim(),e.materialLibraries);else if(a.test(m))e.materialLibraries.push(m.substring(7).trim());else if("s"===l){if(f=m.split(" "),1<f.length?(m=f[1].trim().toLowerCase(),e.object.smooth="0"!==m&&"off"!==m):e.object.smooth=!0,m=e.object.currentMaterial())m.smooth=e.object.smooth}else if("\x00"!==m)throw Error('THREE.OBJLoader: Unexpected line: "'+
m+'"');}e.finalize();h=new v.Group;h.materialLibraries=[].concat(e.materialLibraries);c=0;for(g=e.objects.length;c<g;c++)if(p=e.objects[c],m=p.geometry,l=p.materials,f="Line"===m.type,k="Points"===m.type,y=!1,0!==m.vertices.length){A=new v.BufferGeometry;A.setAttribute("position",new v.Float32BufferAttribute(m.vertices,3));0<m.normals.length?A.setAttribute("normal",new v.Float32BufferAttribute(m.normals,3)):A.computeVertexNormals();0<m.colors.length&&(y=!0,A.setAttribute("color",new v.Float32BufferAttribute(m.colors,
3)));0<m.uvs.length&&A.setAttribute("uv",new v.Float32BufferAttribute(m.uvs,2));for(var q=[],r=0,u=l.length;r<u;r++){var t=l[r];m=void 0;if(null!==this.materials)if(m=this.materials.create(t.name),f&&m&&!(m instanceof v.LineBasicMaterial)){var Q=new v.LineBasicMaterial;Q.copy(m);Q.lights=!1;m=Q}else if(k&&m&&!(m instanceof v.PointsMaterial)){var D=new v.PointsMaterial({size:10,sizeAttenuation:!1});Q.copy(m);m=D}m||(m=f?new v.LineBasicMaterial:k?new v.PointsMaterial({size:1,sizeAttenuation:!1}):new v.MeshPhongMaterial,
m.name=t.name);m.flatShading=t.smooth?!1:!0;m.vertexColors=y?v.VertexColors:v.NoColors;q.push(m)}if(1<q.length){r=0;for(u=l.length;r<u;r++)t=l[r],A.addGroup(t.groupStart,t.groupCount,r);m=f?new v.LineSegments(A,q):k?new v.Points(A,q):new v.Mesh(A,q)}else m=f?new v.LineSegments(A,q[0]):k?new v.Points(A,q[0]):new v.Mesh(A,q[0]);m.name=p.name;h.add(m)}console.timeEnd("OBJLoader r117");return h}};return f}();var Ma=v.MTLLoader,Na=v.OBJLoader,ba=function(d){function f(){var a=0<arguments.length&&void 0!==
arguments[0]?arguments[0]:{};F(this,f);var b=g.call(this);b.options=B({},a);b.shortId=b.options.shortId;b.element=b.createElement();b.container=null;b.isSelected=!1;b.type=x.DOLLSPOT;b.addEventListener("panolens-container",b.setContainer.bind(u(b)));return b}G(f,d);var g=H(f);I(f,[{key:"updateTitle",value:function(a){this.element.innerHTML='\n      <div class="panolens-dollspot-container">\n        <div class="panolens-dollspot-title">'.concat(a,'</div>\n        <svg class="panolens-dollspot-icon" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M8 8L15 1V0H1V1L8 8Z" fill="#15A8A2"/>\n        <path d="M15 1L8 8L1 1" stroke="#F8FAFA" stroke-width="2" stroke-linecap="round"/>\n        </svg>\n      </div>\n    ')}},
{key:"select",value:function(){this.isSelected=!0}},{key:"unselect",value:function(){this.isSelected=!1}},{key:"createElement",value:function(){var a=document.createElement("div");a.innerHTML='\n      <div class="panolens-dollspot-container">\n        <div class="panolens-dollspot-title">'.concat(this.options.title||". . .",'</div>\n        <svg class="panolens-dollspot-icon" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M8 8L15 1V0H1V1L8 8Z" fill="#15A8A2"/>\n        <path d="M15 1L8 8L1 1" stroke="#F8FAFA" stroke-width="2" stroke-linecap="round"/>\n        </svg>\n      </div>\n  ');
var b=document.createElement("style");b.type="text/css";b.textContent="\n    .panolens-dollspot-container {\n    position: absolute;\n    bottom: 0;\n    left: '50%';\n    display: flex;\n    overflow: visible;\n    align-items: center;\n    flex-direction: column;\n    justify-content: flex-end;\n    transform: translate(-50%, 0);\n    filter: drop-shadow(0 1px #00000020) drop-shadow(0 3px 4px #00000020);\n    }\n\n    .panolens-dollspot-title {\n    position: relative;\n    z-index: -1;\n    bottom: -2px;\n    overflow: hidden;\n    max-width: 128px;\n    padding: 2px 12px 4px;\n    text-align: center;\n    text-overflow: ellipsis;\n    color: #FFFFFFDD;\n    border-radius: 16px;\n    background-color: #15A8A2;\n    box-shadow: inset 0 1px #00E17550;\n    font-size: 12px;\n    white-space: nowrap;\n    }\n\n    .panolens-dollspot-icon {\n    position: relative;\n    width: 16px;\n    height: 10px;\n    margin: 0 auto;\n    }\n  ";
a.append(b);document.head.append(b);a.style.display="none";a.style.position="absolute";a.style.width=0;a.style.height=0;a.style.top=0;a.style.left=0;a.classList.add("panolens-infospot");a.addEventListener("mousedown",this.onClick.bind(this));return a}},{key:"translateElement",value:function(a,b){this.element&&this.container&&(b-=this.element.clientHeight,a="translate(".concat(a-this.element.clientWidth,"px, ").concat(b,"px)"),this.element.style.transform=a,this.element.style.webkitTransform=a,this.element.style.msTransform=
a,this.element.style.display="flex")}},{key:"onClick",value:function(){this.dispatchEvent({type:"select-dollspot",dollspot:this})}},{key:"destroy",value:function(){this.element.remove()}},{key:"setContainer",value:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&this.element&&b.append(this.element);this.container=b}}]);return f}(d.Object3D),ya=function(g){function f(a,b,c){F(this,f);var e=n.call(this);e.loaded=!1;d.ImageUtils.crossOrigin="";e.mtlLoader=new Ma;
e.objLoader=new Na;e.loadMtlObj(a,b,c);e.name=r.DOLLHOUSE;e.type=r.DOLLHOUSE;e.isInfospotVisible=!1;e.container=null;e.addEventListener("click",e.onClick.bind(u(e)));e.addEventListener("panolens-container",e.setContainer.bind(u(e)));return e}G(f,g);var n=H(f);I(f,[{key:"add",value:function(a){var b=this;if(a instanceof ba){var c=this.container;a.addEventListener("select-dollspot",function(a){b.dispatchEvent({type:"dollhouse-select-dollspot",dollspot:a.dollspot})});c&&a.dispatchEvent({type:"panolens-container",
container:c});a.dispatchEvent({type:"panolens-infospot-focus",method:function(a,b,c){this.dispatchEvent({type:"panolens-viewer-handler",method:"tweenControlCenter",data:[a,b,c]})}})}t(w(f.prototype),"add",this).call(this,a);this.dispatchEvent({type:"addChild"})}},{key:"toggleInfospotVisibility",value:function(a,b){b=void 0!==b?b:0;var c=void 0!==a?a:!this.isInfospotVisible;this.traverse(function(a){a instanceof ba&&(c?a.show(b):a.hide(b))});this.isInfospotVisible=c}},{key:"onClick",value:function(a){a.intersects&&
0===a.intersects.length&&this.traverse(function(a){a.dispatchEvent({type:"dismiss"})})}},{key:"setContainer",value:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&(this.children.forEach(function(a){a instanceof ba&&a.dispatchEvent&&a.dispatchEvent({type:"panolens-container",container:b})}),this.container=b)}},{key:"loadMtlObj",value:function(a,b,c){var e=this;this.dispatchEvent({type:"load-start"});this.mtlLoader.crossOrigin="";this.mtlLoader.setPath(a);this.mtlLoader.load(b,
function(a){a.preload();e.objLoader.setMaterials(a);e.objLoader.load(c,e.onObjLoadSuccess.bind(e),e.onObjLoadProgress.bind(e),e.onObjLoadError.bind(e))})}},{key:"onObjLoadSuccess",value:function(a){this.loaded=!0;a.position.set(0,0,0);a.name="dollhouseObject";var b=new window.THREE.AmbientLight(16777215,.8);b.name="dollhouseLight";a.add(b);this.add(a);this.dispatchEvent({type:"loaded"});this.dispatchEvent({type:"ready"})}},{key:"addLight",value:function(a){var b=new window.THREE.AmbientLight(16777215,
.8);b.name="dollhouseLight";a.add(b)}},{key:"onObjLoadProgress",value:function(a){this.dispatchEvent({type:"loading",percentDownloaded:"".concat(Math.trunc(100*a.loaded/a.total))})}},{key:"onObjLoadError",value:function(a){this.dispatchEvent({type:"error"});console.error("An error happened",a.message)}},{key:"dispose",value:function(){function a(b){for(var c=b.geometry,h=b.material,d=b.children.length-1;0<=d;d--)a(b.children[d]),b.remove(b.children[d]);c&&(c.dispose(),b.geometry=null);h&&(Array.isArray(h)?
h.forEach(function(a){return a.dispose()}):h.dispose(),b.material=null)}var b=this.material;b&&b.uniforms&&b.uniforms.tEquirect&&b.uniforms.tEquirect.value.dispose();this.dispatchEvent({type:"panolens-viewer-handler",method:"onDollhouseDispose",data:this});a(this);this.parent&&this.parent.remove(this)}}]);return f}(d.Mesh),za={load:function(g){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},a=3<arguments.length?
arguments[3]:void 0,b;var c=new d.CubeTexture([]);var e=0;var h={};var z={};g.map(function(d,g){ra.load(d,function(a){c.images[g]=a;e++;6===e&&(c.needsUpdate=!0,f(c))},function(a){h[g]={loaded:a.loaded,total:a.total};z.loaded=0;b=z.total=0;for(var c in h)b++,z.loaded+=h[c].loaded,z.total+=h[c].total;6>b&&(z.total=z.total/b*6);n(z)},a)});return c}},Aa=function(d){function f(a){F(this,f);a||console.warn("PANOLENS.Widget: No container specified");var b=g.call(this);b.DEFAULT_TRANSITION="all 0.27s ease";
b.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);b.PREVENT_EVENT_HANDLER=function(a){a.preventDefault();a.stopPropagation()};b.container=a;b.barElement=null;b.fullscreenElement=null;b.videoElement=null;b.settingElement=null;b.mainMenu=null;b.activeMainItem=null;b.activeSubMenu=null;b.mask=null;return b}G(f,d);var g=H(f);I(f,[{key:"addControlBar",value:function(){if(this.container){var a=this,b,c;var e=document.createElement("div");e.classList.add("videoWidgetBar");
e.style.width="200px";e.style.height="44px";e.style.left="50%";e.style.transform=e.style.webkitTransform=e.style.msTransform="translate(-100px, -100%)";e.style.bottom="120px";e.style.background="-webkit-".concat("linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))");e.style.background="-moz-".concat("linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))");e.style.background="-o-".concat("linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))");e.style.background="-ms-".concat("linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))");
e.style.background="linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))";e.style.transition=this.DEFAULT_TRANSITION;e.style.pointerEvents="none";e.style.position="absolute";e.isHidden=!1;e.toggle=function(){e.isHidden=!e.isHidden;b=e.isHidden?"translate(-100px, 0)":"translate(-100px, -100%)";c=e.isHidden?0:1;e.style.transform=e.style.webkitTransform=e.style.msTransform=b;e.style.opacity=c};var h=this.createDefaultMenu();this.mainMenu=this.createMainMenu(h);e.append(this.mainMenu);this.mask=h=
this.createMask();this.container.append(h);e.dispose=function(){a.fullscreenElement&&(a.fullscreenElement.remove(),a.fullscreenElement.dispose(),a.fullscreenElement=null);a.settingElement&&(a.settingElement.remove(),a.settingElement.dispose(),a.settingElement=null);a.videoElement&&(a.videoElement.remove(),a.videoElement.dispose(),a.videoElement=null)};this.container.append(e);this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0);this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,
!0);this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0);this.mask.addEventListener(a.TOUCH_ENABLED?"touchend":"click",function(b){b.preventDefault();b.stopPropagation();a.mask.hide();a.settingElement.deactivate()},!1);this.addEventListener("control-bar-toggle",e.toggle);this.barElement=e}else console.warn("Widget container not set")}},{key:"createDefaultMenu",value:function(){var a=this;var b=function(b,e){return function(){a.dispatchEvent({type:"panolens-viewer-handler",method:b,
data:e})}};return[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:b("enableControl",R.ORBIT)},{title:"Sensor",handler:b("enableControl",R.DEVICEORIENTATION)}]},{title:"Mode",subMenu:[{title:"Normal",handler:b("disableEffect")},{title:"Cardboard",handler:b("enableEffect",E.CARDBOARD)},{title:"Stereoscopic",handler:b("enableEffect",E.STEREO)}]}]}},{key:"addControlButton",value:function(a){switch(a){case "fullscreen":this.fullscreenElement=a=this.createFullscreenButton();
break;case "setting":this.settingElement=a=this.createSettingButton();break;case "video":this.videoElement=a=this.createVideoControl();break;default:return}a&&this.barElement.append(a)}},{key:"createMask",value:function(){var a=document.createElement("div");a.classList.add("videoWidgetMask");a.style.position="absolute";a.style.top=0;a.style.left=0;a.style.width="100%";a.style.height="100%";a.style.background="transparent";a.style.display="none";a.show=function(){this.style.display="block"};a.hide=
function(){this.style.display="none"};return a}},{key:"createSettingButton",value:function(){var a=this;var b=this.createCustomItem({style:{backgroundImage:'url("'.concat(M.Setting,'")'),webkitTransition:this.DEFAULT_TRANSITION,transition:this.DEFAULT_TRANSITION},onTap:function(b){b.preventDefault();b.stopPropagation();a.mainMenu.toggle();this.activated?this.deactivate():this.activate()}});b.activate=function(){this.style.transform="rotate3d(0,0,1,90deg)";this.activated=!0;a.mask.show()};b.deactivate=
function(){this.style.transform="rotate3d(0,0,0,0)";this.activated=!1;a.mask.hide();a.mainMenu&&a.mainMenu.visible&&a.mainMenu.hide();a.activeSubMenu&&a.activeSubMenu.visible&&a.activeSubMenu.hide();a.mainMenu&&a.mainMenu._width&&(a.mainMenu.changeSize(a.mainMenu._width),a.mainMenu.unslideAll())};b.activated=!1;return b}},{key:"createFullscreenButton",value:function(){function a(){e&&(c=!c,d.style.backgroundImage=c?'url("'.concat(M.FullscreenLeave,'")'):'url("'.concat(M.FullscreenEnter,'")'));b.dispatchEvent({type:"panolens-viewer-handler",
method:"onWindowResize"});e=!0}var b=this,c=!1,e=!0,h=this.container;if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled){document.addEventListener("fullscreenchange",a,!1);document.addEventListener("webkitfullscreenchange",a,!1);document.addEventListener("mozfullscreenchange",a,!1);document.addEventListener("MSFullscreenChange",a,!1);var d=this.createCustomItem({style:{backgroundImage:'url("'.concat(M.FullscreenEnter,'")')},
onTap:function(a){a.preventDefault();a.stopPropagation();e=!1;c?(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&document.webkitExitFullscreen(),c=!1):(h.requestFullscreen&&h.requestFullscreen(),h.msRequestFullscreen&&h.msRequestFullscreen(),h.mozRequestFullScreen&&h.mozRequestFullScreen(),h.webkitRequestFullscreen&&h.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),
c=!0);this.style.backgroundImage=c?'url("'.concat(M.FullscreenLeave,'")'):'url("'.concat(M.FullscreenEnter,'")')}});if(!document.querySelector("panolens-style-addon")){var f=document.createElement("style");f.id="panolens-style-addon";f.innerHTML=":-webkit-full-screen { width: 100% !important; height: 100% !important }";document.body.append(f)}return d}}},{key:"createVideoControl",value:function(){var a=document.createElement("span");a.style.display="none";a.show=function(){a.style.display=""};a.hide=
function(){a.style.display="none";a.controlButton.paused=!0;a.controlButton.update()};a.controlButton=this.createVideoControlButton();a.soundButton=this.createVideoSoundButton();a.seekBar=this.createVideoControlSeekbar();a.append(a.controlButton);a.append(a.seekBar);a.append(a.soundButton);a.dispose=function(){a.controlButton.remove();a.seekBar.remove();a.controlButton.dispose();a.controlButton=null;a.seekBar.dispose();a.seekBar=null};this.addEventListener("video-control-show",a.show);this.addEventListener("video-control-hide",
a.hide);return a}},{key:"createVideoControlButton",value:function(){var a=this,b=this.createCustomItem({style:{"float":"left",backgroundImage:'url("'.concat(M.VideoPlay,'")')},onTap:function(c){c.preventDefault();c.stopPropagation();a.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoPlay",data:!this.paused});this.paused=!this.paused;b.update()}});b.paused=!0;b.update=function(a){this.paused=void 0!==a?a:this.paused;this.style.backgroundImage='url("'.concat(this.paused?M.VideoPlay:
M.VideoPause,'")')};return b}},{key:"createVideoSoundButton",value:function(){var a=this,b=this.createCustomItem({style:{"float":"left",backgroundImage:'url("'.concat(M.VideoMute,'")')},onTap:function(c){c.preventDefault();c.stopPropagation();a.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoSound"});this.muted=!this.muted;b.update()}});this.muted=!0;b.update=function(a){this.muted=void 0!==a?a:this.muted;this.style.backgroundImage='url("'.concat(this.muted?M.VideoUnmute:M.VideoMute,
'")')};return b}},{key:"createVideoControlSeekbar",value:function(){function a(a){a.stopPropagation();d=!0;f=a.clientX||a.changedTouches&&a.changedTouches[0].clientX;g=Number.parseInt(n.style.width)/100;h.container.addEventListener("mousemove",b,{passive:!0});h.container.addEventListener("mouseup",c,{passive:!0});h.container.addEventListener("touchmove",b,{passive:!0});h.container.addEventListener("touchend",c,{passive:!0})}function b(a){d&&(m=((a.clientX||a.changedTouches&&a.changedTouches[0].clientX)-
f)/l.clientWidth,m=g+m,m=1<m?1:0>m?0:m,l.setProgress(m),h.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:m}))}function c(a){a.stopPropagation();d=!1;e()}function e(){h.container.removeEventListener("mousemove",b,!1);h.container.removeEventListener("mouseup",c,!1);h.container.removeEventListener("touchmove",b,!1);h.container.removeEventListener("touchend",c,!1)}var h=this,d=!1,f,g,m;var n=document.createElement("div");n.style.width="0%";n.style.height="100%";n.style.backgroundColor=
"#fff";var k=document.createElement("div");k.style["float"]="right";k.style.width="14px";k.style.height="14px";k.style.transform="translate(7px, -5px)";k.style.borderRadius="50%";k.style.backgroundColor="#ddd";k.addEventListener("mousedown",a,{passive:!0});k.addEventListener("touchstart",a,{passive:!0});n.append(k);var l=this.createCustomItem({style:{"float":"left",width:"110px",display:"flex",height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:function(a){a.preventDefault();
a.stopPropagation();if(a.target!==k){var b=a.changedTouches&&0<a.changedTouches.length?(a.changedTouches[0].pageX-a.target.getBoundingClientRect().left)/this.clientWidth:a.offsetX/this.clientWidth;h.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:b});l.setProgress(a.offsetX/this.clientWidth)}},onDispose:function(){e();k=n=null}});l.append(n);l.setProgress=function(a){n.style.width="".concat(100*a,"%")};this.addEventListener("video-update",function(a){l.setProgress(a.percentage)});
l.progressElement=n;l.progressElementControl=k;return l}},{key:"createMenuItem",value:function(a){var b=this,c=document.createElement("a");c.textContent=a;c.style.display="block";c.style.padding="10px";c.style.textDecoration="none";c.style.cursor="pointer";c.style.pointerEvents="auto";c.style.transition=this.DEFAULT_TRANSITION;c.slide=function(a){this.style.transform="translateX(".concat(a?"":"-","100%)")};c.unslide=function(){this.style.transform="translateX(0)"};c.setIcon=function(a){this.icon&&
(this.icon.style.backgroundImage="url(".concat(a,")"))};c.setSelectionTitle=function(a){this.selection&&(this.selection.textContent=a)};c.addSelection=function(a){var b=document.createElement("span");b.style.fontSize="13px";b.style.fontWeight="300";b.style["float"]="right";this.selection=b;this.setSelectionTitle(a);this.append(b);return this};c.addIcon=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:M.ChevronRight,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,
c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,d=document.createElement("span");d.style["float"]=b?"left":"right";d.style.width="17px";d.style.height="17px";d.style["margin".concat(b?"Right":"Left")]="12px";d.style.backgroundSize="cover";c&&(d.style.transform="rotateZ(180deg)");this.icon=d;this.setIcon(a);this.append(d);return this};c.addSubMenu=function(a,c){this.subMenu=b.createSubMenu(a,c);return this};c.addEventListener("mouseenter",function(){this.style.backgroundColor="#e0e0e0"},
!1);c.addEventListener("mouseleave",function(){this.style.backgroundColor="#fafafa"},!1);return c}},{key:"createMenuItemHeader",value:function(a){a=this.createMenuItem(a);a.style.borderBottom="1px solid #333";a.style.paddingBottom="15px";return a}},{key:"createMainMenu",value:function(a){function b(a){a.preventDefault();a.stopPropagation();var b=c.mainMenu,e=this.subMenu;b.hide();b.slideAll();b.parentElement.append(e);c.activeMainItem=this;c.activeSubMenu=e;window.requestAnimationFrame(function(){b.changeSize(e.clientWidth);
e.show();e.unslideAll()})}var c=this,e=this.createMenu();e._width=200;e.changeSize(e._width);a=W(a);var h;try{for(a.s();!(h=a.n()).done;){var d=h.value,f=e.addItem(d.title);f.style.paddingLeft="20px";f.addIcon().addEventListener(c.TOUCH_ENABLED?"touchend":"click",b,!1);d.subMenu&&0<d.subMenu.length&&f.addSelection(d.subMenu[0].title).addSubMenu(d.title,d.subMenu)}}catch(J){a.e(J)}finally{a.f()}return e}},{key:"createSubMenu",value:function(a,b){function c(a){a.preventDefault();a.stopPropagation();
h=e.mainMenu;h.changeSize(h._width);h.unslideAll();h.show();d.slideAll(!0);d.hide();"header"!==this.type&&(d.setActiveItem(this),e.activeMainItem.setSelectionTitle(this.textContent),this.handler&&this.handler())}var e=this,h,d=this.createMenu();d.items=b;d.activeItem=null;d.addHeader(a).addIcon(void 0,!0,!0).addEventListener(e.TOUCH_ENABLED?"touchend":"click",c,!1);a=W(b);var f;try{for(a.s();!(f=a.n()).done;){var g=f.value,m=d.addItem(g.title);m.style.fontWeight=300;m.handler=g.handler;m.addIcon(" ",
!0);m.addEventListener(e.TOUCH_ENABLED?"touchend":"click",c,!1);d.activeItem||d.setActiveItem(m)}}catch(P){a.e(P)}finally{a.f()}d.slideAll(!0);return d}},{key:"createMenu",value:function(){var a=this,b=document.createElement("span"),c=b.style;c.padding="5px 0";c.position="fixed";c.bottom="100%";c.right="14px";c.backgroundColor="#fafafa";c.fontFamily="Helvetica Neue";c.fontSize="14px";c.visibility="hidden";c.opacity=0;c.boxShadow="0 0 12pt rgba(0,0,0,0.25)";c.borderRadius="2px";c.overflow="hidden";
c.willChange="width, height, opacity";c.pointerEvents="auto";c.transition=this.DEFAULT_TRANSITION;b.visible=!1;b.changeSize=function(a,b){a&&(this.style.width="".concat(a,"px"));b&&(this.style.height="".concat(b,"px"))};b.show=function(){this.style.opacity=1;this.style.visibility="visible";this.visible=!0};b.hide=function(){this.style.opacity=0;this.style.visibility="hidden";this.visible=!1};b.toggle=function(){this.visible?this.hide():this.show()};b.slideAll=function(a){for(var c=0;c<b.children.length;c++)b.children[c].slide&&
b.children[c].slide(a)};b.unslideAll=function(){for(var a=0;a<b.children.length;a++)b.children[a].unslide&&b.children[a].unslide()};b.addHeader=function(b){b=a.createMenuItemHeader(b);b.type="header";this.append(b);return b};b.addItem=function(b){b=a.createMenuItem(b);b.type="item";this.append(b);return b};b.setActiveItem=function(a){this.activeItem&&this.activeItem.setIcon(" ");a.setIcon(M.Check);this.activeItem=a};b.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0);b.addEventListener("mouseup",
this.PREVENT_EVENT_HANDLER,!0);b.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0);return b}},{key:"createCustomItem",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=this,c=a.element||document.createElement("span"),e=a.onDispose;c.style.cursor="pointer";c.style["float"]="right";c.style.width="44px";c.style.height="100%";c.style.backgroundSize="60%";c.style.backgroundRepeat="no-repeat";c.style.backgroundPosition="center";c.style.webkitUserSelect=c.style.MozUserSelect=
c.style.userSelect="none";c.style.position="relative";c.style.pointerEvents="auto";c.addEventListener(b.TOUCH_ENABLED?"touchstart":"mouseenter",function(){c.style.filter=c.style.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"},{passive:!0});c.addEventListener(b.TOUCH_ENABLED?"touchend":"mouseleave",function(){c.style.filter=c.style.webkitFilter=""},{passive:!0});this.mergeStyleOptions(c,a.style);a.onTap&&c.addEventListener(b.TOUCH_ENABLED?"touchend":"click",a.onTap,!1);c.dispose=function(){c.removeEventListener(b.TOUCH_ENABLED?
"touchend":"click",a.onTap,!1);if(e)a.onDispose()};return c}},{key:"mergeStyleOptions",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c;for(c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c]);return a}},{key:"dispose",value:function(){this.barElement&&(this.barElement.remove(),this.barElement.dispose(),this.barElement=null)}}]);return f}(d.EventDispatcher),Ba=function(g){function f(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:16777215,b=1<arguments.length&&
void 0!==arguments[1]?arguments[1]:!0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1500;F(this,f);var e=window.devicePixelRatio,h=function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=32*e;a.height=32*e;b.scale(e,e);b.shadowBlur=5;b.shadowColor="rgba(200,200,200,0.9)";return{canvas:a,context:b}}(),g=h.canvas;h=h.context;var p=new d.SpriteMaterial({color:a,map:function(a){a=new d.CanvasTexture(a);a.minFilter=d.LinearFilter;a.magFilter=d.LinearFilter;a.generateMipmaps=
!1;return a}(g)});p=n.call(this,p);p.dpr=e;p.canvasWidth=g.width;p.canvasHeight=g.height;p.context=h;p.color=a instanceof d.Color?a:new d.Color(a);p.autoSelect=b;p.dwellTime=c;p.rippleDuration=500;p.position.z=-10;p.center.set(.5,.5);p.scale.set(.5,.5,1);p.startTimestamp=null;p.timerId=null;p.callback=null;p.frustumCulled=!1;p.updateCanvasArcByProgress(0);return p}G(f,g);var n=H(f);I(f,[{key:"setColor",value:function(a){this.material.color.copy(a instanceof d.Color?a:new d.Color(a))}},{key:"updateCanvasArcByProgress",
value:function(a){var b=this.context,c=this.canvasWidth,e=this.canvasHeight,h=this.material,d=this.dpr,f=a*Math.PI*2,g=this.color.getStyle(),m=.5*c/d;d=.5*e/d;b.clearRect(0,0,c,e);b.beginPath();0===a?(b.arc(m,d,c/16,0,2*Math.PI),b.fillStyle=g,b.fill()):(b.arc(m,d,c/4-3,-Math.PI/2,-Math.PI/2+f),b.strokeStyle=g,b.lineWidth=3,b.stroke());b.closePath();h.map.needsUpdate=!0}},{key:"ripple",value:function(){var a=this,b=this.context,c=this.canvasWidth,e=this.canvasHeight,h=this.material,d=this.rippleDuration,
f=performance.now(),g=this.color,m=this.dpr,n=.5*c/m,k=.5*e/m;this.dispatchEvent({type:"reticle-ripple-start"});(function A(){var p=window.requestAnimationFrame(A),z=(performance.now()-f)/d,l=0<1-z?1-z:0,J=z*c*.5/m;b.clearRect(0,0,c,e);b.beginPath();b.arc(n,k,J,0,2*Math.PI);b.fillStyle="rgba(".concat(255*g.r,", ").concat(255*g.g,", ").concat(255*g.b,", ").concat(l,")");b.fill();b.closePath();1<=z&&(window.cancelAnimationFrame(p),a.updateCanvasArcByProgress(0),a.dispatchEvent({type:"reticle-ripple-end"}));
h.map.needsUpdate=!0})()}},{key:"show",value:function(){this.visible=!0}},{key:"hide",value:function(){this.visible=!1}},{key:"start",value:function(a){this.autoSelect&&(this.dispatchEvent({type:"reticle-start"}),this.startTimestamp=performance.now(),this.callback=a,this.update())}},{key:"end",value:function(){this.startTimestamp&&(window.cancelAnimationFrame(this.timerId),this.updateCanvasArcByProgress(0),this.startTimestamp=this.timerId=this.callback=null,this.dispatchEvent({type:"reticle-end"}))}},
{key:"update",value:function(){this.timerId=window.requestAnimationFrame(this.update.bind(this));var a=(performance.now()-this.startTimestamp)/this.dwellTime;this.updateCanvasArcByProgress(a);this.dispatchEvent({type:"reticle-update",progress:a});1<=a&&(window.cancelAnimationFrame(this.timerId),this.callback&&this.callback(),this.end(),this.ripple())}}]);return f}(d.Sprite),T=function(g){function f(){F(this,f);var a=n.call(this,f.createGeometry(),f.createMaterial());a.subtype="hotspotPlane";a.position.set(Z.X,
Z.Y,Z.Z);a.rotateX(-Math.PI/2);return a}G(f,g);var n=H(f);I(f,[{key:"dispose",value:function(){var a=this.geometry,b=this.material,c=b.map;this.parent&&this.parent.remove(this);c&&(c.dispose(),b.map=null);a&&(a.dispose(),this.geometry=null);b&&(b.dispose(),this.material=null)}}],[{key:"createGeometry",value:function(){return new d.PlaneBufferGeometry(3E3,3E3,1,1)}},{key:"createMaterial",value:function(){return new d.MeshBasicMaterial({color:0,side:d.DoubleSide,opacity:0,transparent:!0})}}]);return f}(d.Mesh),
q=function(d,f){return f={exports:{}},d(f,f.exports),f.exports}(function(d,f){f=function(){this._tweens={};this._tweensAddedDuringUpdate={}};f.prototype={getAll:function(){return Object.keys(this._tweens).map(function(a){return this._tweens[a]}.bind(this))},removeAll:function(){this._tweens={}},add:function(a){this._tweens[a.getId()]=a;this._tweensAddedDuringUpdate[a.getId()]=a},remove:function(a){delete this._tweens[a.getId()];delete this._tweensAddedDuringUpdate[a.getId()]},update:function(a,b){var c=
Object.keys(this._tweens);if(0===c.length)return!1;for(a=void 0!==a?a:g.now();0<c.length;){this._tweensAddedDuringUpdate={};for(var e=0;e<c.length;e++){var h=this._tweens[c[e]];h&&!1===h.update(a)&&(h._isPlaying=!1,b||delete this._tweens[c[e]])}c=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var g=new f;g.Group=f;g._nextId=0;g.nextId=function(){return g._nextId++};g.now="undefined"===typeof self&&"undefined"!==typeof process&&process.hrtime?function(){var a=process.hrtime();return 1E3*a[0]+
a[1]/1E6}:"undefined"!==typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()};g.Tween=function(a,b){this._object=a;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1E3;this._repeat=0;this._repeatDelayTime=void 0;this._reversed=this._isPlaying=this._yoyo=!1;this._delayTime=0;this._startTime=null;this._easingFunction=g.Easing.Linear.None;this._interpolationFunction=
g.Interpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=!1;this._onStopCallback=this._onCompleteCallback=this._onRepeatCallback=this._onUpdateCallback=null;this._group=b||g;this._id=g.nextId()};g.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(a,b){this._valuesEnd=Object.create(a);void 0!==b&&(this._duration=b);return this},duration:function(a){this._duration=a;return this},start:function(a){this._group.add(this);
this._isPlaying=!0;this._onStartCallbackFired=!1;this._startTime=void 0!==a?"string"===typeof a?g.now()+parseFloat(a):a:g.now();this._startTime+=this._delayTime;for(var b in this._valuesEnd){if(this._valuesEnd[b]instanceof Array){if(0===this._valuesEnd[b].length)continue;this._valuesEnd[b]=[this._object[b]].concat(this._valuesEnd[b])}void 0!==this._object[b]&&(this._valuesStart[b]=this._object[b],!1===this._valuesStart[b]instanceof Array&&(this._valuesStart[b]*=1),this._valuesStartRepeat[b]=this._valuesStart[b]||
0)}return this},stop:function(){if(!this._isPlaying)return this;this._group.remove(this);this._isPlaying=!1;null!==this._onStopCallback&&this._onStopCallback(this._object);this.stopChainedTweens();return this},end:function(){this.update(Infinity);return this},stopChainedTweens:function(){for(var a=0,b=this._chainedTweens.length;a<b;a++)this._chainedTweens[a].stop()},group:function(a){this._group=a;return this},delay:function(a){this._delayTime=a;return this},repeat:function(a){this._repeat=a;return this},
repeatDelay:function(a){this._repeatDelayTime=a;return this},yoyo:function(a){this._yoyo=a;return this},easing:function(a){this._easingFunction=a;return this},interpolation:function(a){this._interpolationFunction=a;return this},chain:function(){this._chainedTweens=arguments;return this},onStart:function(a){this._onStartCallback=a;return this},onUpdate:function(a){this._onUpdateCallback=a;return this},onRepeat:function(a){this._onRepeatCallback=a;return this},onComplete:function(a){this._onCompleteCallback=
a;return this},onStop:function(a){this._onStopCallback=a;return this},update:function(a){var b;if(a<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0);var c=(a-this._startTime)/this._duration;c=0===this._duration||1<c?1:c;var e=this._easingFunction(c);for(b in this._valuesEnd)if(void 0!==this._valuesStart[b]){var h=this._valuesStart[b]||0,d=this._valuesEnd[b];d instanceof Array?this._object[b]=
this._interpolationFunction(d,e):("string"===typeof d&&(d="+"===d.charAt(0)||"-"===d.charAt(0)?h+parseFloat(d):parseFloat(d)),"number"===typeof d&&(this._object[b]=h+(d-h)*e))}null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,c);if(1===c)if(0<this._repeat){isFinite(this._repeat)&&this._repeat--;for(b in this._valuesStartRepeat)"string"===typeof this._valuesEnd[b]&&(this._valuesStartRepeat[b]+=parseFloat(this._valuesEnd[b])),this._yoyo&&(c=this._valuesStartRepeat[b],this._valuesStartRepeat[b]=
this._valuesEnd[b],this._valuesEnd[b]=c),this._valuesStart[b]=this._valuesStartRepeat[b];this._yoyo&&(this._reversed=!this._reversed);this._startTime=void 0!==this._repeatDelayTime?a+this._repeatDelayTime:a+this._delayTime;null!==this._onRepeatCallback&&this._onRepeatCallback(this._object)}else{null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);a=0;for(b=this._chainedTweens.length;a<b;a++)this._chainedTweens[a].start(this._startTime+this._duration);return!1}return!0}};g.Easing=
{Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*
a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-
a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:-Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)},Out:function(a){return 0===a?0:1===a?1:Math.pow(2,-10*a)*Math.sin(5*(a-.1)*Math.PI)+1},InOut:function(a){if(0===a)return 0;if(1===a)return 1;a*=2;return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(5*(a-1.1)*Math.PI):.5*Math.pow(2,-10*(a-1))*Math.sin(5*(a-1.1)*Math.PI)+
1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-g.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*g.Easing.Bounce.In(2*a):.5*g.Easing.Bounce.Out(2*
a-1)+.5}}};g.Interpolation={Linear:function(a,b){var c=a.length-1,e=c*b,d=Math.floor(e),f=g.Interpolation.Utils.Linear;return 0>b?f(a[0],a[1],e):1<b?f(a[c],a[c-1],c-e):f(a[d],a[d+1>c?c:d+1],e-d)},Bezier:function(a,b){for(var c=0,e=a.length-1,d=Math.pow,f=g.Interpolation.Utils.Bernstein,p=0;p<=e;p++)c+=d(1-b,e-p)*d(b,p)*a[p]*f(e,p);return c},CatmullRom:function(a,b){var c=a.length-1,e=c*b,d=Math.floor(e),f=g.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(d=Math.floor(e=c*(1+b))),f(a[(d-1+
c)%c],a[d],a[(d+1)%c],a[(d+2)%c],e-d)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-e)-a[0]):1<b?a[c]-(f(a[c],a[c],a[c-1],a[c-1],e-c)-a[c]):f(a[d?d-1:0],a[d],a[c<d+1?c:d+1],a[c<d+2?c:d+2],e-d)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=g.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c=1;if(a[b])return a[b];for(var e=b;1<e;e--)c*=e;return a[b]=c}}(),CatmullRom:function(a,b,c,e,d){a=.5*(c-a);e=.5*(e-b);var h=d*d;return(2*
b-2*c+a+e)*d*h+(-3*b+3*c-2*a-e)*h+a*d+b}}};d.exports=g}),Ca=function(g){function f(){F(this,f);var a=n.call(this,f.createGeometry(),f.createMaterial(.7));a.defaultOpacity=.7;a.type=qa.FLOOR;a.enabled=!0;a.visible=!1;a.rotateX(-Math.PI/2);a.scale.set(25,25,25);a.fadeOut=(new q.Tween(a.material)).to({opacity:0});a.fadeIn=(new q.Tween(a.material)).to({opacity:a.defaultOpacity});a.fadeTimeout=null;a.onMove=function(){a.visible?a.show():a.hide()};return a}G(f,g);var n=H(f);I(f,[{key:"show",value:function(){this.visible||
(this.fadeOut.stop(),this.fadeIn.start(),this.visible=!0)}},{key:"hide",value:function(){this.visible&&(this.fadeIn.stop(),this.fadeOut.start(),this.visible=!1)}},{key:"enable",value:function(){this.enabled||(this.fadeOut.stop(),this.fadeIn.start(),this.enabled=this.visible=!0)}},{key:"disable",value:function(){this.enabled&&(this.fadeOut.stop(),this.fadeIn.start(),this.enabled=this.visible=!1)}}],[{key:"createGeometry",value:function(){return new d.RingGeometry(1.4,1,30)}},{key:"createMaterial",
value:function(a){return new d.MeshBasicMaterial({color:16777215,opacity:a,transparent:!0,side:d.DoubleSide})}}]);return f}(d.Mesh),Oa=function(g){function f(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:25,b=1<arguments.length?arguments[1]:void 0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};F(this,f);var e=n.call(this);e.hoverOpacity=void 0!==c.opacity?.7*c.opacity:.7;e.defaultOpacity=void 0!==c.opacity?.4*c.opacity:.4;e.baseColor=c.baseColor?new d.Color(c.baseColor):
new d.Color(16777215);e.showTitleHotspotInfospot=void 0!==c.showTitleHotspotInfospot?c.showTitleHotspotInfospot:!1;e.isHiddenDuringTransition=!1;e.options=B({isHide:!1},c);c=new d.TextureLoader;e.type=x.FLOOR_RING_INFOSPOT;e.subtype=x.FLOOR_RING_INFOSPOT;e.animated=void 0!==b?b:!0;e.isHovering=!1;e.element=null;e.toPanorama=null;e.cursorStyle=null;e.mode=E.NORMAL;e.loaded=!1;e.scale.set(a,a,a);e.rotateX(-Math.PI/2);e.container=null;e.originalRaycast=e.raycast;e.HANDLER_FOCUS=null;e.geometry=new d.CircleGeometry(1.4,
30,1,2*Math.PI);e.material.depthTest=!1;e.material.transparent=!0;e.material.opacity=0;e.hoverEnterAnimation=new q.Tween;e.hoverLeaveAnimation=new q.Tween;a=function(a){this.material&&(this.material.color=this.baseColor,this.material.needsUpdate=!0,this.material.alphaMap=a,this.loaded=!0,this.hoverEnterAnimation=(new q.Tween(this.material)).to({opacity:this.hoverOpacity},100),this.hoverLeaveAnimation=(new q.Tween(this.material)).to({opacity:this.defaultOpacity}),this.options.isHide||this.show(100,
!0))}.bind(u(e));e.showAnimation=(new q.Tween(e.material)).to({opacity:e.defaultOpacity},100).onStart(e.enableRaycast.bind(u(e),!0)).easing(q.Easing.Quartic.Out);e.hideAnimation=(new q.Tween(e.material)).to({opacity:0},100).onStart(e.enableRaycast.bind(u(e),!1)).easing(q.Easing.Quartic.Out);e.addEventListener("click",e.onClick);e.addEventListener("hover",e.onHover);e.addEventListener("hoverenter",e.onHoverStart);e.addEventListener("hoverleave",e.onHoverEnd);e.addEventListener("panolens-dual-eye-effect",
e.onDualEyeEffect);e.addEventListener("panolens-container",e.setContainer.bind(u(e)));e.addEventListener("dismiss",e.onDismiss);e.addEventListener("panolens-infospot-focus",e.setFocusMethod);e.addEventListener("parallax-transition-start",e.onTransitionStart.bind(u(e)));e.addEventListener("parallax-transition-complete",e.onTransitionComplete.bind(u(e)));e.addEventListener("not-parallax-transition-start",e.onTransitionStart.bind(u(e)));e.addEventListener("not-parallax-transition-complete",e.onTransitionComplete.bind(u(e)));
c.load("data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjE0MCIgdmlld0JveD0iMCAwIDE0MCAxNDAiIHdpZHRoPSIxNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTAgMGgxNDB2MTQwaC0xNDB6IiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNzAiIGN5PSI3MCIgZmlsbD0iIzAwMCIgcj0iNTAiLz48L3N2Zz4=",a);return e}G(f,g);var n=H(f);I(f,[{key:"setContainer",value:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&this.element&&b.append(this.element);this.container=b}},{key:"getContainer",
value:function(){return this.container}},{key:"onClick",value:function(a){this.element&&this.getContainer()&&(this.onHoverStart(a),this.lockHoverElement())}},{key:"onDismiss",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;this.element&&(this.unlockHoverElement(),this.onHoverEnd(a))}},{key:"onHover",value:function(a){if(this.isVisible&&!this.isHovering)this.onHoverStart(a)}},{key:"onHoverStart",value:function(a){var b=this;if(this.loaded&&!this.isHovering&&this.isVisible&&
this.getContainer()){var c=this.cursorStyle||(this.mode===E.NORMAL?S.POINTER:S.DEFAULT),e=this.hoverEnterAnimation,d=this.hoverLeaveAnimation,f=this.element;this.isHovering=!0;this.container.style.cursor=c;setTimeout(function(){b.container.style.cursor=c},0);this.animated&&(d.stop(),e.start());f&&0<=a.mouseEvent.clientX&&0<=a.mouseEvent.clientY&&(a=f.left,e=f.right,d=f.style,this.mode===E.CARDBOARD||this.mode===E.STEREO?(d.display="none",a.style.display="block",e.style.display="block",f._width=a.clientWidth,
f._height=a.clientHeight):(d.display="block",a&&(a.style.display="none"),e&&(e.style.display="none"),f._width=f.clientWidth,f._height=f.clientHeight))}}},{key:"onHoverEnd",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;if(this.getContainer()){var b=this.hoverLeaveAnimation,c=this.hoverEnterAnimation,e=this.element;this.isHovering=!1;a&&(this.container.style.cursor=S.GRAB);this.animated&&(c.stop(),b.start());e&&!this.element.locked&&(a=e.left,b=e.right,e.style.display=
"none",a&&(a.style.display="none"),b&&(b.style.display="none"),this.unlockHoverElement())}}},{key:"onDualEyeEffect",value:function(a){if(this.getContainer()){this.mode=a.mode;a=this.element;var b=this.container.clientWidth/2;var c=this.container.clientHeight/2;a&&(a.left||a.right||(a.left=a.cloneNode(!0),a.right=a.cloneNode(!0)),this.mode===E.CARDBOARD||this.mode===E.STEREO?(a.left.style.display=a.style.display,a.right.style.display=a.style.display,a.style.display="none"):(a.style.display=a.left.style.display,
a.left.style.display="none",a.right.style.display="none"),this.translateElement(b,c),this.container.append(a.left),this.container.append(a.right))}}},{key:"translateElement",value:function(a,b){if(this.element&&this.element._width&&this.element._height&&this.getContainer()){var c=this.container;var e=this.element;var d=e._width/2;var f=e._height/2;var g=void 0!==e.verticalDelta?e.verticalDelta:40;var n=a-d;var m=b-f-g;this.mode!==E.CARDBOARD&&this.mode!==E.STEREO||!e.left||!e.right||a===c.clientWidth/
2&&b===c.clientHeight/2?this.setElementStyle("transform",e,"translate(".concat(n,"px, ").concat(m,"px)")):(n=c.clientWidth/4-d+(a-c.clientWidth/2),m=c.clientHeight/2-f-g+(b-c.clientHeight/2),this.setElementStyle("transform",e.left,"translate(".concat(n,"px, ").concat(m,"px)")),n+=c.clientWidth/2,this.setElementStyle("transform",e.right,"translate(".concat(n,"px, ").concat(m,"px)")))}}},{key:"setElementStyle",value:function(a,b,c){b=b.style;"transform"===a&&(b.webkitTransform=b.msTransform=b.transform=
c)}},{key:"setText",value:function(a){this.element&&(this.element.textContent=a)}},{key:"setCursorHoverStyle",value:function(a){this.cursorStyle=a}},{key:"addHoverText",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:40;this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",
this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=b);this.setText(a)}},{key:"addHoverElement",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:40;this.element||(this.element=a.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=
b)}},{key:"removeHoverElement",value:function(){this.element&&(this.element.left&&(this.element.left.remove(),this.element.left=null),this.element.right&&(this.element.right.remove(),this.element.right=null),this.element.remove(),this.element=null)}},{key:"lockHoverElement",value:function(){this.element&&(this.element.locked=!0)}},{key:"unlockHoverElement",value:function(){this.element&&(this.element.locked=!1)}},{key:"enableRaycast",value:function(){this.raycast=(0<arguments.length&&void 0!==arguments[0]?
arguments[0]:1)?this.originalRaycast:function(){}}},{key:"show",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,b=this.hideAnimation,c=this.showAnimation,e=this.material,d=this.defaultOpacity;this.animated&&this.loaded?(b.stop(),c.delay(a).start()):(this.enableRaycast(!0),e.opacity=d);this.isVisible=!0}},{key:"hide",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,b=this.hideAnimation,c=this.showAnimation,e=this.material;this.animated&&
this.loaded?(c.stop(),b.delay(a).start()):(this.enableRaycast(!1),e.opacity=0);this.isVisible=!1}},{key:"setFocusMethod",value:function(a){a&&(this.HANDLER_FOCUS=a.method)}},{key:"focus",value:function(a,b){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,a,b),this.onDismiss())}},{key:"handleAlwaysShowTitle",value:function(a){if(this.showTitleHotspotInfospot){var b=this.element;if(b){var c=b.left,e=b.right,d=b.style;a?(a&&""!==d.transform&&!this.isHiddenDuringTransition?(d.visibility="visible",
d.display="block"):(d.display="block",d.visibility="hidden"),b._width=b.clientWidth,b._height=b.clientHeight):(d.display="none",c&&(c.style.display="none"),e&&(e.style.display="none"))}}}},{key:"onTransitionStart",value:function(){this.hide();this.isHiddenDuringTransition=!0}},{key:"onTransitionComplete",value:function(){this.show();this.isHiddenDuringTransition=!1}},{key:"dispose",value:function(){var a=this.geometry,b=this.material,c=b.map;this.removeHoverElement();this.parent&&this.parent.remove(this);
c&&(c.dispose(),b.map=null);a&&(a.dispose(),this.geometry=null);b&&(b.dispose(),this.material=null)}}]);return f}(d.Mesh),Da=function(g){function f(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:300,b=1<arguments.length?arguments[1]:void 0,c=2<arguments.length?arguments[2]:void 0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};F(this,f);b=b||M.Info;var h=n.call(this);h.type=x.INFOSPOT;h.subtype=e.isHotspot?x.HOTSPOT:x.INFOSPOT;h.animated=void 0!==c?c:!0;h.isHovering=!1;
h.showTitleHotspotInfospot=void 0!==e.showTitleHotspotInfospot?e.showTitleHotspotInfospot:!1;h.isHiddenDuringTransition=!1;h.maxOpacity=void 0!==e.opacity?1*e.opacity:1;h.minOpacity=0;h.frustumCulled=!1;h.element=null;h.toPanorama=null;h.cursorStyle=null;h.mode=E.NORMAL;h.loaded=!1;h.scale.set(a,a,1);h.rotation.y=Math.PI;h.container=null;h.originalRaycast=h.raycast;h.HANDLER_FOCUS=null;h.material.side=d.DoubleSide;h.material.depthTest=!1;h.material.transparent=!0;h.material.opacity=0;h.visible=!1;
h.shouldRender=!0;h.scaleUpAnimation=new q.Tween;h.scaleDownAnimation=new q.Tween;c=function(b){if(this.material){this.material.map=b;this.material.needsUpdate=!0;this.loaded=this.material.map.needsUpdate=!0;this._parentRatio||(this._parentRatio=1);var c=b.image.width/b.image.height,e=new d.Vector3;b.image.width=b.image.naturalWidth||64;b.image.height=b.image.naturalHeight||64;this.scale.set(c/this._parentRatio*a,a,1);this.material.needsUpdate=!0;this.material.map.needsUpdate=!0;e.copy(this.scale);
this.scaleUpAnimation=(new q.Tween(this.scale)).to({x:1.3*e.x,y:1.3*e.y},500).easing(q.Easing.Elastic.Out);this.scaleDownAnimation=(new q.Tween(this.scale)).to({x:e.x,y:e.y},500).easing(q.Easing.Elastic.Out);this.isHiddenDuringTransition||this.show(500)}}.bind(u(h));h.showAnimation=(new q.Tween(h.material)).to({opacity:h.maxOpacity},500).onStart(h.enableRaycast.bind(u(h),!0)).easing(q.Easing.Quartic.Out);h.hideAnimation=(new q.Tween(h.material)).to({opacity:0},500).onStart(h.enableRaycast.bind(u(h),
!1)).easing(q.Easing.Quartic.Out);h.addEventListener("click",h.onClick);h.addEventListener("hover",h.onHover);h.addEventListener("hoverenter",h.onHoverStart);h.addEventListener("hoverleave",h.onHoverEnd);h.addEventListener("panolens-dual-eye-effect",h.onDualEyeEffect);h.addEventListener("panolens-container",h.setContainer);h.addEventListener("dismiss",h.onDismiss);h.addEventListener("panolens-infospot-focus",h.setFocusMethod);h.addEventListener("parallax-transition-start",h.onTransitionStart.bind(u(h)));
h.addEventListener("parallax-transition-complete",h.onTransitionComplete.bind(u(h)));h.addEventListener("not-parallax-transition-start",h.onTransitionStart.bind(u(h)));h.addEventListener("not-parallax-transition-complete",h.onTransitionComplete.bind(u(h)));Y.load(b,c);return h}G(f,g);var n=H(f);I(f,[{key:"setContainer",value:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);b&&this.element&&b.append(this.element);this.container=b}},{key:"getContainer",value:function(){return this.container}},
{key:"onClick",value:function(a){this.element&&this.getContainer()&&(this.onHoverStart(a),this.lockHoverElement())}},{key:"onDismiss",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;this.element&&(this.unlockHoverElement(),this.onHoverEnd(a))}},{key:"onHover",value:function(a){if(!this.isHovering)this.onHoverStart(a)}},{key:"onHoverStart",value:function(a){var b=this;if(this.loaded&&this.getContainer()){var c=this.cursorStyle||(this.mode===E.NORMAL?S.POINTER:S.DEFAULT),
e=this.scaleDownAnimation,d=this.scaleUpAnimation,f=this.element;this.isHovering=!0;this.container.style.cursor=c;setTimeout(function(){b.container.style.cursor=c},0);this.animated&&(e.stop(),d.start());f&&0<=a.mouseEvent.clientX&&0<=a.mouseEvent.clientY&&(a=f.left,e=f.right,d=f.style,this.mode===E.CARDBOARD||this.mode===E.STEREO?(d.display="none",a.style.display="block",e.style.display="block",f._width=a.clientWidth,f._height=a.clientHeight):(d.display="block",a&&(a.style.display="none"),e&&(e.style.display=
"none"),f._width=f.clientWidth,f._height=f.clientHeight))}}},{key:"onHoverEnd",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;if(this.getContainer()){var b=this.scaleDownAnimation,c=this.scaleUpAnimation,e=this.element;this.isHovering=!1;a&&(this.container.style.cursor=S.GRAB);this.animated&&(c.stop(),b.start());e&&!this.element.locked&&(a=e.left,b=e.right,e.style.display="none",a&&(a.style.display="none"),b&&(b.style.display="none"),this.unlockHoverElement())}}},
{key:"onDualEyeEffect",value:function(a){if(this.getContainer()){this.mode=a.mode;a=this.element;var b=this.container.clientWidth/2;var c=this.container.clientHeight/2;a&&(a.left||a.right||(a.left=a.cloneNode(!0),a.right=a.cloneNode(!0)),this.mode===E.CARDBOARD||this.mode===E.STEREO?(a.left.style.display=a.style.display,a.right.style.display=a.style.display,a.style.display="none"):(a.style.display=a.left.style.display,a.left.style.display="none",a.right.style.display="none"),this.translateElement(b,
c),this.container.append(a.left),this.container.append(a.right))}}},{key:"translateElement",value:function(a,b){if(this.element&&this.element._width&&this.element._height&&this.getContainer()){var c=this.container;var e=this.element;var d=e._width/2;var f=e._height/2;var g=void 0!==e.verticalDelta?e.verticalDelta:40;var n=a-d;var m=b-f-g;this.mode!==E.CARDBOARD&&this.mode!==E.STEREO||!e.left||!e.right||a===c.clientWidth/2&&b===c.clientHeight/2?this.setElementStyle("transform",e,"translate(".concat(n,
"px, ").concat(m,"px)")):(n=c.clientWidth/4-d+(a-c.clientWidth/2),m=c.clientHeight/2-f-g+(b-c.clientHeight/2),this.setElementStyle("transform",e.left,"translate(".concat(n,"px, ").concat(m,"px)")),n+=c.clientWidth/2,this.setElementStyle("transform",e.right,"translate(".concat(n,"px, ").concat(m,"px)")))}}},{key:"setElementStyle",value:function(a,b,c){b=b.style;"transform"===a&&(b.webkitTransform=b.msTransform=b.transform=c)}},{key:"setText",value:function(a){this.element&&(this.element.textContent=
a)}},{key:"setCursorHoverStyle",value:function(a){this.cursorStyle=a}},{key:"addHoverText",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:40;this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',
this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=b);this.setText(a)}},{key:"addHoverElement",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:40;this.element||(this.element=a.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=b)}},{key:"removeHoverElement",value:function(){if(this.element){var a;
if(this.element.left){var b;null===(b=this.container)||void 0===b?void 0:b.removeChild(this.element.left);this.element.left=null}if(this.element.right){var c;null===(c=this.container)||void 0===c?void 0:c.removeChild(this.element.right);this.element.right=null}null===(a=this.container)||void 0===a?void 0:a.removeChild(this.element);this.element=null}}},{key:"lockHoverElement",value:function(){this.element&&(this.element.locked=!0)}},{key:"unlockHoverElement",value:function(){this.element&&(this.element.locked=
!1)}},{key:"enableRaycast",value:function(){this.raycast=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)?this.originalRaycast:function(){}}},{key:"show",value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,c=this.hideAnimation,e=this.showAnimation,d=this.material,f=this.maxOpacity;this.animated?(c.stop(),e.delay(b).onStart(function(){return a.visible=!0}).start()):(this.enableRaycast(!0),this.visible=!0,d.opacity=f)}},{key:"hide",value:function(){var a=
this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,c=this.hideAnimation,e=this.showAnimation,d=this.material;this.animated?(e.stop(),c.delay(b).start().onStart(function(){return a.visible=!1})):(this.enableRaycast(!1),this.visible=!1,d.opacity=0)}},{key:"setFocusMethod",value:function(a){a&&(this.HANDLER_FOCUS=a.method)}},{key:"focus",value:function(a,b){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,a,b),this.onDismiss())}},{key:"handleAlwaysShowTitle",value:function(a){if(this.showTitleHotspotInfospot){var b=
this.element;if(b){var c=b.left,e=b.right,d=b.style;a?(a&&""!==d.transform&&!this.isHiddenDuringTransition?(d.visibility="visible",d.display="block"):(d.display="block",d.visibility="hidden"),b._width=b.clientWidth,b._height=b.clientHeight):(d.display="none",c&&(c.style.display="none"),e&&(e.style.display="none"))}}}},{key:"onTransitionStart",value:function(){this.hide();this.isHiddenDuringTransition=!0}},{key:"onTransitionComplete",value:function(){this.show();this.isHiddenDuringTransition=!1}},
{key:"dispose",value:function(){var a=this.geometry,b=this.material,c=b.map;this.removeHoverElement();this.parent&&this.parent.remove(this);c&&(c.dispose(),b.map=null);a&&(a.dispose(),this.geometry=null);b&&(b.dispose(),this.material=null)}}]);return f}(d.Sprite),Pa=function(g){function f(a){F(this,f);a=B({url:"/public/nadir/nadir-default.png",scale:1,rotation:0,altitude:-199,defaultOpacity:.25,defaultHoverOpacity:.35,rateOfIncrease:100,isDefault:null!==a&&void 0!==a&&a.url?!1:!0},a);var b=n.call(this,
f.createGeometry(a.rateOfIncrease,a.scale),f.createMaterial());b.options=a;b.RATE_OF_INCREASE=1E3;b.DEFAULT_OPACITY=.25;b.DEFAULT_HOVER_OPACITY=.35;b.DEFAULT_NUMBER_OF_SEGMENTS=64;b.url=b.options.url;b.ordinaryScale=b.options.scale;b.defaultOpacity=b.options.defaultOpacity;b.defaultHoverOpacity=b.options.defaultHoverOpacity;b.rateOfIncrease=b.options.rateOfIncrease;b.isDefault=b.options.isDefault;b.geometry=new d.PlaneGeometry(b.rateOfIncrease*b.ordinaryScale,b.rateOfIncrease*b.ordinaryScale);b.setNadirProportions=
function(a,b){var c=b.image;b=c.width;c=c.height;b>c&&a.scale(1,c/b,1);b<c&&a.scale(b/c,1,1)};b.material=new d.MeshBasicMaterial;(new d.TextureLoader).load(b.url,function(a){b.setNadirProportions(b.geometry,a);b.material.map=a;b.material.needsUpdate=!0});b.material.transparent=!0;b.material.side=d.DoubleSide;b.rotation.x=-Math.PI/2;b.rotation.y=Math.PI;b.rotation.z=b.options.rotation/180*Math.PI;b.position.y=b.options.altitude;b.type=x.NADIR;b.addEventListener("parallax-transition-start",b.onParallaxTransitionStart.bind(u(b)));
b.addEventListener("parallax-transition-complete",b.onParallaxTransitionComplete.bind(u(b)));return b}G(f,g);var n=H(f);I(f,[{key:"setIsDefault",value:function(a){this.isDefault=!0;this.material.opacity=.25;this.changeTexture(a)}},{key:"setIsNotDefault",value:function(){this.isDefault=!1;this.material.opacity=1}},{key:"changeScale",value:function(a){this.ordinaryScale=a;this.geometry=new d.PlaneGeometry(this.rateOfIncrease*this.ordinaryScale,this.rateOfIncrease*this.ordinaryScale);this.setNadirProportions(this.geometry,
this.material.map)}},{key:"changeRotation",value:function(a){this.rotation.z=a/180*Math.PI}},{key:"changeTexture",value:function(a){var b=this;(new d.TextureLoader).load(a,function(a){b.geometry=new d.PlaneGeometry(b.rateOfIncrease*b.ordinaryScale,b.rateOfIncrease*b.ordinaryScale);b.setNadirProportions(b.geometry,a);b.material.map=a;b.material.needsUpdate=!0},function(a){console.log("".concat(a.loaded/a.total*100,"% loaded"))},function(a){console.log("An error happened".concat(a))})}},{key:"hide",
value:function(){this.material.opacity=0}},{key:"show",value:function(){this.material.opacity=this.isDefault?this.defaultOpacity:1}},{key:"onParallaxTransitionStart",value:function(){this.hide()}},{key:"onParallaxTransitionComplete",value:function(){this.show()}}],[{key:"createGeometry",value:function(a,b){return new d.PlaneGeometry(a*b,a*b)}},{key:"createMaterial",value:function(){return new d.MeshBasicMaterial}}]);return f}(d.Mesh),Qa={tEquirect:{value:new d.Texture},repeat:{value:new d.Vector2(1,
1)},offset:{value:new d.Vector2(0,0)},opacity:{value:1}},V=function(g){function f(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.createGeometry();var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f.createMaterial();F(this,f);a=n.call(this,a,b);a.type=r.PANORAMA;a.ImageQualityLow=1;a.ImageQualityFair=2;a.ImageQualityMedium=3;a.ImageQualityHigh=4;a.ImageQualitySuperHigh=5;a.animationDuration=1E3;a.defaultInfospotSize=350;a.container=void 0;a.loaded=!1;a.linkedSpots=[];a.isInfospotVisible=
!1;a.linkingImageURL=void 0;a.linkingImageScale=void 0;a.scale.x*=-1;a.renderOrder=-1;a.visible=!1;a.active=!1;a.infospotAnimation=(new q.Tween(u(a))).to({},a.animationDuration/2);a.addEventListener("panolens-container",a.setContainer.bind(u(a)));a.addEventListener("click",a.onClick.bind(u(a)));a.addEventListener("parallax-transition-start",a.onParallaxTransitionStart.bind(u(a)));a.addEventListener("parallax-transition-complete",a.onParallaxTransitionComplete.bind(u(a)));a.addEventListener("not-parallax-transition-start",
a.onNotParallaxTransitionStart.bind(u(a)));a.addEventListener("not-parallax-transition-complete",a.onNotParallaxTransitionComplete.bind(u(a)));a.setupTransitions();return a}G(f,g);var n=H(f);I(f,[{key:"add",value:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}a.type!==x.INFOSPOT&&a.subtype!==x.FLOOR_RING_INFOSPOT||this.dispatchInfospotListeners(a);t(w(f.prototype),"add",this).call(this,a);this.dispatchEvent({type:"addChild"})}},{key:"dispatchInfospotListeners",
value:function(a){var b=this.container;b&&a.dispatchEvent({type:"panolens-container",container:b});a.dispatchEvent({type:"panolens-infospot-focus",method:function(a,b,d){this.dispatchEvent({type:"panolens-viewer-handler",method:"tweenControlCenter",data:[a,b,d]})}})}},{key:"getTexture",value:function(){return this.material.uniforms.tEquirect.value}},{key:"load",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;this.dispatchEvent({type:"load-start"});if(a)this.onLoad()}},
{key:"onClick",value:function(a){a.intersects&&0===a.intersects.length&&this.traverse(function(a){a.dispatchEvent({type:"dismiss"})})}},{key:"setContainer",value:function(a){if(a instanceof HTMLElement)var b=a;else a&&a.container&&(b=a.container);if(b){var c=function(a){(a.type===x.INFOSPOT&&a.dispatchEvent||a.subtype===x.FLOOR_RING_INFOSPOT&&a.dispatchEvent)&&a.dispatchEvent({type:"panolens-container",container:b})};this.children.forEach(function(a){c(a);a.subtype===x.SPOT_MODEL&&a.children.forEach(function(a){return c(a)})});
this.container=b}}},{key:"onLoad",value:function(){this.loaded=!0;this.dispatchEvent({type:"loaded"});this.dispatchEvent({type:"ready"})}},{key:"onProgress",value:function(a){this.dispatchEvent({type:"progress",progress:a})}},{key:"onError",value:function(){this.dispatchEvent({type:"error"})}},{key:"getZoomLevel",value:function(){return 800>=window.innerWidth?this.ImageQualityFair:800<window.innerWidth&&1280>=window.innerWidth?this.ImageQualityMedium:1280<window.innerWidth&&1920>=window.innerWidth?
this.ImageQualityHigh:1920<window.innerWidth?this.ImageQualitySuperHigh:this.ImageQualityLow}},{key:"updateTexture",value:function(a){var b=this.material.uniforms.tEquirect.value.clone();this.material.uniforms.tEquirect.value=a;requestAnimationFrame(function(){return null===b||void 0===b?void 0:b.dispose()})}},{key:"toggleInfospotVisibility",value:function(a,b){var c=this;b=void 0!==b?b:0;var e=void 0!==a?a:!this.isInfospotVisible;this.traverse(function(a){if(a.type===x.INFOSPOT||a.subtype===x.FLOOR_RING_INFOSPOT)e?
a.show(b):a.hide(b)});this.isInfospotVisible=e;this.infospotAnimation.onComplete(function(){c.dispatchEvent({type:"infospot-animation-complete",visible:e})}).delay(b).start()}},{key:"reset",value:function(){this.children.length=0}},{key:"setupTransitions",value:function(){var a=this;this.fadeInAnimation=new q.Tween;this.fadeOutAnimation=new q.Tween;this.enterTransition=(new q.Tween(this)).easing(q.Easing.Quartic.Out).onComplete(function(){a.dispatchEvent({type:"enter-complete"})}).start();this.leaveTransition=
(new q.Tween(this)).easing(q.Easing.Quartic.Out)}},{key:"fadeIn",value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.animationDuration,c=this.material.uniforms.opacity;this.fadeOutAnimation.stop();this.fadeInAnimation=(new q.Tween(c)).to({value:1},b).easing(q.Easing.Quartic.Out).onStart(function(){a.visible=!0;a.dispatchEvent({type:"enter-fade-start"})}).onComplete(function(){a.toggleInfospotVisibility(!0,b/2);a.dispatchEvent({type:"enter-fade-complete"})}).start()}},
{key:"fadeOut",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.animationDuration,b=this.material.uniforms.opacity,c=function(){this.visible=!1;this.dispatchEvent({type:"leave-complete"})}.bind(this);this.fadeInAnimation.stop();this.fadeOutAnimation=(new q.Tween(b)).to({value:0},a).easing(q.Easing.Quartic.Out).onComplete(c).start()}},{key:"onEnter",value:function(){var a=this,b=this.animationDuration;this.dispatchEvent({type:"enter"});this.leaveTransition.stop();
this.enterTransition.to({},b).onStart(function(){a.dispatchEvent({type:"enter-start"});a.loaded?a.dispatchEvent({type:"ready"}):a.load()}).start();this.children.forEach(function(a){a.dispatchEvent({type:"panorama-enter"});a.subtype===x.SPOT_MODEL&&a.children.forEach(function(a){return a.dispatchEvent({type:"panorama-enter"})})});this.active=!0}},{key:"onLeave",value:function(){var a=this,b=this.animationDuration;this.enterTransition.stop();this.leaveTransition.to({},b).onStart(function(){a.dispatchEvent({type:"leave-start"});
a.fadeOut(b);a.toggleInfospotVisibility(!1)}).start();this.dispatchEvent({type:"leave"});this.traverse(function(a){return a.dispatchEvent({type:"panorama-leave"})});this.active=!1}},{key:"onParallaxTransitionComplete",value:function(){var a;null===(a=this.children)||void 0===a?void 0:a.map(function(a){a.dispatchEvent({type:"parallax-transition-complete"})})}},{key:"onParallaxTransitionStart",value:function(){var a;null===(a=this.children)||void 0===a?void 0:a.map(function(a){a.dispatchEvent({type:"parallax-transition-start"})})}},
{key:"onNotParallaxTransitionComplete",value:function(){var a;null===(a=this.children)||void 0===a?void 0:a.map(function(a){a.dispatchEvent({type:"not-parallax-transition-complete"})})}},{key:"onNotParallaxTransitionStart",value:function(){var a;null===(a=this.children)||void 0===a?void 0:a.map(function(a){a.dispatchEvent({type:"not-parallax-transition-start"})})}},{key:"dispose",value:function(){function a(b){for(var c=b.geometry,d=b.material,f=b.type,g=b.subtype,n=b.children.length-1;0<=n;n--)a(b.children[n]),
b.remove(b.children[n]);f!==x.INFOSPOT&&g!==x.FLOOR_RING_INFOSPOT&&g!==x.SPOT_MODEL||b.dispose();c&&(c.dispose(),b.geometry=null);d&&(d.dispose(),b.material=null)}var b=this.material;b&&b.uniforms&&b.uniforms.tEquirect&&b.uniforms.tEquirect.value.dispose();this.infospotAnimation.stop();this.fadeInAnimation.stop();this.fadeOutAnimation.stop();this.enterTransition.stop();this.leaveTransition.stop();this.dispatchEvent({type:"panolens-viewer-handler",method:"onPanoramaDispose",data:this});a(this);this.parent&&
this.parent.remove(this)}}],[{key:"createGeometry",value:function(){return new d.SphereBufferGeometry(5050,100,80)}},{key:"createMaterial",value:function(){var a=d.UniformsUtils.clone(Qa);a.repeat.value.copy(new d.Vector2(1,1));a.offset.value.copy(new d.Vector2(0,0));a.opacity.value=0;return new d.ShaderMaterial({fragmentShader:"\n        uniform sampler2D tEquirect;\n        uniform vec2 repeat;\n        uniform vec2 offset;\n        uniform float opacity;\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n            vec3 direction = normalize( vWorldDirection );\n            vec2 sampleUV;\n            sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n            sampleUV.x = atan( -direction.z, -direction.x ) * RECIPROCAL_PI2 + 0.5;\n            sampleUV *= repeat;\n            sampleUV += offset;\n            sampleUV.x = fract(sampleUV.x);\n            sampleUV.y = fract(sampleUV.y);\n            gl_FragColor = vec4(texture2D( tEquirect, sampleUV ).rgb, opacity);\n        }\n    ",
vertexShader:"\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n            vWorldDirection = transformDirection( position, modelMatrix );\n            #include <begin_vertex>\n            #include <project_vertex>\n        }\n    ",uniforms:a,side:d.BackSide,transparent:!0})}}]);return f}(d.Mesh),sa=function(g){function f(a,b,c){F(this,f);b=n.call(this,b,c);b.subtype=r.IMAGE;b.src=a;b.floorPlane=null;return b}G(f,g);var n=H(f);I(f,[{key:"load",value:function(a){t(w(f.prototype),
"load",this).call(this,!1);a=a||this.src;if(!a)console.warn("Image source undefined");else if("string"===typeof a)Y.load(a,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this));else if(a instanceof HTMLImageElement)this.onLoad(new d.Texture(a))}},{key:"onLoad",value:function(a){a.minFilter=d.LinearFilter;a.magFilter=d.LinearFilter;a.needsUpdate=!0;this.updateTexture(a);window.requestAnimationFrame(t(w(f.prototype),"onLoad",this).bind(this))}},{key:"add",value:function(a){if(1<
arguments.length){var b=W(arguments),c;try{for(b.s();!(c=b.n()).done;)this.add(c.value)}catch(e){b.e(e)}finally{b.f()}return this}a instanceof T&&(this.floorPlane=a);t(w(f.prototype),"add",this).call(this,a)}},{key:"addFloorPlane",value:function(){this.floorPlane&&this.floorPlane instanceof T||(this.floorPlane=new T,this.add(this.floorPlane))}},{key:"removeFloorPlane",value:function(){this.floorPlane&&this.floorPlane instanceof T&&(this.floorPlane.dispose(),this.floorPlane=null)}},{key:"dispose",
value:function(){d.Cache.remove(this.src);this.floorPlane=null;t(w(f.prototype),"dispose",this).call(this)}}]);return f}(V),Ra=function(g){function f(a,b,c,e,h,g,p,l,m){F(this,f);a=n.call(this,a,b,c,e,h,g,p,l,m);b=document.createElement("canvas");b.width=1;b.height=1;b=b.getContext("2d").createImageData(1,1);a.image=b;a.magFilter=d.LinearFilter;a.minFilter=d.LinearFilter;a.generateMipmaps=!1;a.flipY=!0;a.unpackAlignment=1;a.needsUpdate=!0;return a}G(f,g);var n=H(f);I(f,[{key:"setRenderer",value:function(a){this.renderer=
a;this.gl=this.renderer.getContext();this.utils=d.WebGLUtils(this.gl,this.renderer.extensions,{})}},{key:"setSize",value:function(a,b){var c,e,d;if(a!==this.width||b!==this.height){var f=(null===(c=this.renderer)||void 0===c?void 0:c.properties)&&(null===(e=this.renderer)||void 0===e?void 0:null===(d=e.properties)||void 0===d?void 0:d.get(this));null!==f&&void 0!==f&&f.__webglTexture&&(this.width=a,this.height=b,c=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.bindTexture(this.gl.TEXTURE_2D,
f.__webglTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.utils.convert(this.format),a,b,0,this.utils.convert(this.format),this.utils.convert(this.type),null),this.gl.bindTexture(this.gl.TEXTURE_2D,c))}}},{key:"update",value:function(a,b,c){var e,d,f,g=(null===(e=this.renderer)||void 0===e?void 0:e.properties)&&(null===(d=this.renderer)||void 0===d?void 0:null===(f=d.properties)||void 0===f?void 0:f.get(this));null!==g&&void 0!==g&&g.__webglTexture&&(e=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),
this.gl.bindTexture(this.gl.TEXTURE_2D,g.__webglTexture),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,b,this.height-c-a.height,this.utils.convert(this.format),this.utils.convert(this.type),a),this.gl.bindTexture(this.gl.TEXTURE_2D,e))}}]);return f}(d.Texture),Sa=function(d){function f(a,b){var c=b.width,e=b.height,d=b.renderer,n=b.blob;F(this,f);b=g.call(this);b.src=a;b.srcTexture=n;b.renderer=d;b.width=8192<c?8192:c;b.height=8192<c?b.width/c*e:e;b.tileSourceFolder="".concat(a.slice(0,a.lastIndexOf("-")),
"/");b.texture=new Ra;b.subtype=r.PROGRESSVIE_IMAGE;b.floorPlane=null;b.queue=[];"blob"!==a.slice(0,4)&&b.addTilesToQueue();b.addEventListener("render",b.handleRender);b.RENDER_ELEMENTS_PER_FRAME=3;b.addEventListener("preview-texture-ready",b.handleEndOfTransition);return b}G(f,d);var g=H(f);I(f,[{key:"addTilesToQueue",value:function(){var a=Math.ceil(this.height/512),b=Math.ceil(this.width/512),c=this.width%512||512,e=this.height%512||512,d=this.getOrderedRows(a),f=Array.from({length:b},function(a,
b){return b});d=W(d);var g;try{for(d.s();!(g=d.n()).done;){var n=g.value,m=W(f),l;try{for(m.s();!(l=m.n()).done;){var k=l.value,q="".concat(this.tileSourceFolder).concat("high","_").concat(k,"_").concat(n,".jpg");this.queue.push({isLoaded:!1,isRendered:!1,width:k!==b-1?512:c,height:n!==a-1?512:e,offsetX:512*k,offsetY:512*n,src:q})}}catch(A){m.e(A)}finally{m.f()}}}catch(A){d.e(A)}finally{d.f()}}},{key:"handleRender",value:function(){var a,b,c=null===(a=this.renderer)||void 0===a?void 0:null===(b=a.properties)||
void 0===b?void 0:b.get(this.texture);null!==c&&void 0!==c&&c.__webglTexture&&(this.renderPreview(),this.removeEventListener("render",this.handleRender))}},{key:"renderPreview",value:function(){var a=this;requestAnimationFrame(function(){a.texture.setSize(a.width,a.height);a.texture.flipY=!0;var b=document.createElement("canvas");b.width=a.width;b.height=a.height;b.getContext("2d").drawImage(a.srcTexture,0,0,a.width,a.height);a.texture.update(b,0,0);a.dispatchEvent({type:"preview-texture-ready"})})}},
{key:"handleEndOfTransition",value:function(){console.log("alert -> loading other tiles");this.loadOtherTiles();this.removeEventListener("preview-texture-ready",this.handleEndOfTransition)}},{key:"loadOtherTiles",value:function(){var a=this;requestAnimationFrame(function(){var b=W(a.queue),c;try{var e=function(){var a=c.value;setTimeout(function(){var b=new Image;b.crossOrigin="anonymous";b.src=a.src;b.onload=function(){a.isLoaded=!0;a.image=b}},0)};for(b.s();!(c=b.n()).done;)e()}catch(h){b.e(h)}finally{b.f()}})}},
{key:"handleUpdateQueue",value:function(){var a=this;requestAnimationFrame(function(){for(var b=0;b<a.RENDER_ELEMENTS_PER_FRAME;b++)setTimeout(function(){var b=a.queue&&a.queue.findIndex(function(a){return!0===a.isLoaded});-1!==b&&null!==b&&(a.renderElement(a.queue[b]),a.queue.splice(b,1))},0)})}},{key:"renderElement",value:function(a){this.texture.update(a.image,a.offsetX,a.offsetY)}},{key:"onLoad",value:function(){this.updateTexture();t(w(f.prototype),"onLoad",this).call(this)}},{key:"dispose",
value:function(){this.texture.dispose();this.srcTexture=this.texture=null;var a=W(this.queue),b;try{var c=function(){var a=b.value;setTimeout(function(){return a.image=null},0)};for(a.s();!(b=a.n()).done;)c()}catch(e){a.e(e)}finally{a.f()}this.queue=null;t(w(f.prototype),"dispose",this).call(this)}},{key:"updateTexture",value:function(){t(w(f.prototype),"updateTexture",this).call(this,this.texture);this.texture.setRenderer(this.renderer)}},{key:"getOrderedRows",value:function(a){var b=Array.from({length:a},
function(a,b){return b}),c=Array.from({length:a}),e=Math.floor(a/2);b.map(function(a){return a<e?2*(e-a)-1:2*(a-e)}).forEach(function(a,e){c[a]=b[e]});return c}},{key:"addFloorPlane",value:function(){this.floorPlane&&"hotspotPlane"===this.floorPlane.subtype||(this.floorPlane=new T,this.add(this.floorPlane))}},{key:"removeFloorPlane",value:function(){this.floorPlane&&"hotspotPlane"===this.floorPlane.subtype&&(this.floorPlane.dispose(),this.floorPlane=null)}}]);return f}(V),Ta=function(g){function f(){F(this,
f);var a=new d.BufferGeometry,b=new d.MeshBasicMaterial({color:0,opacity:0,transparent:!0});a.addAttribute("position",new d.BufferAttribute(new Float32Array,1));return n.call(this,a,b)}G(f,g);var n=H(f);return f}(V),Ua=function(d){function f(){F(this,f);var a=[];for(var b=0;6>b;b++)a.push(M.WhiteTile);a=g.call(this,a);a.type=r.BASIC;return a}G(f,d);var g=H(f);return f}(function(g){function f(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];F(this,f);var b=n.call(this,null,f.createMaterial());
b.images=a;b.type=r.CUBE;return b}G(f,g);var n=H(f);I(f,[{key:"load",value:function(){t(w(f.prototype),"load",this).call(this,!1);za.load(this.images,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this))}},{key:"onLoad",value:function(a){this.material.uniforms.tCube.value=a;t(w(f.prototype),"onLoad",this).call(this)}},{key:"getTexture",value:function(){return this.material.uniforms.tCube.value}},{key:"dispose",value:function(){var a=this.material.uniforms.tCube.value;this.images.forEach(function(a){d.Cache.remove(a)});
a instanceof d.CubeTexture&&a.dispose();t(w(f.prototype),"dispose",this).call(this)}}],[{key:"createMaterial",value:function(){var a=d.ShaderLib.cube,b=a.fragmentShader,c=a.vertexShader;a=d.UniformsUtils.clone(a.uniforms);a.opacity.value=0;return new d.ShaderMaterial({fragmentShader:b,vertexShader:c,uniforms:a,side:d.BackSide,transparent:!0,opacity:0})}}]);return f}(V)),Ea={tEquirect:{value:new d.Texture},repeat:{value:new d.Vector2(1,1)},offset:{value:new d.Vector2(0,0)},opacity:{value:1}},Va=function(g){function f(a,
b){F(this,f);var c=n.call(this,f.createGeometry(),f.createMaterial());c.subtype=r.SLIDER;c.desiredWidth=null;c.desiredHeight=null;c.src=a.url;c.backgroundMode=aa.DEFAULT;c.desiredPosition=b||{x:0,y:0,z:0};return c}G(f,g);var n=H(f);I(f,[{key:"hide",value:function(){}},{key:"load",value:function(a){a=a||this.src;if(!a)console.warn("Image source undefined");else if("string"===typeof a)Y.load(a,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this));else if(a instanceof HTMLImageElement)this.onLoad(new d.Texture(a))}},
{key:"onLoad",value:function(a){a.minFilter=d.LinearFilter;a.magFilter=d.LinearFilter;a.needsUpdate=!0;this.desiredWidth=a.image.width;this.desiredHeight=a.image.height;this.container.children[0].style.backgroundImage="url(".concat(this.src,")");this.container.children[0].style.backgroundPosition="center";this.container.children[0].style.backgroundSize=this.backgroundMode===aa.COLOR?"1%":"cover";this.updateTexture(a);window.requestAnimationFrame(t(w(f.prototype),"onLoad",this).bind(this))}},{key:"reset",
value:function(){t(w(f.prototype),"reset",this).call(this)}},{key:"dispose",value:function(){if(this.material){var a=this.material.map;a&&a.dispose()}d.Cache.remove(this.src);t(w(f.prototype),"dispose",this).call(this)}}],[{key:"createGeometry",value:function(){return new d.PlaneBufferGeometry(1,1)}},{key:"createMaterial",value:function(){var a=d.UniformsUtils.clone(Ea);a.repeat.value.copy(new d.Vector2(1,1));a.offset.value.copy(new d.Vector2(0,0));a.opacity.value=0;return new d.ShaderMaterial({fragmentShader:"\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n\n            varying vec2 texcoord;\n            uniform sampler2D tEquirect;\n\n            void main()\n            {\n                /* Set color of the fragment */\n                gl_FragColor = texture2D(tEquirect, texcoord);}\n                \n    ",
vertexShader:"\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n\n            varying vec2 texcoord;\n\n            void main()\n            {\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n                texcoord  = uv;\n            }\n    ",uniforms:a,side:d.FrontSide,transparent:!0})}}]);return f}(V),ca=window.navigator.userAgent||window.navigator.vendor||window.opera,Wa=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(ca)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(ca.substr(0,
4)),ia=/(android)/i.test(ca),ja={xl:1200,lg:992,lgm:812,md:768,mdm:680,sm:576,smm:550,xs:450,xsm:375,xxs:320};Object.keys(ja).reduce(function(d,f){d[f]="min-width: ".concat(ja[f],"px");return d},{});Object.keys(ja).reduce(function(d,f){d[f]="max-width: ".concat(ja[f]-.02,"px");return d},{});var ka=function(g){function f(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};F(this,f);var c=n.call(this);var e=document.createElement("video");c.src=a;c.isHls=!1;"m3u8"===a.slice(-4)&&(O&&
O.isSupported()?(e.title=a,c.hls=new O({liveSyncDuration:1}),c.hls.loadSource(a),c.hls.attachMedia(e),c.setupHlsListeners(),c.isHls=!0):!e.canPlayType("application/vnd.apple.mpegurl")&&b.originSrc&&(c.src=b.originSrc));c.options=B({videoElement:e,loop:!0,muted:!0,autoplay:!1,playsinline:!0,crossOrigin:"anonymous"},b);c.videoElement=c.options.videoElement;c.videoProgress=0;c.maxDuration=b.maxDuration;c.subtype=r.VIDEO;c.floorPlane=null;c.addEventListener("leave",c.pauseVideo.bind(u(c)));c.addEventListener("enter-fade-start",
c.resumeVideoProgress.bind(u(c)));c.addEventListener("video-toggle",c.toggleVideo.bind(u(c)));c.addEventListener("video-time",c.setVideoCurrentTime.bind(u(c)));return c}G(f,g);var n=H(f);I(f,[{key:"setupHlsListeners",value:function(){var a=this;this.hls.on(O.Events.LEVEL_UPDATED,function(b){a.qualityLevel=b.data.level})}},{key:"load",value:function(){var a=this;t(w(f.prototype),"load",this).call(this,!1);var b=this.options,c=b.muted,e=b.loop,d=b.autoplay,g=b.playsinline,p=b.crossOrigin,n=b.maxDuration,
m=this.videoElement,l=this.onProgress.bind(this),k=this.onLoad.bind(this);this.maxDuration=n||60;m.loop=e;m.autoplay=d;m.playsinline=g;m.crossOrigin=p;m.muted=c;g&&(m.setAttribute("playsinline",""),m.setAttribute("webkit-playsinline",""));b=function(){var a=this.setVideoTexture(m);d&&this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1});c||this.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoSound"});Wa&&(m.pause(),d&&c?this.dispatchEvent({type:"panolens-viewer-handler",
method:"updateVideoPlayButton",data:!1}):this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}));window.requestAnimationFrame(function(){setTimeout(function(){l({loaded:1,total:1});k(a)},1E3)})};2<m.readyState?b.call(this):(0===m.querySelectorAll("source").length&&(g=document.createElement("source"),g.src=this.src,m.append(g)),m.load());m.addEventListener("loadeddata",b.bind(this));m.addEventListener("timeupdate",function(){a.isBuffering=!1;a.videoProgress=0<=
m.duration?m.currentTime/a.maxDuration||m.duration:0;n&&m.currentTime>=a.maxDuration&&(m.currentTime=0);a.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:{percentage:a.videoProgress,quality:a.qualityLevel}})});m.addEventListener("ended",function(){e||(a.resetVideo(),a.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}))},!1)}},{key:"onLoad",value:function(){t(w(f.prototype),"onLoad",this).call(this);this.maxDuration=Math.min(this.maxDuration,
this.videoElement.duration)}},{key:"setVideoTexture",value:function(a){if(a)return a=new d.VideoTexture(a),a.minFilter=d.LinearFilter,a.magFilter=d.LinearFilter,a.format=d.RGBFormat,this.updateTexture(a),a}},{key:"reset",value:function(){this.videoElement=void 0;t(w(f.prototype),"reset",this).call(this)}},{key:"isVideoPaused",value:function(){return this.videoElement.paused}},{key:"toggleVideo",value:function(a){var b=this.videoElement;if(b)if(a.toggleMute)b&&this.isVideoMuted()?this.unmuteVideo():
this.muteVideo();else b[b.paused?"play":"pause"]()}},{key:"setVideoCurrentTime",value:function(a){a=a.percentage;var b=this.videoElement;b&&!Number.isNaN(a)&&1!==a&&(b.currentTime=this.maxDuration*a,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:a}))}},{key:"playVideo",value:function(){var a=this.videoElement,b=this.playVideo.bind(this),c=this.dispatchEvent.bind(this),e=function(){c({type:"play"})},d=function(a){window.requestAnimationFrame(b);c({type:"play-error",
error:a})};if(a&&a.paused)a.play().then(e)["catch"](d)}},{key:"pauseVideo",value:function(){var a=this.videoElement;a&&!a.paused&&a.pause();this.hls&&this.hls.stopLoad();this.dispatchEvent({type:"pause"});this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0})}},{key:"resumeVideoProgress",value:function(){var a=this.videoElement;4<=a.readyState&&a.autoplay&&!this.isMobile?(this.playVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",
data:!1})):(this.pauseVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}));this.setVideoCurrentTime({percentage:this.videoProgress})}},{key:"resetVideo",value:function(){this.videoElement&&this.setVideoCurrentTime({percentage:0})}},{key:"isVideoMuted",value:function(){return this.videoElement.muted}},{key:"muteVideo",value:function(){this.videoElement.muted=!0;this.dispatchEvent({type:"volumechange"})}},{key:"unmuteVideo",value:function(){this.videoElement.muted=
!1;this.dispatchEvent({type:"volumechange"})}},{key:"getVideoElement",value:function(){return this.videoElement}},{key:"add",value:function(a){a instanceof T&&(this.floorPlane=a);t(w(f.prototype),"add",this).call(this,a)}},{key:"addFloorPlane",value:function(){this.floorPlane&&this.floorPlane instanceof T||(this.floorPlane=new T,this.add(this.floorPlane))}},{key:"removeFloorPlane",value:function(){this.floorPlane&&this.floorPlane instanceof T&&(this.floorPlane.dispose(),this.floorPlane=null)}},{key:"dispose",
value:function(){this.pauseVideo();this.removeEventListener("leave",this.pauseVideo);this.removeEventListener("enter-fade-start",this.resumeVideoProgress);this.removeEventListener("video-toggle",this.toggleVideo);this.removeEventListener("video-time",this.setVideoCurrentTime);this.floorPlane=null;t(w(f.prototype),"dispose",this).call(this)}}]);return f}(V),da={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:0},threshold:{value:.3},useTexture:{value:0},tMixTexture:{value:null}},
vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mixRatio;\nuniform sampler2D tDiffuse1;\nuniform sampler2D tDiffuse2;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texel1 = texture2D( tDiffuse1, vUv );\n\tvec4 texel2 = texture2D( tDiffuse2, vUv );\n\tif (useTexture==1) {\n\t\tvec4 transitionTexel = texture2D( tMixTexture, vUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\tgl_FragColor = mix( texel2, texel1, mixRatio );\n\t}\n}"};
ma.prototype={constructor:ma};var N={CROSSFADE:{id:0,label:"Crossfade",value:"crossfade",settings:{useTexture:!1,texture:3,transitionSpeed:-3,smoothstep:{start:.3,end:.7}}},PERLIN:{id:1,label:"Perlin",value:"perlin",settings:{useTexture:!0,texture:1,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},SQUARES:{id:2,label:"Squares",value:"squares",settings:{useTexture:!0,texture:2,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},CELLS:{id:3,label:"Cells",value:"cells",settings:{useTexture:!0,texture:3,
transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},DISTORT:{id:4,label:"Distort",value:"distort",settings:{useTexture:!0,texture:4,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},GRADIENT:{id:5,label:"Gradient",value:"gradient",settings:{useTexture:!0,texture:5,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},RADIAL:{id:6,label:"Radial",value:"radial",settings:{useTexture:!0,texture:6,transitionSpeed:-2,smoothstep:{start:.3,end:.7}}},PARALLAX:{id:7,label:"Parallax",value:"parallax",settings:{useTexture:!1,
texture:3,transitionSpeed:-3,smoothstep:{start:.3,end:.7}}},NONE:{id:8,label:"None",value:"none",settings:{useTexture:!1,texture:0,transitionSpeed:-1E4,smoothstep:{start:.3,end:.7}}}},ta=function(g){function f(a,b,c,e){var h,g,p=4<arguments.length&&void 0!==arguments[4]?arguments[4]:!1;F(this,f);var l=n.call(this);l.renderCount=0;l.fromScene=a;l.toScene=b;l.renderer=c;l.transitionParams=e;l.isInitiatorInfospot=p;l.clock=new d.Clock;l.transition=1;l.transitionScene=new d.Scene;l.cameraOrtho=new d.OrthographicCamera(window.innerWidth/
-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-10,10);l.updateParams(e);p=new d.TextureLoader;l.texture=p.load("/public/panolens/textures/transition/transition".concat(l.transitionParams.texture,".png"));l.quadmaterial=new ma(l.transitionParams,l.texture);p=new d.PlaneBufferGeometry(window.innerWidth,window.innerHeight);l.quad=new d.Mesh(p,l.quadmaterial);l.transitionScene.add(l.quad);p=function(){l.quadmaterial.uniforms.tDiffuse1.value=a.fbo.texture};var m=function(){l.quadmaterial.uniforms.tDiffuse2.value=
b.fbo.texture};if(null!==a&&void 0!==a&&null!==(h=a.panorama)&&void 0!==h&&h.loaded)p();else{var q;null===a||void 0===a?void 0:null===(q=a.panorama)||void 0===q?void 0:q.addEventListener("ready",p)}if(null!==b&&void 0!==b&&null!==(g=b.panorama)&&void 0!==g&&g.loaded)m();else{var k;null===b||void 0===b?void 0:null===(k=b.panorama)||void 0===k?void 0:k.addEventListener("ready",m)}return l}G(f,g);var n=H(f);I(f,[{key:"getTypeList",value:function(){return Object.keys(N).map(function(a){return B({},N[a])}).sort(function(a,
b){return a.id-b.id})}},{key:"getTypeRelatedParameters",value:function(a){switch(a){case N.PERLIN.value:return B({},N.PERLIN.settings);case N.SQUARES.value:return B({},N.SQUARES.settings);case N.CELLS.value:return B({},N.CELLS.settings);case N.DISTORT.value:return B({},N.DISTORT.settings);case N.GRADIENT.value:return B({},N.GRADIENT.settings);case N.RADIAL.value:return B({},N.RADIAL.settings);case N.PARALLAX.value:return B({},N.PARALLAX.settings);case N.NONE.value:return B({},N.NONE.settings);default:return B({},
N.CROSSFADE.settings)}}},{key:"updateParams",value:function(a){var b=this.getTypeRelatedParameters((null===a||void 0===a?void 0:a.type)||N.CROSSFADE.value);this.transitionParams=B(B(B({textureThreshold:.3},N.CROSSFADE.settings),a),b)}},{key:"execute",value:function(){this.transitionParams.animateTransition=!0;var a="parallax"===this.transitionParams.type;if(!a&&this.fromScene){var b,c,e=this.fromScene,d=this.toScene;null===e||void 0===e?void 0:null===(b=e.panorama)||void 0===b?void 0:b.dispatchEvent({type:"not-parallax-transition-start"});
null===d||void 0===d?void 0:null===(c=d.panorama)||void 0===c?void 0:c.dispatchEvent({type:"not-parallax-transition-start"})}a&&this.isInitiatorInfospot&&this.toScene.panorama.subtype!==r.SLIDER&&this.toScene.panorama.subtype!==r.SPIN&&(!this.fromScene||this.fromScene.panorama.subtype!==r.SLIDER&&this.fromScene.panorama.subtype!==r.SPIN)&&this.parallax()}},{key:"destroy",value:function(){this.toScene.destroy();this.fromScene.destroy()}},{key:"parallax",value:function(){var a=this.fromScene,b=this.toScene;
if(a){var c=a.lastTouch.scene||{x:0,y:0,z:0},e=a.camera.position,f=new d.Vector3;f.subVectors(e,c).normalize();e=new d.Vector3;a.camera.getWorldDirection(e);(new d.Vector3).subVectors(e,c.clone().normalize());c=f.multiply(new d.Vector3(-1,0,1));e=new d.Vector3;e=b.control.getRotations().h-a.control.getRotations().h;e=f.clone().applyAxisAngle(new d.Vector3(0,1,0),e).normalize();f=e.clone();e=b.panorama.position.clone();c=(new q.Tween(a.panorama.position)).to({x:2E3*c.x,y:2E3*c.y,z:2E3*c.z},1500).easing(q.Easing.Cubic.Out);
b.panorama.position.set(-2E3*f.x,f.y,-2E3*f.z);b.panorama.position.needsUpdate=!0;f=(new q.Tween(b.panorama.position)).to({x:e.x,y:e.y,z:e.z},1500).easing(q.Easing.Cubic.Out);c.start().onStart(function(){var b;null===a||void 0===a?void 0:null===(b=a.panorama)||void 0===b?void 0:b.dispatchEvent({type:"parallax-transition-start"})}).onComplete(function(){var b;null===a||void 0===a?void 0:null===(b=a.panorama)||void 0===b?void 0:b.dispatchEvent({type:"parallax-transition-complete"})});f.start().onStart(function(){var a;
null===b||void 0===b?void 0:null===(a=b.panorama)||void 0===a?void 0:a.dispatchEvent({type:"parallax-transition-start"})}).onComplete(function(){var a;null===b||void 0===b?void 0:null===(a=b.panorama)||void 0===a?void 0:a.dispatchEvent({type:"parallax-transition-complete"})})}}},{key:"render",value:function(){var a=this.cameraOrtho,b=this.clock,c=this.quadmaterial,e=this.renderer,f=this.transitionParams,g=this.transitionScene;if(null===this.fromScene){var p,n;a=null!==(p=f.controlEnabled)&&void 0!==
p?p:!0;this.toScene.render(!1);null!==(n=this.toScene)&&void 0!==n&&n.control&&(this.toScene.control.enabled=a);f.animateTransition=!1}else if(f.animateTransition&&(p=1+Math.sin(f.transitionSpeed*b.getElapsedTime()/Math.PI),this.transition=d.Math.smoothstep(p,f.smoothstep.start,f.smoothstep.end)),c.uniforms.mixRatio.value=this.transition,0===this.transition){var m,l,k;a=f&&(f.controlEnabled||!1===f.controlEnabled)?f.controlEnabled:!0;this.toScene.render(!1);null!==(m=this.toScene)&&void 0!==m&&m.control&&
(this.toScene.control.enabled=a);null!==(l=this.fromScene)&&void 0!==l&&l.control&&(this.fromScene.control.enabled=!1);f.animateTransition=!1;if("parallax"!==this.transitionParams.type&&this.fromScene){var q,A;null===(q=this.toScene)||void 0===q?void 0:null===(A=q.panorama)||void 0===A?void 0:A.dispatchEvent({type:"not-parallax-transition-complete"})}null===(k=this.fromScene)||void 0===k?void 0:k.destroy();this.fromScene=null;this.dispatchEvent({type:"transition-complete"})}else if(1===this.transition){var r,
u;f=f&&(f.controlEnabled||!1===f.controlEnabled)?f.controlEnabled:!0;this.fromScene.render(!1);this.toScene&&this.toScene.render(!0);null!==(r=this.toScene)&&void 0!==r&&r.control&&(this.toScene.control.enabled=f);null!==(u=this.fromScene)&&void 0!==u&&u.control&&(this.fromScene.control.enabled=f)}else{var t,v;f=f&&(f.controlEnabled||!1===f.controlEnabled)?f.controlEnabled:!0;this.fromScene.render(!0);this.toScene.render(!0);null!==(t=this.toScene)&&void 0!==t&&t.control&&(this.toScene.control.enabled=
f);null!==(v=this.fromScene)&&void 0!==v&&v.control&&(this.fromScene.control.enabled=f);e.setRenderTarget(null);e.clear();e.clearDepth();e.render(g,a)}}}]);return f}(d.EventDispatcher);ca=function(g){function f(a){F(this,f);var b=n.call(this);var c="100%",e="100%";a&&a.container&&a.container.style&&(c=a.container.style.width||"100%",e=a.container.style.height||"100%");var h=a&&a.container?a.container:document.createElement("div");h.classList.add("panolens-container");h.style.width=c;h.style.height=
e;h._width=window.innerWidth;h._height=window.innerHeight;a&&a.container||document.body.append(h);b.container=h;b.options=B({container:b.container,autoHideInfospot:!0,horizontalView:!1,controlBar:!1,controlButtons:[],autoHideControlBar:!0,clickTolerance:10,cameraFov:60,reverseDragging:!1,enableReticle:!1,dwellTime:1500,autoReticleSelect:!0,viewIndicator:!1,indicatorSize:30,output:null,autoRotate:!1,disableZoomInIframe:!1,autoRotateSpeed:2,autoRotateActivationDuration:5E3,initialLookAt:new d.Vector3(0,
0,-Number.MAX_SAFE_INTEGER),cameraInitialLookAt:null,momentum:!0,rotateSpeed:-1,dampingFactor:.1,defaultFov:60,controlEnabled:!0,horizontalViewLimit:!1,horizontalViewDownLimitDegrees:0,horizontalViewUpLimitDegrees:180},a);a=window.devicePixelRatio;c=!0;1<a&&(c=!1);b.renderer=new d.WebGLRenderer({antialias:c,alpha:!0,powerPreference:"high-performance"});b.renderer.setPixelRatio(a);b.renderer.setSize(window.innerWidth,window.innerHeight);b.renderer.autoClear=!1;b.renderer.setClearColor(0,0);b.renderer.domElement.classList.add("panolens-canvas");
b.renderer.domElement.style.display="block";b.renderer.domElement.style.position="absolute";b.container.style.backgroundColor="#000";b.container.append(b.renderer.domElement);a=document.createElement("div");a.style.transition="background-image 1.5s cubic-bezier( 1, 0, 0, 1 ) ";a.style.filter="blur(20px)";a.style.position="absolute";a.style.height="100%";a.style.width="100%";b.container.prepend(a);b.options.renderer=b.renderer;b.options.container=b.container;b.mode=null;b.controlIndex=null;b.autoRotate=
b.options.autoRotate;b.disableZoomInIframe=b.options.disableZoomInIframe;b.viewer=null;b.targetViewer=null;b.viewersQueue=[];b.composer=null;b.animate();b.inIframe=function(){try{return window.self!==window.top}catch(z){return!0}};return b}G(f,g);var n=H(f);I(f,[{key:"add",value:function(a){var b=this;this.viewer&&this.viewer.panorama instanceof ka&&this.viewer.removeWidget();this.viewer?(this.targetViewer=a,this.viewersQueue.push(a)):(this.viewer=a,this.viewersQueue.push(a),this.transition=new ta(null,
this.viewer,this.renderer,this.options.transitionParams),this.transition.addEventListener("transition-complete",function(){return b.disposePreviousViewer()}),this.transition.execute());a.panorama instanceof ka||this.removeVideoWidget();this.shareStateBetweenViewers()}},{key:"removeVideoWidget",value:function(){document.querySelectorAll(".videoWidgetBar").forEach(function(a){return a.remove()});document.querySelectorAll(".videoWidgetMask").forEach(function(a){return a.remove()})}},{key:"updateTransitionType",
value:function(a){a={type:a};this.options.transitionParams=B(B({},this.options.transitionParams),a);this.viewer.options.transitionParams=B(B({},this.viewer.options.transitionParams),a)}},{key:"setControlEnabled",value:function(){var a={controlEnabled:0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0};this.options.transitionParams=B(B({},this.options.transitionParams),a);this.viewer.options.transitionParams=B(B({},this.viewer.options.transitionParams),a);this.updateTransition()}},{key:"updateTransition",
value:function(){var a=this;this.transition=new ta(null,this.viewer,this.renderer,this.options.transitionParams);this.transition.addEventListener("transition-complete",function(){return a.disposePreviousViewer()});this.transition.execute()}},{key:"shareStateBetweenViewers",value:function(){this.options=this.viewer.options;this.mode=this.viewer.mode;this.controlIndex=this.viewer.getControlIndex();this.viewer.OrbitControls.noZoom=this.inIframe()?this.disableZoomInIframe:!1;this.targetViewer&&(this.targetViewer.OrbitControls.noZoom=
this.inIframe()?this.disableZoomInIframe:!1,this.mode!==this.targetViewer.mode&&this.targetViewer.enableEffect(this.mode),this.controlIndex!==this.targetViewer.getControlIndex()&&this.targetViewer.enableControl(this.controlIndex,!1),this.targetViewer.OrbitControls.minPolarAngle=this.viewer.OrbitControls.minPolarAngle,this.targetViewer.OrbitControls.maxPolarAngle=this.viewer.OrbitControls.maxPolarAngle,this.targetViewer.panorama.subtype===r.SLIDER||this.targetViewer.panorama.subtype===r.SPIN?(this.targetViewer.OrbitControls.enableDamping=
!1,this.targetViewer.OrbitControls.autoRotate=!1):(this.targetViewer.OrbitControls.enableDamping=!1,this.viewer.panorama.subtype===r.SLIDER||this.viewer.panorama.subtype===r.SPIN?this.targetViewer.OrbitControls.autoRotate=this.autoRotate:(this.targetViewer.OrbitControls.autoRotate=this.viewer.OrbitControls.autoRotate,this.autoRotate&&(this.targetViewer.autoRotateRequestId=window.setTimeout(this.targetViewer.enableAutoRate.bind(this.targetViewer),this.options.autoRotateActivationDuration)))),this.targetViewer.OrbitControls.update(),
this.targetViewer.OrbitControls.enableDamping=!0)}},{key:"setScene",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;a===this.targetViewer&&(this.transition=new ta(this.viewer,this.targetViewer,this.renderer,this.options.transitionParams,c),this.transition.addEventListener("transition-complete",function(){return b.disposePreviousViewer()}),this.transition.execute(),this.viewer=a,this.targetViewer=null)}},{key:"disposePreviousViewer",value:function(){if(2<=this.viewersQueue.length){var a=
this.viewersQueue.shift();a.dispose();a.destroy()}}},{key:"getRenderer",value:function(){return this.renderer}},{key:"getContainer",value:function(){return this.container}},{key:"render",value:function(){var a,b;this.isRenderingDisabled||(this.transition&&this.transition.render(),null===(a=this.viewer)||void 0===a?void 0:null===(b=a.panorama)||void 0===b?void 0:b.dispatchEvent({type:"render"}))}},{key:"disableRendering",value:function(a){this.isRenderingDisabled=a}},{key:"animate",value:function(){this.requestAnimationId=
requestAnimationFrame(this.animate.bind(this));this.render()}},{key:"destroy",value:function(){this.render();window.cancelAnimationFrame(this.requestAnimationId)}}]);return f}(d.EventDispatcher);var Xa={tDiffuse:{value:new d.Texture},resolution:{value:1},transform:{value:new d.Matrix4},zoom:{value:1},opacity:{value:1}},Ya=function(g){function f(a){F(this,f);a=n.call(this,a,f.createGeometry(1E4),f.createMaterial(1E4));a.subtype=r.IMAGE_LITTLE_PLANET;a.scale.x*=-1;a.EPS=1E-6;a.frameId=null;a.dragging=
!1;a.userMouse=new d.Vector2;a.quatA=new d.Quaternion;a.quatB=new d.Quaternion;a.quatCur=new d.Quaternion;a.quatSlerp=new d.Quaternion;a.vectorX=new d.Vector3(1,0,0);a.vectorY=new d.Vector3(0,1,0);a.handlerMouseDown=a.onMouseDown.bind(u(a));a.handlerMouseMove=a.onMouseMove.bind(u(a));a.handlerMouseUp=a.onMouseUp.bind(u(a));a.handlerMouseWheel=a.onMouseWheel.bind(u(a));a.handlerContextMenu=a.onContextMenu.bind(u(a));a.addEventListener("window-resize",a.onWindowResize);return a}G(f,g);var n=H(f);I(f,
[{key:"add",value:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}a instanceof Da&&(a.material.depthTest=!1);t(w(f.prototype),"add",this).call(this,a)}},{key:"registerMouseEvents",value:function(){this.container.addEventListener("mousedown",this.handlerMouseDown,{passive:!0});this.container.addEventListener("mousemove",this.handlerMouseMove,{passive:!0});this.container.addEventListener("mouseup",this.handlerMouseUp,{passive:!0});this.container.addEventListener("touchstart",
this.handlerMouseDown,{passive:!0});this.container.addEventListener("touchmove",this.handlerMouseMove,{passive:!0});this.container.addEventListener("touchend",this.handlerMouseUp,{passive:!0});this.container.addEventListener("mousewheel",this.handlerMouseWheel,{passive:!1});this.container.addEventListener("DOMMouseScroll",this.handlerMouseWheel,{passive:!1});this.container.addEventListener("contextmenu",this.handlerContextMenu,{passive:!0})}},{key:"unregisterMouseEvents",value:function(){this.container.removeEventListener("mousedown",
this.handlerMouseDown,!1);this.container.removeEventListener("mousemove",this.handlerMouseMove,!1);this.container.removeEventListener("mouseup",this.handlerMouseUp,!1);this.container.removeEventListener("touchstart",this.handlerMouseDown,!1);this.container.removeEventListener("touchmove",this.handlerMouseMove,!1);this.container.removeEventListener("touchend",this.handlerMouseUp,!1);this.container.removeEventListener("mousewheel",this.handlerMouseWheel,!1);this.container.removeEventListener("DOMMouseScroll",
this.handlerMouseWheel,!1);this.container.removeEventListener("contextmenu",this.handlerContextMenu,!1)}},{key:"onMouseDown",value:function(a){switch(a.touches&&0<a.touches.length||1){case 1:var b=0<=a.clientX?a.clientX:a.touches[0].clientX;a=0<=a.clientY?a.clientY:a.touches[0].clientY;this.dragging=!0;this.userMouse.set(b,a);break;case 2:b=a.touches[0].pageX-a.touches[1].pageX,a=a.touches[0].pageY-a.touches[1].pageY,this.userMouse.pinchDistance=Math.sqrt(b*b+a*a)}this.onUpdateCallback()}},{key:"onMouseMove",
value:function(a){switch(a.touches&&a.touches.length||1){case 1:var b=0<=a.clientX?a.clientX:a.touches[0].clientX;a=0<=a.clientY?a.clientY:a.touches[0].clientY;var c=.4*d.Math.degToRad(b-this.userMouse.x),e=.4*d.Math.degToRad(a-this.userMouse.y);this.dragging&&(this.quatA.setFromAxisAngle(this.vectorY,c),this.quatB.setFromAxisAngle(this.vectorX,e),this.quatCur.multiply(this.quatA).multiply(this.quatB),this.userMouse.set(b,a));break;case 2:b=a.touches[0].pageX-a.touches[1].pageX,a=a.touches[0].pageY-
a.touches[1].pageY,this.addZoomDelta(this.userMouse.pinchDistance-Math.sqrt(b*b+a*a))}}},{key:"onMouseUp",value:function(){this.dragging=!1}},{key:"onMouseWheel",value:function(a){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);this.addZoomDelta(b);this.onUpdateCallback()}},{key:"addZoomDelta",value:function(a){var b=this.material.uniforms,c=.1*this.size,e=10*this.size;b.zoom.value+=a;b.zoom.value<=c?b.zoom.value=c:b.zoom.value>=
e&&(b.zoom.value=e)}},{key:"onUpdateCallback",value:function(){this.frameId=window.requestAnimationFrame(this.onUpdateCallback.bind(this));this.quatSlerp.slerp(this.quatCur,.1);this.material&&this.material.uniforms.transform.value.makeRotationFromQuaternion(this.quatSlerp);!this.dragging&&1-this.quatSlerp.clone().dot(this.quatCur)<this.EPS&&window.cancelAnimationFrame(this.frameId)}},{key:"reset",value:function(){this.quatCur.set(0,0,0,1);this.quatSlerp.set(0,0,0,1);this.onUpdateCallback()}},{key:"updateTexture",
value:function(a){a.minFilter=d.LinearFilter;a.magFilter=d.LinearFilter;this.material.uniforms.tDiffuse.value=a}},{key:"getTexture",value:function(){return this.material.uniforms.tDiffuse.value}},{key:"onLoad",value:function(a){a.minFilter=d.LinearFilter;a.magFilter=d.LinearFilter;this.material.uniforms.tDiffuse.value=a;this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight;this.registerMouseEvents();this.onUpdateCallback();this.dispatchEvent({type:"panolens-viewer-handler",
method:"disableControl"});t(w(f.prototype),"onLoad",this).call(this,a)}},{key:"onLeave",value:function(){this.unregisterMouseEvents();this.dispatchEvent({type:"panolens-viewer-handler",method:"enableControl",data:R.ORBIT});window.cancelAnimationFrame(this.frameId);t(w(f.prototype),"onLeave",this).call(this)}},{key:"onWindowResize",value:function(){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight}},{key:"onContextMenu",value:function(){this.dragging=!1}},
{key:"dispose",value:function(){var a=this.material.uniforms.tDiffuse;a&&a.value&&a.value.dispose();this.unregisterMouseEvents();t(w(f.prototype),"dispose",this).call(this)}}],[{key:"createGeometry",value:function(){return new d.PlaneBufferGeometry(1E4,5E3)}},{key:"createMaterial",value:function(){var a=d.UniformsUtils.clone(Xa);a.zoom.value=1E4;a.opacity.value=0;return new d.ShaderMaterial({vertexShader:"\n\n        varying vec2 vUv;\n\n        void main() {\n\n            vUv = uv;\n            gl_Position = vec4( position, 1.0 );\n\n        }\n\n    ",
fragmentShader:"\n\n        uniform sampler2D tDiffuse;\n        uniform float resolution;\n        uniform mat4 transform;\n        uniform float zoom;\n        uniform float opacity;\n\n        varying vec2 vUv;\n\n        const float PI = 3.141592653589793;\n\n        void main(){\n\n            vec2 position = -1.0 +  2.0 * vUv;\n\n            position *= vec2( zoom * resolution, zoom * 0.5 );\n\n            float x2y2 = position.x * position.x + position.y * position.y;\n            vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );\n\n            sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );\n\n            vec2 sampleUV = vec2(\n                (atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,\n                (asin(sphere_pnt.z) / PI + 0.5)\n            );\n\n            gl_FragColor = texture2D( tDiffuse, sampleUV );\n            gl_FragColor.a *= opacity;\n\n        }\n    ",
uniforms:a,transparent:!0,opacity:0})}}]);return f}(sa);na.prototype=Object.assign(Object.create(d.EventDispatcher.prototype),{constructor:na});var Za=function(g){function f(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};F(this,f);var c=n.call(this,f.createGeometry(),f.createMaterial());c.options=B({},b);c.container=a;c.passThrough=!0;c.subtype=x.SPOT_MODEL;return c}G(f,g);var n=H(f);I(f,[{key:"dispose",value:function(){var a=this.geometry,b=this.material;a&&(a.dispose(),this.geometry=
null);b&&(b.dispose(),this.material=null)}}],[{key:"createGeometry",value:function(){return new d.SphereGeometry(.5,30,1,0,2*Math.PI,1,1)}},{key:"createMaterial",value:function(){return new d.MeshToonMaterial({color:302836,transparent:!0,opacity:0})}}]);return f}(d.Mesh),$a=function(g){function f(a,b,c,e){var d=4<arguments.length&&void 0!==arguments[4]?arguments[4]:function(){},g=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};F(this,f);var p=n.call(this,f.createGeometry(),f.createMaterial());
p.subtype=r.SPIN;p.options=B({onLoadOneCallback:function(){},onLoadPassCallback:function(){},onInitialAutoRotateFinished:function(){},numberOfPasses:null,preview:null},g);p.backgroundMode=p.options.backgroundMode||aa.DEFAULT;p.desiredWidth=p.options.desiredWidth||null;p.desiredHeight=p.options.desiredHeight||null;p.src=p.options.preview||a&&a[0];p.currentSideTexture=null;p.currentSide=null;if(!p.src)return console.error("Spin Panorama: the array of images is empty."),wa(p);p.position.set(0,0,-2);
p.spotModel=new Za(p.container);p.spotModel.scale.set(1,1,1);p.spotModel.position.set(0,0,0);p.add(p.spotModel);var l=p.options.numberOfPasses||Math.ceil(Math.log2(a.length));p.texturesArray=Array(a.length);var m=function(a){return a===l-1?Math.pow(2,a):Math.pow(2,a+1)},q=function(){return Object.values(k).reduce(function(a,b){return a+=b.count},0)/a.length},k=Array(l).fill(0).map(function(a,b){return b}).reduce(function(b,c){var e=Math.ceil((a.length-(c===l-1?0:Math.pow(2,c)))/m(c));b[c]={total:e,
count:0};return b},{});p.setUpSpinEnvironment=function(d){p.container.children[0].style.backgroundImage="url(".concat(a[0],")");p.container.children[0].style.backgroundPosition="center";p.container.children[0].style.backgroundSize=p.backgroundMode==aa.COLOR?"1%":"cover";p.desiredWidth=p.spotModel.desiredWidth=p.desiredWidth||d.image.width;p.desiredHeight=p.spotModel.desiredHeight=p.desiredHeight||d.image.height;for(var f=0;f<a.length;f++)p.texturesArray[f]=d;p.controls=new na(b,c,p.spotModel,e,p.texturesArray.length);
p.controls.addEventListener("rotation",p.onRotation,!1);p.controls.addEventListener("initial-auto-rotate-finished",p.options.onInitialAutoRotateFinished,!1);y(l-1)};p.onRotation=function(b){b=b.data.currentSide;var c=p.currentSideTexture;p.currentSideTexture=p.texturesArray[b];null===c||void 0===c?void 0:c.dispose();p.updateTexture(p.currentSideTexture);p.material.needsUpdate=!0;p.needsUpdate=!0;p.src=a[b]};p.rotateBySide=function(b){p.onRotation(b);p.spotModel.rotation.y+=(b.data.currentSide-p.currentSide)/
a.length*Math.PI*2;p.currentSide=b.data.currentSide};var y=function(b){for(var c=b===l-1?0:Math.pow(2,b),e=m(b),f=function(c){Y.load(a[c],function(e){k[b].count++;for(var f=0;f<m(b)/2;f++)c+f>=a.length||(p.texturesArray[c+f]=e);e=q();e===1/a.length&&p.dispatchEvent({type:"first-image-loaded"});p.options.onLoadOneCallback(e);k[b].count===k[b].total&&(p.options.onLoadPassCallback(b),0===b?(d(),p.controls.texturesLoaded=!0,p.options.disabledAutoAnimation||p.controls.animate(!1)):y(b-1))})};c<a.length;c+=
e)f(c)};return p}G(f,g);var n=H(f);I(f,[{key:"load",value:function(a){a=a||this.src;if(!a)console.warn("Image source undefined");else if("string"===typeof a)Y.load(a,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this));else if(a instanceof HTMLImageElement)this.onLoad(new d.Texture(a))}},{key:"add",value:function(a){a.type===x.INFOSPOT?(this.dispatchInfospotListeners(a),this.spotModel.add(a)):t(w(f.prototype),"add",this).call(this,a)}},{key:"onLoad",value:function(a){a.minFilter=
a.magFilter=d.LinearFilter;a.needsUpdate=!0;this.updateTexture(a);window.requestAnimationFrame(t(w(f.prototype),"onLoad",this).bind(this));this.setUpSpinEnvironment(a)}},{key:"reset",value:function(){t(w(f.prototype),"reset",this).call(this)}},{key:"dispose",value:function(){var a,b,c,e;if(null!==(a=this.material)&&void 0!==a&&null!==(b=a.uniforms)&&void 0!==b&&null!==(c=b.tEquirect)&&void 0!==c&&c.value){var h,g,p;null===(h=this.material)||void 0===h?void 0:null===(g=h.uniforms)||void 0===g?void 0:
null===(p=g.tEquirect)||void 0===p?void 0:p.value.dispose()}this.texturesArray.forEach(function(a){a.dispose()});null===(e=this.controls)||void 0===e?void 0:e.removeEventListener("rotation",this.onRotation,!1);d.Cache.remove(this.src);t(w(f.prototype),"dispose",this).call(this)}}],[{key:"createGeometry",value:function(){return new d.PlaneBufferGeometry(1,1)}},{key:"createMaterial",value:function(){var a=d.UniformsUtils.clone(Ea);a.repeat.value.copy(new d.Vector2(1,1));a.offset.value.copy(new d.Vector2(0,
0));a.opacity.value=0;return new d.ShaderMaterial({fragmentShader:"\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n\n            varying vec2 texcoord;\n            uniform sampler2D tEquirect;\n\n            void main()\n            {\n                /* Set color of the fragment */\n                gl_FragColor = texture2D(tEquirect, texcoord);}\n                \n    ",vertexShader:"\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n\n            varying vec2 texcoord;\n\n            void main()\n            {\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n                texcoord  = uv;\n            }\n    ",
uniforms:a,side:d.FrontSide,transparent:!0})}}]);return f}(V);ea.prototype=Object.create(d.EventDispatcher.prototype);ea.prototype.constructor=ea;fa.prototype=Object.assign(Object.create(d.EventDispatcher.prototype),{constructor:fa});pa.prototype=Object.assign(Object.create(d.EventDispatcher.prototype),{constructor:pa});Object.assign(ha.prototype,{constructor:ha,updateUniformByFormat:function(d,f){this.format=d;var g=f.repeat.value;f=f.offset.value;var a=this.loffset,b=this.roffset;switch(d){case X.TAB:g.set(1,
.5);f.set(0,.5);a.set(0,.5);b.set(0,0);break;case X.SBS:g.set(.5,1),f.set(0,0),a.set(0,0),b.set(.5,0)}},updateTextureToLeft:function(d){d.copy(this.loffset)},updateTextureToRight:function(d){d.copy(this.roffset)}});var Ja=function(g){function f(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new ha;F(this,f);var c=l.call(this,a);c.type=r.STEREO_IMAGE;c.stereo=b;return c}G(f,g);var l=H(f);I(f,[{key:"onLoad",value:function(a){var b=a.image;this.stereo.updateUniformByFormat(4===b.width/
b.height?X.SBS:X.TAB,this.material.uniforms);this.material.uniforms.tEquirect.value=a;t(w(f.prototype),"onLoad",this).call(this,a)}},{key:"updateTextureToLeft",value:function(){this.stereo.updateTextureToLeft(this.material.uniforms.offset.value)}},{key:"updateTextureToRight",value:function(){this.stereo.updateTextureToRight(this.material.uniforms.offset.value)}},{key:"dispose",value:function(){var a=this.material.uniforms.tEquirect.value;a instanceof d.Texture&&a.dispose();t(w(f.prototype),"dispose",
this).call(this)}}]);return f}(sa),Ka=function(g){function f(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new ha;F(this,f);b=l.call(this,a,b);b.type=r.STEREO_VIDEO_PANORAMA;b.stereo=c;return b}G(f,g);var l=H(f);I(f,[{key:"onLoad",value:function(a){var b=a.image;this.stereo.updateUniformByFormat(4===b.videoWidth/b.videoHeight?X.SBS:X.TAB,this.material.uniforms);this.material.uniforms.tEquirect.value=a;t(w(f.prototype),
"onLoad",this).call(this)}},{key:"updateTextureToLeft",value:function(){this.stereo.updateTextureToLeft(this.material.uniforms.offset.value)}},{key:"updateTextureToRight",value:function(){this.stereo.updateTextureToRight(this.material.uniforms.offset.value)}},{key:"dispose",value:function(){var a=this.material.uniforms.tEquirect.value;a instanceof d.Texture&&a.dispose();t(w(f.prototype),"dispose",this).call(this)}}]);return f}(ka),ab=function(g){var f=new d.StereoCamera;f.aspect=.5;var l=new d.Vector2;
this.setEyeSeparation=function(a){f.eyeSep=a};this.setSize=function(a,b){g.setSize(a,b)};this.render=function(a,b){a.updateMatrixWorld();null===b.parent&&b.updateMatrixWorld();f.update(b);g.getSize(l);g.autoClear&&g.clear();g.setScissorTest(!0);g.setScissor(0,0,l.width/2,l.height);g.setViewport(0,0,l.width/2,l.height);g.render(a,f.cameraL);g.setScissor(l.width/2,0,l.width/2,l.height);g.setViewport(l.width/2,0,l.width/2,l.height);g.render(a,f.cameraR);g.setScissorTest(!1)}},bb=function(g){function f(){var a=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};F(this,f);var b=l.call(this);b.options=B({container:b.setupContainer(a.container),controlBar:!1,controlButtons:[],autoHideControlBar:!0,autoHideInfospot:!0,horizontalView:!1,clickTolerance:10,cameraFov:60,reverseDragging:!1,enableReticle:!1,dwellTime:1500,autoReticleSelect:!0,viewIndicator:!1,indicatorSize:30,output:null,autoRotate:!1,autoRotateSpeed:2,autoRotateActivationDuration:5E3,initialLookAt:new d.Vector3(0,0,-Number.MAX_SAFE_INTEGER),
cameraInitialLookAt:null,momentum:!0,rotateSpeed:-1,dampingFactor:.1,defaultFov:60,horizontalViewLimit:!1,horizontalViewDownLimitDegrees:0,horizontalViewUpLimitDegrees:180},a);b.viewerInstanceNumber=Math.floor(30*Math.random());var c=b.options;a=c.container;var e=c.cameraFov,h=c.defaultFov,g=c.controlBar,p=c.viewIndicator,n=c.indicatorSize,m=c.enableReticle,r=c.reverseDragging,k=c.output,y=c.scene,t=c.camera;c=c.renderer;var v=a.clientWidth,x=a.clientHeight,w={minFilter:d.LinearFilter,magFilter:d.LinearFilter};
b.fbo=new d.WebGLRenderTarget(v,x,w);b.reticleFbo=new d.WebGLRenderTarget(v,x,w);b.container=a;b.scene=b.setupScene(y);b.sceneReticle=new d.Scene;b.defaultFov=h;b.camera=b.setupCamera(e,v/x,t);b.renderer=b.setupRenderer(c,a);b.reticle=b.addReticle(b.camera,b.sceneReticle);b.control=b.setupControls(b.camera,a);b.effect=b.setupEffects(b.renderer,a);b.lastTouch={plane:null,scene:null};b.containerCursor=S.GRAB;b.CURSORS=S;b.mode=E.NORMAL;b.panorama=null;b.widget=null;b.hoverObject=null;b.infospot=null;
b.pressEntityObject=null;b.pressObject=null;b.raycaster=new d.Raycaster;b.raycasterPoint=new d.Vector2;b.userMouse=new d.Vector2;b.updateCallbacks=[];b.requestAnimationId=null;b.cameraFrustum=new d.Frustum;b.cameraViewProjectionMatrix=new d.Matrix4;b.autoRotateRequestId=null;b.outputDivElement=null;b.touchSupported="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;b.tweenLeftAnimation=new q.Tween;b.tweenUpAnimation=new q.Tween;b.tweenCanvasOpacityOut=new q.Tween;b.tweenCanvasOpacityIn=
new q.Tween;b.outputEnabled=!1;b.viewIndicatorSize=n;b.tempEnableReticle=m;b.setupTween();b.handlerMouseUp=b.onMouseUp.bind(u(b));b.handlerMouseDown=b.onMouseDown.bind(u(b));b.handlerMouseMove=b.onMouseMove.bind(u(b));b.handlerWindowResize=b.onWindowResize.bind(u(b));b.handlerKeyDown=b.onKeyDown.bind(u(b));b.handlerKeyUp=b.onKeyUp.bind(u(b));b.handlerTap=b.onTap.bind(u(b),{clientX:v/2,clientY:x/2});g&&b.addDefaultControlBar(b.options.controlButtons);p&&b.addViewIndicator();r&&b.reverseDraggingDirection();
m?b.enableReticleControl():b.registerMouseAndTouchEvents();"overlay"===k&&b.addOutputElement();b.registerEventListeners();b.setupFloorCursor();return b}G(f,g);var l=H(f);I(f,[{key:"setupScene",value:function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:new d.Scene}},{key:"setupCamera",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new d.PerspectiveCamera(a,b,1,1E4);c.position.z=1;return c}},{key:"setupRenderer",value:function(){return 0<arguments.length&&
void 0!==arguments[0]?arguments[0]:new d.WebGLRenderer({alpha:!0,antialias:!1})}},{key:"setupControls",value:function(a,b){var c=this.options,e=c.autoRotate,d=c.autoRotateSpeed,f=c.horizontalView,g=c.momentum,l=c.rotateSpeed,m=c.dampingFactor,n=c.horizontalViewLimit,k=c.horizontalViewDownLimitDegrees,q=c.horizontalViewUpLimitDegrees;c=new fa(a,b);c.id="orbit";c.index=R.ORBIT;c.minDistance=1;c.noPan=!0;c.autoRotate=e;c.autoRotateSpeed=d;c.momentum=g;c.rotateSpeed=l;c.dampingFactor=m;c.enabled=!0;a=
new pa(a,b);a.id="device-orientation";a.index=R.DEVICEORIENTATION;a.enabled=!1;f&&(c.minPolarAngle=Math.PI/2,c.maxPolarAngle=Math.PI/2);!f&&n&&(c.minPolarAngle=Math.PI/180*k,c.maxPolarAngle=Math.PI/180*q);f={id:"drag",index:R.DRAG,enabled:!1};this.controls=[c,a,{id:"object",index:R.OBJECT,enabled:!1},f];this.OrbitControls=c;this.DeviceOrientationControls=a;this.DragControls=f;return c}},{key:"setupEffects",value:function(a,b){var c=b.clientWidth;b=b.clientHeight;var e=new Ia(a);e.setSize(c,b);a=new ab(a);
a.setSize(c,b);this.CardboardEffect=e;this.StereoEffect=a;return e}},{key:"setupContainer",value:function(a){a._width=a.clientWidth;a._height=a.clientHeight;return a}},{key:"setupTween",value:function(){this.tweenCanvasOpacityOut.to({},500).easing(q.Easing.Exponential.Out);this.tweenCanvasOpacityIn.to({},500).easing(q.Easing.Exponential.Out);this.tweenCanvasOpacityOut.chain(this.tweenCanvasOpacityIn)}},{key:"setupFloorCursor",value:function(){this.floorCursor=new Ca;this.add(this.floorCursor)}},{key:"setContainerCursor",
value:function(a){this.containerCursor=a;this.container&&(this.container.style.cursor=a)}},{key:"applyDefaultContainerCursor",value:function(){this.container&&(this.container.style.cursor=this.containerCursor)}},{key:"add",value:function(a){var b=this,c=this.container,e=this.scene,d=this.camera,f=this.controls;if(1<arguments.length){for(c=0;c<arguments.length;c++)this.add(arguments[c]);return this}e.add(a);a.addEventListener&&a.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this));
a.type===qa.FLOOR&&(this.floorCursor=a);a.type===r.PANORAMA&&(a.dispatchEvent({type:"panolens-container",container:c}),a.dispatchEvent({type:"panolens-scene",scene:e}),a.dispatchEvent({type:"panolens-camera",camera:d}),a.dispatchEvent({type:"panolens-controls",controls:f}),this.addPanoramaEventListener(a),this.panorama||(this.setPanorama(a),this.setControlCenter(this.options.initialLookAt)));if(a.subtype===r.SLIDER||a.subtype===r.SPIN){this.camera.position.set(0,0,1);e.add(a);this.controls[R.OBJECT]=
{};var g=!1;c=a.subtype===r.SPIN?-2:0;var l=(new q.Tween(a.position)).to({x:0,y:0,z:c},500).easing(q.Easing.Cubic.Out).onStart(function(){g=!0}).onComplete(function(){g=!1});a.addEventListener("addChild",this.fitObjectToScreenEvent.bind(this));a.addEventListener("ready",function(){b.OrbitControls.addEventListener("start",function(){b.DragControls.enabled=!1});b.OrbitControls.addEventListener("end",function(){b.camera.fov<b.defaultFov?(b.DragControls.enabled=!0,b.panorama.subtype===r.SPIN&&(b.panorama.controls.setIsZoomed(!0),
b.panorama.controls.disableHorizontalRotation())):(g||l.start(),b.panorama.subtype===r.SPIN&&(b.panorama.controls.setIsZoomed(!1),b.panorama.controls.enableHorizontalRotation()))});b.OrbitControls.addEventListener("change",function(){b.DragControls.enabled=!1});b.DragControls=Object.assign(new ea([a],b.camera,b.container),b.DragControls);b.DragControls.activate();b.camera.fov<b.defaultFov&&(b.DragControls.enabled=!0)});a.addEventListener("ready",this.fitObjectToScreenEvent.bind(this))}}},{key:"fitObjectToScreenEvent",
value:function(a){a.target.subtype!==r.SLIDER&&a.target.subtype!==r.SPIN||this.fitObjectToScreen(a.target)}},{key:"fitObjectToScreen",value:function(a){var b;if(a){var c=a.desiredWidth/a.desiredHeight;this.camera.lookAt(a.position);var e=2*Math.tan(Math.PI*this.camera.fov/360),f=this.defaultFov||60,g=1;g=e>e/this.camera.aspect*c?0!==a.position.z?e/Math.tan(e/(this.camera.position.z-a.position.z))*c:e:0!==a.position.z?e*this.camera.aspect/c/Math.tan(e/(this.camera.position.z-a.position.z))*c:e*this.camera.aspect/
c;g*=f/this.camera.fov;a.scale.set(g*c,g,1);a.subtype===r.SPIN&&(a.spotModel.scale.set(1,1,1),a.spotModel.scale.set(a.spotModel.scale.x/c,a.spotModel.scale.y,a.spotModel.scale.z/c));null===(b=a.children)||void 0===b?void 0:b.forEach(function(b){if(!b.alreadyScaled&&a.subtype!==r.SPIN&&b.type===x.INFOSPOT){b.scale.set(b.scale.x/c,b.scale.y,b.scale.z);b._parentRatio=c;var e=new d.Vector3;e.copy(b.scale);b.scaleUpAnimation=(new q.Tween(b.scale)).to({x:1.3*e.x,y:1.3*e.y},500).easing(q.Easing.Elastic.Out);
b.scaleDownAnimation=(new q.Tween(b.scale)).to({x:e.x,y:e.y},500).easing(q.Easing.Elastic.Out);null!=b.map&&(b.map.needsUpdate=!0);b.needsUpdate=!0;b.updateMatrixWorld();a.updateMatrixWorld();b.alreadyScaled=!0}});this.currentScale=g;this.currentRatio=c;this.panorama.subtype===r.SPIN&&(this.OrbitControls.maxFov=this.camera.fov)}}},{key:"remove",value:function(a){a.removeEventListener&&a.removeEventListener("panolens-viewer-handler",this.eventHandler.bind(this));this.scene.remove(a)}},{key:"addDefaultControlBar",
value:function(a){if(!this.widget){var b=new Aa(this.container);b.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this));b.addControlBar();a.forEach(function(a){b.addControlButton(a)});this.widget=b}}},{key:"setPanorama",value:function(a){var b=this.panorama;a.type===r.PANORAMA&&b!==a&&(this.hideInfospot(),b&&(b._onReady&&(b.removeEventListener("ready",b._onReady),delete b._onReady),b.onLeave()),a._onLeaveComplete&&(a.removeEventListener("leave-complete",a._onLeaveComplete),delete a._onLeaveComplete),
b=function e(){a.removeEventListener("ready",e);delete a._onReady;a.active&&a.fadeIn()},a.addEventListener("ready",b),a._onReady=b,this.panorama=a,this.panorama.onEnter())}},{key:"eventHandler",value:function(a){if(a.method&&this[a.method])this[a.method](a.data)}},{key:"dispatchEventToChildren",value:function(a){this.scene.traverse(function(b){b.dispatchEvent&&b.dispatchEvent(a)})}},{key:"activateWidgetItem",value:function(a,b){var c=this.widget.mainMenu,e=c.children[0];c=c.children[1];if(void 0!==
a){switch(a){case 0:a=e.subMenu.children[1];break;case 1:a=e.subMenu.children[2];break;default:a=e.subMenu.children[1]}e.subMenu.setActiveItem(a);e.setSelectionTitle(a.textContent)}if(void 0!==b){switch(b){case E.CARDBOARD:a=c.subMenu.children[2];break;case E.STEREO:a=c.subMenu.children[3];break;default:a=c.subMenu.children[1]}c.subMenu.setActiveItem(a);c.setSelectionTitle(a.textContent)}}},{key:"enableEffect",value:function(a){var b=this;if(this.mode!==a)if(a===E.NORMAL)this.disableEffect();else{this.mode=
a;var c=this.camera.fov;switch(a){case E.CARDBOARD:this.effect=this.CardboardEffect;this.enableReticleControl();break;case E.STEREO:this.effect=this.StereoEffect;this.enableReticleControl();break;default:this.effect=null,this.disableReticleControl()}this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode});this.disableAutoRate();this.camera.fov=c+.01;setTimeout(function(){if(document.fullscreenElement){var a=window.screen.width;var c=window.screen.height}else a=b.container.clientWidth,
c=b.container.clientHeight;b.effect.setSize(a,c);b.render()},50);this.camera.fov=c;this.dispatchEvent({type:"mode-change",mode:this.mode});this.dispatchEvent({type:"viewerStateUpdate"})}}},{key:"disableEffect",value:function(){this.mode!==E.NORMAL&&(this.mode=E.NORMAL,this.disableReticleControl(),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.options.autoRotate&&this.enableAutoRate(),
this.dispatchEvent({type:"mode-change",mode:this.mode}),this.dispatchEvent({type:"viewerStateUpdate"}))}},{key:"enableReticleControl",value:function(){this.reticle.visible||(this.tempEnableReticle=!0,this.unregisterMouseAndTouchEvents(),this.reticle.show(),this.registerReticleEvent(),this.updateReticleEvent())}},{key:"disableReticleControl",value:function(){this.tempEnableReticle=!1;this.options.enableReticle?this.updateReticleEvent():(this.reticle.hide(),this.unregisterReticleEvent(),this.registerMouseAndTouchEvents())}},
{key:"enableAutoRate",value:function(){this.options.autoRotate=!0;this.OrbitControls.autoRotate=!0;this.dispatchEvent({type:"enableAutoRotate"})}},{key:"disableAutoRate",value:function(){clearTimeout(this.autoRotateRequestId);this.dispatchEvent({type:"viewerStateUpdate"});this.options.autoRotate=!1;this.OrbitControls.autoRotate=!1}},{key:"toggleVideoPlay",value:function(a){this.panorama.subtype===r.VIDEO&&this.panorama.dispatchEvent({type:"video-toggle",pause:a})}},{key:"toggleVideoSound",value:function(){this.panorama.subtype===
r.VIDEO&&this.panorama.dispatchEvent({type:"video-toggle",toggleMute:!0})}},{key:"setVideoCurrentTime",value:function(a){this.panorama.subtype===r.VIDEO&&this.panorama.dispatchEvent({type:"video-time",percentage:a})}},{key:"onVideoUpdate",value:function(a){var b=this.widget;b&&b.dispatchEvent({type:"video-update",percentage:a.percentage,quality:a.quality})}},{key:"addUpdateCallback",value:function(a){a&&this.updateCallbacks.push(a)}},{key:"removeUpdateCallback",value:function(a){var b=this.updateCallbacks.indexOf(a);
a&&0<=b&&this.updateCallbacks.splice(b,1)}},{key:"showVideoWidget",value:function(){var a=this.widget;a&&a.dispatchEvent({type:"video-control-show"})}},{key:"hideVideoWidget",value:function(){var a=this.widget;a&&a.dispatchEvent({type:"video-control-hide"})}},{key:"updateVideoPlayButton",value:function(a){var b=this.widget;b&&b.videoElement&&b.videoElement.controlButton&&b.videoElement.controlButton.update(a)}},{key:"addPanoramaEventListener",value:function(a){var b=this;a.subtype===r.VIDEO&&(a.addEventListener("enter-fade-start",
this.showVideoWidget.bind(this)),a.addEventListener("leave-start",function(){b.panorama.subtype!==r.VIDEO&&b.hideVideoWidget.call(b)}))}},{key:"setControl",value:function(a){this.control=this.controls[a];this.dispatchEvent({type:"viewerStateUpdate"})}},{key:"getControl",value:function(){return this.control}},{key:"getScene",value:function(){return this.scene}},{key:"getCamera",value:function(){return this.camera}},{key:"getRenderer",value:function(){return this.renderer}},{key:"getContainer",value:function(){return this.container}},
{key:"getControlId",value:function(){return this.control.id}},{key:"getNextControlId",value:function(){return this.controls[this.getNextControlIndex()].id}},{key:"getNextControlIndex",value:function(){var a=this.controls,b=a.indexOf(this.control)+1;return b>=a.length?0:b}},{key:"getControlIndex",value:function(){return this.controls.indexOf(this.control)}},{key:"setCameraFov",value:function(a){this.camera.fov=a;this.camera.updateProjectionMatrix()}},{key:"getRaycastViewCenter",value:function(){var a=
new d.Raycaster;a.setFromCamera(new d.Vector2(0,0),this.camera);a=a.intersectObject(this.panorama);return 0<a.length?a[0].point:new d.Vector3(0,0,-1)}},{key:"enableControl",value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:R.ORBIT,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,e=this.control.index,d=this.controls,f=this.OrbitControls,g=this.DeviceOrientationControls,l=this.tweenCanvasOpacityOut,m=this.tweenCanvasOpacityIn,n=this.container.querySelector("canvas");
if(b!==e){if(b===R.DEVICEORIENTATION)l.onStart(function(){f.enabled=!1;g.enabled=!1;c?n.style.opacity=0:null}),m.onStart(function(){f.enabled=!0;g.updateAlphaOffsetAngle(f.publicSphericalDelta.data.theta);g.connect();c?n.style.opacity=1:null});else{e=g.getRotations;e();var k=this.getRaycastViewCenter();l.onStart(function(){f.enabled=!1;g.disconnect();n.style.opacity=0});m.onStart(function(){f.enabled=!0;a.setControlCenter(k);n.style.opacity=1})}l.start();this.control=d[b]}}},{key:"disableControl",
value:function(){this.control.enabled=!1}},{key:"toggleNextControl",value:function(){this.enableControl(this.getNextControlIndex())}},{key:"getScreenVector",value:function(a){a=a.clone();var b=this.container.clientWidth/2,c=this.container.clientHeight/2;a.project(this.camera);a.x=a.x*b+b;a.y=-(a.y*c)+c;a.z=0;return a}},{key:"checkSpriteInViewport",value:function(a){this.camera.matrixWorldInverse.copy(this.camera.matrixWorld).invert();this.cameraViewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,
this.camera.matrixWorldInverse);this.cameraFrustum.setFromProjectionMatrix(this.cameraViewProjectionMatrix);return a.visible&&this.cameraFrustum.intersectsSprite(a)}},{key:"reverseDraggingDirection",value:function(){console.warn("reverseDragging option is deprecated. Please use rotateSpeed to indicate strength and direction");this.OrbitControls.rotateSpeed*=-1}},{key:"addReticle",value:function(a,b){var c=new Ba(16777215,!0,this.options.dwellTime);c.hide();a.add(c);b.add(a);return c}},{key:"rotateControlLeft",
value:function(a){this.OrbitControls.rotateLeftStatic(a)}},{key:"rotateControlUp",value:function(a){this.OrbitControls.rotateUpStatic(a)}},{key:"rotateControl",value:function(a,b){this.rotateControlLeft(a);this.rotateControlUp(b)}},{key:"calculateCameraDirectionDelta",value:function(a){var b=this.camera.getWorldDirection(new d.Vector3);var c=b.clone();var e=this.panorama.getWorldPosition(new d.Vector3).sub(this.camera.getWorldPosition(new d.Vector3));a=a.clone();a.add(e).normalize();var f=a.clone();
b.y=0;a.y=0;e=Math.atan2(a.z,a.x)-Math.atan2(b.z,b.x);e=e>Math.PI?e-2*Math.PI:e;e=e<-Math.PI?e+2*Math.PI:e;b=Math.abs(c.angleTo(b)+(0>=c.y*f.y?f.angleTo(a):-f.angleTo(a)));b*=f.y<c.y?1:-1;return{left:e,up:b}}},{key:"setControlCenter",value:function(){var a=this.calculateCameraDirectionDelta(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.initialLookAt);this.rotateControl(a.left,a.up)}},{key:"tweenControlCenter",value:function(a,b,c){Array.isArray(a)&&(c=a[2],b=a[1],a=a[0]);b=void 0!==
b?b:400;c=c||q.Easing.Exponential.Out;var e=this.calculateCameraDirectionDelta(a);a=e.left;e=e.up;var d=this.rotateControlLeft.bind(this),f=this.rotateControlUp.bind(this),g={left:0,up:0},l=0,m=0;this.tweenLeftAnimation.stop();this.tweenUpAnimation.stop();this.tweenLeftAnimation=(new q.Tween(g)).to({left:a},b).easing(c).onUpdate(function(a){d(a.left-l);l=a.left}).start();this.tweenUpAnimation=(new q.Tween(g)).to({up:e},b).easing(c).onUpdate(function(a){f(a.up-m);m=a.up}).start()}},{key:"tweenControlCenterByObject",
value:function(a,b,c){this.tweenControlCenter(a.getWorldPosition(new d.Vector3),b,c)}},{key:"onWindowResize",value:function(a,b){var c=this.container.classList.contains("panolens-container")||this.container.isFullscreen;if(void 0!==a&&void 0!==b){var e=a;var d=b;this.container._width=a;this.container._height=b}else a=ia?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),b=ia?Math.min(document.documentElement.clientHeight,
window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||0),e=c?a:this.container.clientWidth,d=c?b:this.container.clientHeight,this.container._width=e,this.container._height=d;this.camera.aspect=e/d;this.camera.updateProjectionMatrix();this.renderer.setSize(e,d);if(this.panorama&&this.panorama.subtype===r.SLIDER||this.panorama&&this.panorama.subtype===r.SPIN)this.renderer.clear(),this.renderer.clearDepth(),this.fitObjectToScreen(this.panorama);(this.options.enableReticle||
this.tempEnableReticle)&&this.updateReticleEvent();this.dispatchEvent({type:"window-resize",width:e,height:d});this.scene.traverse(function(a){a.dispatchEvent&&a.dispatchEvent({type:"window-resize",width:e,height:d})})}},{key:"addOutputElement",value:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="10px";a.style.top="10px";a.style.color="#fff";this.container.append(a);this.outputDivElement=a}},{key:"getPlanePosition",value:function(a){var b=new d.Vector3(-1,
1,1),c=a.point.clone();c.multiply(b);a=Math.round(Math.abs(a.point.y))!==Math.abs(Z.Y);if(0!==c.length()&&!a)return c}},{key:"getSliderPosition",value:function(a){a=a.point.clone();return new d.Vector3(((a.x+this.panorama.position.x)/this.currentScale/this.currentRatio).toFixed(6),((a.y-this.panorama.position.y)/this.currentScale).toFixed(6),(0).toFixed(2))}},{key:"get360Position",value:function(a){var b=new d.Vector3(-1,1,1);a=a.point.clone();a.multiply(b);if(0!==a.length())return a}},{key:"outputPosition",
value:function(){var a=this,b=this.raycaster.intersectObject(this.panorama,!0);if(0<b.length){var c={plane:null,scene:null};b.forEach(function(b){if("hotspotPlane"===b.object.subtype){if(b=a.getPlanePosition(b))b.y+=+Math.random().toFixed(2);c.plane=b}else b.object.subtype===r.SLIDER?c.scene=a.getSliderPosition(b):b.object.subtype===r.IMAGE||b.object.subtype===r.PROGRESSVIE_IMAGE||b.object.subtype===r.VIDEO?c.scene=a.get360Position(b):b.object.subtype===x.SPOT_MODEL&&(b=b.point.clone(),a.panorama.spotModel.worldToLocal(b),
c.scene=b)});return this.lastTouch=c}}},{key:"onMouseDown",value:function(a){a.preventDefault();this.userMouse.x=0<=a.clientX?a.clientX:a.touches[0].clientX;this.userMouse.y=0<=a.clientY?a.clientY:a.touches[0].clientY;this.userMouse.type="mousedown";this.isProbablyDragging=!0;this.onTap(a)}},{key:"onMouseMove",value:function(a){a.preventDefault();this.userMouse.type="mousemove";this.onTap(a)}},{key:"onMouseUp",value:function(a){this.isProbablyDragging=!1;this.userMouse.type="mouseup";var b=this.userMouse.x>=
a.clientX-this.options.clickTolerance&&this.userMouse.x<=a.clientX+this.options.clickTolerance&&this.userMouse.y>=a.clientY-this.options.clickTolerance&&this.userMouse.y<=a.clientY+this.options.clickTolerance||a.changedTouches&&this.userMouse.x>=a.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=a.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=a.changedTouches[0].clientY-this.options.clickTolerance&&this.userMouse.y<=a.changedTouches[0].clientY+this.options.clickTolerance?
"click":void 0;if(!a||!a.target||a.target.classList.contains("panolens-canvas"))if(a.preventDefault(),a=a.changedTouches&&1===a.changedTouches.length?this.onTap({clientX:a.changedTouches[0].clientX,clientY:a.changedTouches[0].clientY},b):this.onTap(a,b),this.userMouse.type="none",!a&&"click"===b){b=this.options;a=b.autoHideControlBar;var c=this.panorama;b.autoHideInfospot&&c&&c.toggleInfospotVisibility();a&&this.toggleControlBar()}}},{key:"onTap",value:function(a,b){var c=this,e=this.container.getBoundingClientRect(),
f=e.top,g=this.container,l=g.clientHeight;this.raycasterPoint.x=(a.clientX-e.left)/g.clientWidth*2-1;this.raycasterPoint.y=2*-((a.clientY-f)/l)+1;this.raycaster.setFromCamera(this.raycasterPoint,this.camera);if(this.panorama){"mousedown"!==a.type&&this.outputPosition();this.floorCursor&&this.floorCursor.enabled&&(this.lastTouch&&this.lastTouch.plane&&this.floorCursor.position.set(-this.lastTouch.plane.x,this.lastTouch.plane.y+1,this.lastTouch.plane.z),this.floorCursor.onMove());e=this.raycaster.intersectObjects(this.panorama.children,
!0);f=e.filter(function(a){var b;return!(null!==(b=a.object)&&void 0!==b&&b.passThrough)});f=0<f.length?f[0].object:void 0;"click"!==b||f&&f.type===x.NADIR||this.panorama.dispatchEvent({type:"clickOnAviablePlaceForAddSpot"});"click"===b?(this.panorama.dispatchEvent({type:"click",intersects:e,mouseEvent:a}),f&&f.dispatchEvent&&f.dispatchEvent({type:"click",mouseEvent:a})):(this.panorama.dispatchEvent({type:"hover",intersects:e,mouseEvent:a}),this.hoverObject&&f!==this.hoverObject&&(this.hoverObject.dispatchEvent&&
(this.hoverObject.dispatchEvent({type:"hoverleave",mouseEvent:a}),this.reticle.end()),this.hoverObject=void 0),f&&this.hoverObject!==f&&(this.hoverObject=f,this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverenter",mouseEvent:a}),this.options.autoReticleSelect&&(this.options.enableReticle||this.tempEnableReticle)&&this.reticle.start(this.onTap.bind(this,a,"click")))));if(!f||f.type!==x.INFOSPOT&&f.subtype!==x.FLOOR_RING_INFOSPOT)this.infospot&&"click"===b&&this.hideInfospot();
else{this.infospot&&this.infospot!==f&&(this.infospot.unlockHoverElement(),this.hideInfospot());this.infospot=f;if("click"===b&&this.infospot.subtype!==x.HOTSPOT&&this.infospot.subtype!==x.FLOOR_RING_INFOSPOT&&this.panorama.subtype!==r.SPIN&&this.panorama.subtype!==r.SLIDER)return this.tweenControlCenter(new d.Vector3(-f.position.x,f.position.y,f.position.z)),!0;"click"===b&&this.infospot.subtype===x.HOTSPOT&&f.type!==x.NADIR&&setTimeout(function(){return c.setContainerCursor(S.GRAB)},10)}this.options.autoRotate&&
this.isProbablyDragging&&(clearTimeout(this.autoRotateRequestId),this.control===this.OrbitControls&&(this.OrbitControls.autoRotate=!1,this.dispatchEvent({type:"pauseAutoRotate"}),this.autoRotateRequestId=window.setTimeout(this.enableAutoRate.bind(this),this.options.autoRotateActivationDuration)))}}},{key:"hideInfospot",value:function(){this.infospot&&(this.infospot.onHoverEnd(),this.infospot=void 0)}},{key:"toggleControlBar",value:function(){this.widget&&this.widget.dispatchEvent({type:"control-bar-toggle"})}},
{key:"onKeyDown",value:function(a){this.options.output&&"none"!==this.options.output&&"Control"===a.key&&(this.outputEnabled=!0)}},{key:"onKeyUp",value:function(){this.outputEnabled=!1}},{key:"update",value:function(){var a,b,c=this,e=this.scene,f=this.control,g=this.OrbitControls,l=this.DeviceOrientationControls,n=this.panorama;q.update();this.updateCallbacks.forEach(function(a){return a()});(null===n||void 0===n?void 0:n.subtype)===r.PROGRESSVIE_IMAGE&&n.handleUpdateQueue();g.enabled&&null!==(a=
e.children[1])&&void 0!==a&&a.subtype&&(null===(b=e.children[1])||void 0===b?void 0:b.subtype)!==r.SPIN&&g.update();f===l&&l.update();var m=new d.Vector3,t=function(a){var b=c.hoverObject===a;(a.type===x.INFOSPOT||a.subtype===x.FLOOR_RING_INFOSPOT)&&a.element&&(b||a.showTitleHotspotInfospot||"none"!==a.element.style.display||a.element.left&&"none"!==a.element.left.style.display||a.element.right&&"none"!==a.element.right.style.display)&&(c.checkSpriteInViewport(a)?(b=c.getScreenVector(a.getWorldPosition(m)),
a.translateElement(b.x,b.y),a.showTitleHotspotInfospot&&a.handleAlwaysShowTitle(!0)):(a.onDismiss(!1),a.handleAlwaysShowTitle(!1)))};this.camera.updateMatrixWorld();this.camera.updateProjectionMatrix();e.traverse(function(a){t(a);a.subtype===r.SPIN&&a.spotModel.traverse(function(a){t(a);var b=new d.Vector3;a.getWorldPosition(b);if(-2>b.z)a.hide();else if(-2<b.z){var e;a.lookAt(0,0,1);null===(e=a.parent)||void 0===e?void 0:e.updateMatrixWorld();a.updateMatrixWorld();c.camera.updateProjectionMatrix();
c.camera.updateMatrixWorld();!a.visible&&a.shouldRender&&a.show()}})})}},{key:"renderEffect",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)?(this.renderer.setRenderTarget(this.fbo),this.renderer.clear(),this.effect.render(this.scene,this.camera,this.panorama,!0,this.fbo),this.effect.render(this.sceneReticle,this.camera,this.panorama,!0,this.fbo)):(this.renderer.setRenderTarget(null),this.renderer.clear(),this.effect.render(this.scene,this.camera,this.panorama,!1,null),
this.effect.render(this.sceneReticle,this.camera,this.panorama,!1,null));this.renderer.clearDepth()}},{key:"renderNormal",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)?this.renderer.setRenderTarget(this.fbo):this.renderer.setRenderTarget(null);this.renderer.clear();this.renderer.render(this.scene,this.camera);this.renderer.render(this.sceneReticle,this.camera);this.renderer.clearDepth()}},{key:"render",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:!0;this.update();this.panorama&&(this.mode===E.NORMAL?this.renderNormal(a):this.renderEffect(a))}},{key:"animate",value:function(){this.onChange()}},{key:"onChange",value:function(){this.update();this.render()}},{key:"registerMouseAndTouchEvents",value:function(){var a={passive:!1};this.container.addEventListener("mousedown",this.handlerMouseDown,a);this.container.addEventListener("mousemove",this.handlerMouseMove,a);this.container.addEventListener("mouseup",this.handlerMouseUp,a);this.container.addEventListener("touchstart",
this.handlerMouseDown,a);this.container.addEventListener("touchend",this.handlerMouseUp,a)}},{key:"unregisterMouseAndTouchEvents",value:function(){this.container.removeEventListener("mousedown",this.handlerMouseDown,!1);this.container.removeEventListener("mousemove",this.handlerMouseMove,!1);this.container.removeEventListener("mouseup",this.handlerMouseUp,!1);this.container.removeEventListener("touchstart",this.handlerMouseDown,!1);this.container.removeEventListener("touchend",this.handlerMouseUp,
!1)}},{key:"registerReticleEvent",value:function(){this.addUpdateCallback(this.handlerTap)}},{key:"unregisterReticleEvent",value:function(){this.removeUpdateCallback(this.handlerTap)}},{key:"updateReticleEvent",value:function(){var a=this.container.clientWidth/2+this.container.offsetLeft,b=this.container.clientHeight/2;this.removeUpdateCallback(this.handlerTap);this.handlerTap=this.onTap.bind(this,{clientX:a,clientY:b});this.addUpdateCallback(this.handlerTap)}},{key:"registerEventListeners",value:function(){window.addEventListener("resize",
this.handlerWindowResize,!0);window.addEventListener("keydown",this.handlerKeyDown,!0);window.addEventListener("keyup",this.handlerKeyUp,!0)}},{key:"unregisterEventListeners",value:function(){window.removeEventListener("resize",this.handlerWindowResize,!0);window.removeEventListener("keydown",this.handlerKeyDown,!0);window.removeEventListener("keyup",this.handlerKeyUp,!0)}},{key:"dispose",value:function(){function a(b){for(var c=b.children.length-1;0<=c;c--)a(b.children[c]),b.remove(b.children[c]);
b.type===r.PANORAMA||b.type===x.INFOSPOT||b.subtype===x.FLOOR_RING_INFOSPOT?b.dispose():b.dispatchEvent&&b.dispatchEvent("dispose")}this.disableAutoRate();this.tweenLeftAnimation.stop();this.tweenUpAnimation.stop();this.unregisterEventListeners();this.fbo.dispose();this.reticleFbo.dispose();a(this.scene);this.DragControls&&this.DragControls.dispose&&this.DragControls.dispose();this.widget&&(this.widget.dispose(),this.widget=null);d.Cache&&d.Cache.enabled&&d.Cache.clear();this.floorCursor&&(this.floorCursor=
null)}},{key:"removeWidget",value:function(){this.widget&&(this.widget.dispose(),this.widget=null)}},{key:"destroy",value:function(){this.dispose();this.render();window.cancelAnimationFrame(this.requestAnimationId)}},{key:"onPanoramaDispose",value:function(a){this.scene.traverse(function(b){b.type===r.PANORAMA&&(b.linkedSpots=b.linkedSpots.map(function(b){return b.toPanorama!==a?b:b.dispose()}).filter(function(a){return!!a}))});a===this.panorama&&(this.panorama=null)}},{key:"loadAsyncRequest",value:function(a){var b=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},c=new window.XMLHttpRequest;c.onloadend=function(a){b(a)};c.open("GET",a,!0);c.send(null)}},{key:"addViewIndicator",value:function(){var a=this;this.loadAsyncRequest(M.ViewIndicator,function(b){var c=this;if(0!==b.loaded){b=b.target.responseXML.documentElement;b.style.width="".concat(a.viewIndicatorSize,"px");b.style.height="".concat(a.viewIndicatorSize,"px");b.style.position="absolute";b.style.top="10px";b.style.left="10px";b.style.opacity=
"0.5";b.style.cursor="-webkit-grab";b.id="panolens-view-indicator-container";a.container.append(b);var e=b.querySelector("#indicator");a.addUpdateCallback(function(){a.radius=.225*a.viewIndicatorSize;a.currentPanoAngle=a.camera.rotation.y-d.Math.degToRad(90);a.fovAngle=d.Math.degToRad(a.camera.fov);a.leftAngle=-a.currentPanoAngle-a.fovAngle/2;a.rightAngle=-a.currentPanoAngle+a.fovAngle/2;a.leftX=a.radius*Math.cos(a.leftAngle);a.leftY=a.radius*Math.sin(a.leftAngle);a.rightX=a.radius*Math.cos(a.rightAngle);
a.rightY=a.radius*Math.sin(a.rightAngle);a.indicatorD="M ".concat(a.leftX," ").concat(a.leftY," A ").concat(a.radius," ").concat(a.radius," 0 0 1 ").concat(a.rightX," ").concat(a.rightY);a.leftX&&a.leftY&&a.rightX&&a.rightY&&a.radius&&e.setAttribute("d",a.indicatorD)});b.addEventListener("mouseenter",function(){c.style.opacity="1"});b.addEventListener("mouseleave",function(){c.style.opacity="0.5"})}})}},{key:"appendControlItem",value:function(a){var b=this.widget.createCustomItem(a);"video"===a.group?
this.widget.videoElement.append(b):this.widget.barElement.append(b);return b}},{key:"clearAllCache",value:function(){d.Cache.clear()}}]);return f}(d.EventDispatcher),cb=function(g){function f(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};F(this,f);var b=l.call(this);b.options=B({container:b.setupContainer(a.container),clickTolerance:10,isTourViewerPage:!1},a);b.container=b.options.container;b.renderer=b.setupRenderer();b.container.append(b.renderer.domElement);b.scene=new d.Scene;
b.scene.background=new d.Color(1316891);b.camera=b.setupCamera(b.container.clientWidth/b.container.clientHeight);b.camera.updateProjectionMatrix();b.control=b.setupControls();b.dollspot=null;b.selectedDollspot=null;b.dollhouse=null;b.panorama=null;b.requestAnimationId=null;b.userMouse=new d.Vector2;b.rightmousemove=!1;b.raycaster=new d.Raycaster;b.raycasterPoint=new d.Vector2;b.handlerMouseDown=b.onMouseDown.bind(u(b));b.handlerMouseMove=b.onMouseMove.bind(u(b));b.handlerMouseUp=b.onMouseUp.bind(u(b));
b.handlerMouseWheel=b.onMouseWheel.bind(u(b));b.handlerContextmenu=b.onContextmenu.bind(u(b));b.handlerWindowResize=b.onWindowResize.bind(u(b));b.registerEventListeners();b.animate();return b}G(f,g);var l=H(f);I(f,[{key:"setupCamera",value:function(a){return 1<arguments.length&&void 0!==arguments[1]?arguments[1]:new d.PerspectiveCamera(20,a,.1,1E4)}},{key:"setupRenderer",value:function(){var a=window.devicePixelRatio,b=!0;1<a&&(b=!1);b=new d.WebGLRenderer({antialias:b,powerPreference:"high-performance"});
b.setPixelRatio(a);b.setSize(this.container.clientWidth,this.container.clientHeight);b.autoClear=!1;b.setClearColor(2764856,1);b.domElement.classList.add("panolens-canvas");b.domElement.style.display="block";return b}},{key:"setupContainer",value:function(a){var b=a||document.createElement("div"),c=b.clientWidth||"100%",e=b.clientHeight||"100%";b.classList.add("panolens-container");b.style.width=c;b.style.height=e;b._width=b.clientWidth;b._height=b.clientHeight;b.style.backgroundColor="#2A3038";a||
document.body.appendChild(b);return b}},{key:"setControlCenter",value:function(a){a=(new d.Box3).setFromObject(a);this.orbitControl.target=a.getCenter(new d.Vector3);this.orbitControl.update()}},{key:"setupControls",value:function(){var a=new fa(this.camera,this.container,{panSpeed:3});a.screenSpacePanning=!0;a.noPan=!1;a.enableDamping=!1;a.enableZoom=!0;a.rotateSpeed=10;a.minDistance=.1;a.maxDistance=200;this.orbitControl=a;a.update();return a}},{key:"add",value:function(a){var b=this;a instanceof
ya&&(a.dispatchEvent({type:"panolens-container",container:this.container}),a.addEventListener("ready",function(){b.dollhouse=a;b.panorama=a;b.scene.add(b.dollhouse);b.setControlCenter(b.dollhouse);if(b.options.camera)b.camera.position.set(b.options.camera.position.x,b.options.camera.position.y,b.options.camera.position.z),b.orbitControl.target=new d.Vector3(b.options.camera.target.x,b.options.camera.target.y,b.options.camera.target.z);else{var c=(new d.Box3).setFromObject(a);b.camera.position.set(c.max.x+
2*(c.max.x-c.min.x),c.max.y+2*(c.max.y-c.min.y),c.max.z+2*(c.max.z-c.min.z));b.orbitControl.target=c.getCenter(new d.Vector3)}b.orbitControl.update();b.camera.updateProjectionMatrix()}),a.addEventListener("dollhouse-select-dollspot",function(a){b.dollspot=a.dollspot}))}},{key:"outputPosition",value:function(){var a=this.raycaster.intersectObject(this.panorama,!0);return 0<a.length?(a=a[0].point.clone(),0===a.length()?void 0:a):null}},{key:"onTap",value:function(a){var b=this.container.getBoundingClientRect(),
c=b.top;this.raycasterPoint.x=(a.clientX-b.left)/this.container.clientWidth*2-1;this.raycasterPoint.y=2*-((a.clientY-c)/this.container.clientHeight)+1;this.raycaster.setFromCamera(this.raycasterPoint,this.camera)}},{key:"getCameraPosition",value:function(){return{position:this.camera.position,target:this.orbitControl.target}}},{key:"selectDollspot",value:function(){this.dollspot.select();this.selectedDollspot=this.dollspot;this.orbitControl.enabled=!1}},{key:"unselectDollspot",value:function(){var a;
null===(a=this.dollspot)||void 0===a?void 0:a.unselect();this.selectedDollspot=this.dollspot=null;this.orbitControl.enabled=!0}},{key:"onMouseDown",value:function(a){this.userMouse.x=0<=a.clientX?a.clientX:a.touches[0].clientX;this.userMouse.y=0<=a.clientY?a.clientY:a.touches[0].clientY;this.userMouse.type="mousedown";this.onTap(a)}},{key:"onContextmenu",value:function(a){a.preventDefault()}},{key:"onMouseMove",value:function(a){this.rightmousemove&&a.preventDefault();this.userMouse.type="mousemove";
var b=this.outputPosition();this.dollspot&&b&&!this.options.isTourViewerPage&&(this.orbitControl.enabled=!1,this.dollspot.position.set(b.x,b.y,b.z));this.onTap(a)}},{key:"onMouseUp",value:function(a){this.userMouse.type="mouseup";this.rightmousemove=!1;a.preventDefault();2===a.button&&this.setOrbitTargetToScreenCenter();var b=0===a.button&&(this.userMouse.x>=a.clientX-this.options.clickTolerance&&this.userMouse.x<=a.clientX+this.options.clickTolerance&&this.userMouse.y>=a.clientY-this.options.clickTolerance&&
this.userMouse.y<=a.clientY+this.options.clickTolerance||a.changedTouches&&this.userMouse.x>=a.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=a.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=a.changedTouches[0].clientY-this.options.clickTolerance&&this.userMouse.y<=a.changedTouches[0].clientY+this.options.clickTolerance)?"click":void 0;"click"===b&&this.dollspot&&(this.selectDollspot(),this.dispatchEvent({type:"click-on-dollspot",shortId:this.dollspot.shortId}));
if("click"===b&&!this.dollspot){this.unselectDollspot();var c=this.outputPosition();c&&this.dispatchEvent({type:"create-new-dollspot",coords:c})}"click"!==b&&this.dollspot&&this.changeDollspotPosition(this.dollspot);this.onTap(a,b);this.userMouse.type="none";this.dollspot=null;this.orbitControl.enabled=!0}},{key:"onMouseWheel",value:function(a){a.preventDefault();var b=this.camera.position.x-this.orbitControl.target.x,c=this.camera.position.y-this.orbitControl.target.y,e=this.camera.position.z-this.orbitControl.target.z;
b*=(5E3+a.deltaY)/5E3;c*=(5E3+a.deltaY)/5E3;e*=(5E3+a.deltaY)/5E3;this.camera.position.x=b+this.orbitControl.target.x;this.camera.position.y=c+this.orbitControl.target.y;this.camera.position.z=e+this.orbitControl.target.z}},{key:"setOrbitTargetToScreenCenter",value:function(){var a,b=new d.Raycaster;b.setFromCamera(new d.Vector2(0,0),this.camera);if(b=null===(a=b.intersectObject(this.panorama,!0)[0])||void 0===a?void 0:a.point.clone())this.orbitControl.target=b,this.orbitControl.update()}},{key:"changeDollspotPosition",
value:function(a){this.dispatchEvent({type:"change-dollspot-position",shortId:a.shortId,coords:this.outputPosition()})}},{key:"onWindowResize",value:function(a,b){var c=this.container.classList.contains("panolens-container")||this.container.isFullscreen;if(void 0!==a&&void 0!==b){var e=a;var d=b;this.container._width=a;this.container._height=b}else a=ia?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),b=ia?Math.min(document.documentElement.clientHeight,
window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||0),e=c?a:this.container.clientWidth,d=c?b:this.container.clientHeight,this.container._width=e,this.container._height=d;this.camera.aspect=e/d;this.camera.updateProjectionMatrix();this.renderer.setSize(e,d);this.panorama&&this.panorama.subtype===r.SLIDER&&(this.panorama.position.set(0,0,0),this.panorama.lookAt(this.camera),this.fitObjectToScreen(this.panorama));this.dispatchEvent({type:"window-resize",width:e,
height:d});this.scene.traverse(function(a){a.dispatchEvent&&a.dispatchEvent({type:"window-resize",width:e,height:d})})}},{key:"getScreenVector",value:function(a){a=a.clone();var b=this.container.clientWidth/2,c=this.container.clientHeight/2;a.project(this.camera);a.x=a.x*b+b;a.y=-(a.y*c)+c;a.z=0;return a}},{key:"registerEventListeners",value:function(){var a={passive:!1};this.container.addEventListener("mousedown",this.handlerMouseDown,a);this.container.addEventListener("mousemove",this.handlerMouseMove,
a);this.container.addEventListener("mouseup",this.handlerMouseUp,a);this.container.addEventListener("wheel",this.handlerMouseWheel,a);this.container.addEventListener("contextmenu",this.handlerContextmenu,a);window.addEventListener("resize",this.handlerWindowResize,!0)}},{key:"unRegisterEventListeners",value:function(){this.container.removeEventListener("mousedown",this.handlerMouseDown,!1);this.container.removeEventListener("mousemove",this.handlerMouseMove,!1);this.container.removeEventListener("mouseup",
this.handlerMouseUp,!1);this.container.removeEventListener("wheel",this.handlerMouseWheel,!1);this.container.removeEventListener("contextmenu",this.handlerContextmenu,!1);window.removeEventListener("resize",this.handlerWindowResize,!0)}},{key:"animate",value:function(){this.requestAnimationId=window.requestAnimationFrame(this.animate.bind(this));this.update();this.render()}},{key:"update",value:function(){var a=this;this.orbitControl.update();var b=new d.Vector3;this.scene.traverse(function(c){if(c.element&&
c instanceof ba){var d=a.getScreenVector(c.getWorldPosition(b));c.translateElement(d.x,d.y)}})}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"destroy",value:function(){this.unRegisterEventListeners();this.render();window.cancelAnimationFrame(this.requestAnimationId)}}]);return f}(d.EventDispatcher);"134"!=d.REVISION&&console.warn("three.js version is not matched. Please consider use the target revision ".concat("134"));window.TWEEN=q;l.BACKGROUNDS=aa;l.BasicPanorama=
Ua;l.CONTROLS=R;l.CURSORS=S;l.CURSOR_TYPES=qa;l.CubeTextureLoader=za;l.DataImage=M;l.DollViewer=cb;l.Dollhouse=ya;l.Dollspot=ba;l.EmptyPanorama=Ta;l.FLOOR_PLANE_POSITION=Z;l.FloorCursor=Ca;l.FloorPlane=T;l.FloorRingInfospot=Oa;l.ImageLittlePlanet=Ya;l.ImageLoader=ra;l.ImagePanorama=sa;l.Infospot=Da;l.MODES=E;l.Nadir=Pa;l.ObjectControls=function(d,f,l){var a;function b(a,b){return e[b].enabled?-1*e[b].from<g.rotation[b]+a&&g.rotation[b]+a<e[b].to?!0:!1:!0}function c(){k=!1;x=a=0}this.setObjectToMove=
function(a){g=a};this.setZoomSpeed=function(a){q=a};this.setDistance=function(a,b){p=a;n=b};this.setRotationSpeed=function(a){m=a};this.setRotationSpeedTouchDevices=function(a){r=a};this.enableVerticalRotation=function(){t=!0};this.disableVerticalRotation=function(){t=!1};this.enableHorizontalRotation=function(){u=!0};this.disableHorizontalRotation=function(){u=!1};this.setMaxVerticalRotationAngle=function(a,b){e.x.from=a;e.x.to=b;e.x.enabled=!0};this.setMaxHorizontalRotationAngle=function(a,b){e.y.from=
a;e.y.to=b;e.y.enabled=!0};this.disableMaxHorizontalAngleRotation=function(){e.y.enabled=!1};this.disableMaxVerticalAngleRotation=function(){e.x.enabled=!1};this.disableZoom=function(){v=!1};this.enableZoom=function(){v=!0};f=void 0!==f?f:document;var e={x:{enabled:!1,from:Math.PI/8,to:Math.PI/8},y:{enabled:!1,from:Math.PI/4,to:Math.PI/4}},g=l,n=15,p=6,q=.5,m=.05,r=.05,k=!1,t=!1,u=!0,v=!0;var x=a=0;var w={X:null,Y:null},B=[];f.addEventListener("mousedown",function(a){k=!0},!1);f.addEventListener("mousemove",
function(c){if(k){var d=c.offsetX-a,e=c.offsetY-x;a=c.offsetX;x=c.offsetY;if(u&&0!=d){if(!b(Math.sign(d)*m,"y"))return;g.rotation.y+=Math.sign(d)*m}t&&0!=e&&b(Math.sign(e)*m,"x")&&(g.rotation.x+=Math.sign(e)*m)}},!1);f.addEventListener("mouseup",c,!1);f.addEventListener("mouseout",c,!1);f.addEventListener("wheel",function(a){v&&(a=a.wheelDelta?a.wheelDelta:-1*a.deltaY,0<a&&d.position.z>p?d.position.z-=q:0>a&&d.position.z<n&&(d.position.z+=q))},!1);f.addEventListener("touchstart",function(b){b.preventDefault();
2===b.touches.length?(w.X=Math.abs(b.touches[0].clientX-b.touches[1].clientX),w.Y=Math.abs(b.touches[0].clientY-b.touches[1].clientY),B=Array(2)):(a=b.touches[0].pageX,x=b.touches[0].pageY)},!1);f.addEventListener("touchmove",function(c){c.preventDefault();if(2===c.touches.length&&v){B=Array(2);var e=Math.abs(c.touches[0].clientX-c.touches[1].clientX);c=Math.abs(c.touches[0].clientY-c.touches[1].clientY);w&&0<w.X&&0<w.Y&&(e>w.X&&c>w.Y&&d.position.z>p?d.position.z-=q:e<w.X&&d.position.z<n&&c<w.Y&&
(d.position.z+=q));w.X=e;w.Y=c}else if(0===B.length){w.X=null;w.Y=null;e=c.touches[0].pageX-a;var f=c.touches[0].pageY-x;a=c.touches[0].pageX;x=c.touches[0].pageY;if(u&&0!=e){if(!b(Math.sign(e)*r,"y"))return;g.rotation.y+=Math.sign(e)*r}t&&0!=f&&b(Math.sign(f)*r,"x")&&(g.rotation.x+=Math.sign(f)*r)}},!1);f.addEventListener("touchend",function(b){w.X=null;w.Y=null;0<B.length?B.pop():B=[];b.preventDefault();x=a=0},!1)};l.PANORAMA_TYPES=r;l.Panorama=V;l.ProgressiveImagePanorama=Sa;l.REVISION="11";l.Reticle=
Ba;l.SPOT_TYPES=x;l.STEREOFORMAT=X;l.SliderPanorama=Va;l.SpinPanorama=$a;l.THREE_REVISION="134";l.THREE_VERSION=La;l.TextureLoader=Y;l.VERSION="0.11.0";l.VideoPanorama=ka;l.Viewer=bb;l.ViewerManager=ca;l.Widget=Aa;Object.defineProperty(l,"__esModule",{value:!0})});
